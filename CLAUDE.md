# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際にClaude Code (claude.ai/code) にガイダンスを提供します。

## プロジェクト概要

PaleGLは、TypeScriptとViteで構築されたWebGLグラフィックスエンジンです。ディファードレンダリング、ポストプロセシング効果、シェーダーの最小化、WebGLベースの3Dシーンなどの機能を備えたリアルタイムグラフィックスアプリケーションの作成を目的としています。

## アーキテクチャ

### コア構造
- `src/PaleGL/` - 機能別に整理されたメインエンジンコード:
  - `actors/` - シーンオブジェクト（カメラ、ライト、メッシュ、パーティクル）
  - `core/` - 基本的なエンジンシステム（レンダラー、GPUインターフェース、シーン管理）
  - `materials/` - シェーダーマテリアルとレンダリングパイプライン
  - `shaders/` - カスタム処理を伴うGLSLシェーダーファイル
  - `postprocess/` - ポストプロセシング効果パイプライン
  - `math/` - 線形代数ユーティリティ
  - `utilities/` - ヘルパー関数とデバッグツール

### 主要システム
- **レンダリング**: G-bufferサポートを伴うディファードシェーディング
- **シェーダーパイプライン**: 最小化サポートを伴うカスタムGLSL処理
- **マテリアルシステム**: 複数のマテリアルタイプ（lit、unlit、glass、raymarch）
- **アニメーション**: スキニングとキーフレームアニメーション
- **ポストプロセシング**: Bloom、FXAA、DOF、ボリューメトリックライティングなど

### エントリーポイント
- `pages/` - 異なるデモ/ラボ用の複数のエントリーポイント
- メインデモ: sandbox、street-light、morph-glass
- シングルページビルド用のルートモードが利用可能

## 開発コマンド

### コア開発
```bash
npm run dev                # ポート8000で開発サーバーを開始
npm run dev:watch          # ファイル監視付きの開発
npm run build:page         # ページモード用ビルド
npm run build:demo         # デモモード用ビルド
npm run serve:dist         # ポート9000でビルドファイルを配信
```

### コード品質
```bash
npm run lint               # TypeScriptファイルでESLintを実行
npm run lint:fix           # リントエラーの自動修正
npm run format             # Prettierでコード整形
tsc                        # 型チェック（出力なし）
```

### デモビルドとパッケージング
```bash
npm run pack:demo          # デモファイルをパック
npm run build_and_pack:demo # デモをビルドしてパック
```

### マリオネッターサーバー
```bash
npm run serve:marionetter  # タイムライン/アニメーションツール用のマリオネッターサーバーを開始
```

## ビルド設定

### 環境変数
- `VITE_DROP_CONSOLE=true` - 本番環境でコンソールログを削除
- `VITE_MINIFY_SHADER=true` - shader_minifier.exe経由でシェーダー最小化を有効化
- `VITE_ROOT=true` - ルートモード（単一エントリー）でビルド
- `VITE_BUNDLE=true` - 単一ファイルにバンドル
- `VITE_MANGLE=true` - アグレッシブなコードマングリングを有効化

### 特殊な依存関係
- シェーダー最適化のため `libs/` ディレクトリに `shader_minifier.exe` が必要
- GLSL処理とシェーダー最小化のためのカスタムViteプラグインを使用

## 主要機能

### シェーダーシステム
- カスタムインポートシステムと前処理を伴うGLSLシェーダー
- 本番ビルド用の自動シェーダー最小化
- シェーダー最適化のためのレイアウト変換プラグイン
- 部分インクルードを伴うバーテックス/フラグメントシェーダーのサポート

### グラフィックス機能
- G-bufferを伴うディファードレンダリング
- 複数の効果を持つポストプロセシングパイプライン
- スキンドメッシュアニメーションとGPUインスタンシング
- オブジェクト/スクリーンスペースレイマーチング
- ボリューメトリックライティングとフォグ効果

### 開発ツール
- 内蔵デバッガーGUIと統計
- FPSカウンターとパフォーマンス監視
- WebGL状態デバッグユーティリティ
- マリオネッター経由のタイムライン/アニメーションツール

## プロジェクト構造のメモ

- パスマッピング（`@/*` -> `src/*`）を有効にしたTypeScript strictモード
- コード品質のためのESLint + Prettier
- カスタムプラグインを伴うViteベースのビルドシステム
- 異なるデモ/アプリケーション用の複数のエントリーポイント
- カスタムGLSLシェーダー処理パイプライン
- distフォルダはビルド時に生成されるため、CLAUDEによる変更は不要
