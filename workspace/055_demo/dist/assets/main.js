class e{constructor(e,t){this.t=-1/0,this.i=e,this.o=t}start(e){this.t=e}exec(e){const t=1/this.i;if(e-t>=this.t){const i=e-this.t,r=t*Math.floor(i/t);this.t+=r,this.o(this.t,r)}}}class t{constructor(e,t,i=60){this.t=-1/0,this.i=e,this.o=t,this.u=i}start(e){this.t=e}exec(e){const t=1/this.i;if(e-t>=this.t){const i=e-this.t,r=Math.floor(i/t);if(r>this.u)return this.t+=t*r,void this.o(this.t,t);const s=Math.min(this.u,r);for(let e=0;e<s;e++)this.t+=t,this.o(this.t,t)}}}const i=Math.PI/180,r=0,s=1,n=4,a=1,o=0,u=1,l=0,h=1,c=2,f="s",m="o",p="a",v="t",d={[f]:0,[m]:1,[p]:2,[v]:3},g=0,x={l:0,h:1,m:2},y={p:0,v:1,g:2,T:3,S:4,C:5,M:6,P:7},T=0,w=1,S=0,b=1,C=2,M=0,P=1,z=2,D=3,R=4,L=5,B=0,U=1,I=0,V=1,N=1,E=0,A=1,F=2,O=3,_=4,k=5,G=0,j=1,$=2,H="aPosition",W="aUv",X="aNormal",J="aTangent",Y="aBinormal",K={D:0,R:1,L:2,B:3,U:4,I:5,V:6,N:7,A:8,F:9,O:10,_:11,k:12,G:13,j:14,$:15,H:16,W:17},Z=0,Q=1,q=2,ee=3,te=4,ie=5,re=6,se=7,ne=8,ae=9,oe=10,ue=11,le=12,he=13,ce=14,fe=15,me=16,pe=17,ve="uWorldMatrix",de="uViewMatrix",ge="uProjectionMatrix",xe="uViewProjectionMatrix",ye="uNormalMatrix",Te="uInverseWorldMatrix",we="uInverseViewMatrix",Se="uInverseViewProjectionMatrix",be="uInverseProjectionMatrix",Ce="uTransposeInverseViewMatrix",Me="uViewPosition",Pe="uViewDirection",ze="uAspect",De="uFov",Re="uGBufferATexture",Le="uGBufferBTexture",Be="uGBufferCTexture",Ue="uGBufferDTexture",Ie="uShadingModelId",Ve="uDepthTexture",Ne="uMetallic",Ee="uRoughness",Ae="uSrcTexture",Fe="uTime",Oe="uViewport",_e="uTargetWidth",ke="uTargetHeight",Ge="uAspect",je="uTexelSize",$e="uNearClip",He="uFarClip",We="uDirectionalLight",Xe="uSpotLight",Je="uPointLight",Ye="direction",Ke="intensity",Ze="color",Qe="shadowMapProjectionMatrix",qe="uDirectionalLightShadowMap",et="uSpotLightShadowMap",tt="position",it="distance",rt="attenuation",st="coneCos",nt="penumbraCos",at="uSkybox",ot="ubCommon",ut="ubTransformations",lt="ubCamera",ht="ubDirectionalLight",ct="ubSpotLight",ft="ubPointLight",mt={X:"BEGIN_MAIN",J:"END_MAIN",Y:"APPEND_ATTRIBUTES",K:"APPEND_UNIFORMS"},pt={Z:"LOCAL_POSITION_POST_PROCESS",q:"INSTANCE_TRANSFORM_PRE_PROCESS",ee:"WORLD_POSITION_POST_PROCESS",te:"VIEW_POSITION_POST_PROCESS",ie:"OUT_CLIP_POSITION_PRE_PROCESS",...mt},vt={...mt},dt={re:"DEPTH_FUNCTIONS",se:"ENGINE_UNIFORMS",ne:"TRANSFORM_VERTEX_UNIFORMS",ae:"CAMERA_UNIFORMS",oe:"PSEUDO_HDR"},gt={ue:"DEFINES",le:"ATTRIBUTES",...mt,...dt},xt=36064,yt=36053,Tt="EXT_color_buffer_float";class wt{constructor(e=1){this.he=0,this.ce=-1/0,this.fe=1,this.me=0,this.fe=e}get pe(){return this.me}start(e){this.he=0,this.ce=e}ve(e){if(this.ce<0)return void this.start(e);this.he++;const t=e-this.ce;t>this.fe&&(this.me=this.he/t,this.start(e))}}class St{constructor(e={}){this.de=[],this.ge=0,this.xe=0,this.ye=!1,this.Te=!0,this.we=!0,this.Se=!0;const{be:t,Te:i=!0,Se:r=!0,ye:s=!0}=e;this.Te=!!i,this.Se=!!r,this.ye=!!s,this.Ce=document.createElement("div"),this.Ce.style.cssText="\nposition: absolute;\ntop: 0;\nleft: 0;\npadding: 0.2em 0.5em;\nfont-size: 9px;\ncolor: white;\nfont-weight: bold;\ntext-shadow: rgba(0, 0, 0, 0.7) 1px 1px;\nwhite-space: break-spaces;\n",this.Me=document.createElement("p"),this.Ce.appendChild(this.Me),this.Pe=document.createElement("div"),this.Ce.appendChild(this.Pe),this.ze=document.createElement("p"),this.Pe.appendChild(this.ze),this.De=document.createElement("p"),this.Pe.appendChild(this.De),this.Re=document.createElement("p"),this.Pe.appendChild(this.Re),(t||document.body).appendChild(this.Ce),this.ye=!!e.ye,this.Le=new wt}clear(){this.de=[],this.ge=0,this.xe=0}Be(e,t,i){const r=this.de.findIndex((t=>t.Ue===e)),s=i.getAttribute(H);if(!s)throw"invalid position attribute";const n=s.data.length/3;r<0?this.Ie(e,{Ve:t,Ne:n}):this.de[r].Ee.push({Ve:t,Ne:n})}Ae(e){const t=e.getAttribute(H);t&&(this.ge+=t.data.length/3)}Fe(){this.xe++}update(e){this.Le.ve(e),this.Oe()}Oe(){this.Ce.style.display=this.Te?"block":"none",this.Me.style.display=this.we?"block":"none",this.Pe.style.display=this.Se?"block":"none",this.Me.textContent=`FPS: ${Math.floor(this.Le.pe)}`;const e=[];e.push("-------------");for(let t=0;t<this.de.length;t++){let i=0,r=0;const s=[];for(let e=0;e<this.de[t].Ee.length;e++){const n=this.de[t].Ee[e];if(this.ye){const e=`${n.Ve} - vertex count: ${n.Ne}`;s.push(e)}i++,r+=n.Ne}s.unshift(`[${this.de[t].Ue}]\ndraw calls: ${i}, vertex count: ${r}`),e.push(...s)}e.push("-------------"),this.ze.textContent=e.join("\n"),this.De.textContent=`vertex count: ${this.ge}`,this.Re.textContent=`draw call count: ${this.xe}`}Ie(e,t){this.de.push({Ue:e,Ee:[t]})}}class bt{constructor({name:e,data:t,location:i,size:r,offset:s=0,_e:n=G,divisor:a=0}){this.name=e,this.data=t,this.location=i||0,this.size=r,this.offset=s||0,this._e=n||G,this.divisor=a||0}getDescriptor(){return{name:this.name,location:this.location,size:this.size,ke:this.data.constructor}}}class Ct{get Ge(){}bind(){}je(){}dispose(){}}class Mt extends Ct{constructor({$e:e,He:t}){super(),this.$e=e;const i=this.$e.We;this.Xe=i.createBuffer(),this.bind(),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),i.STATIC_DRAW)}get Ge(){return this.Xe}bind(){const e=this.$e.We;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.Xe)}je(){const e=this.$e.We;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}}class Pt extends Ct{constructor({$e:e,Je:t,type:i=M,width:r,height:s,Ye:n=!1,Ke:a=I,Ze:o=I,Qe:u=B,qe:l=B,flipY:h,et:c}){super(),this.Je=null,this.$e=e;const f=this.$e.We;this.Je=t||null,this.type=i,this.Ye=n,this.Ke=a,this.Ze=o,this.Qe=u,this.qe=l,this.width=r,this.height=s,this.flipY=!(!this.Je||void 0!==h)||!!h,this.et=this.type===P&&void 0!==c?c:void 0,this.Je,this.Je;const m=f.createTexture();switch(this.tt=m,f.bindTexture(f.TEXTURE_2D,this.tt),n&&f.generateMipmap(f.TEXTURE_2D),this.type){case M:case z:case D:case R:case L:if(this.Ke===I)f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);else f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR);if(this.Ze===I)f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);else f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);break;case P:f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST)}if(u===U)f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);else f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT);if(l===U)f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);else f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT);switch(this.flipY?f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!0):f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),this.type){case M:r&&s?this.Je?f.texImage2D(f.TEXTURE_2D,0,f.RGBA,r,s,0,f.RGBA,f.UNSIGNED_BYTE,this.Je):f.texImage2D(f.TEXTURE_2D,0,f.RGBA,r,s,0,f.RGBA,f.UNSIGNED_BYTE,null):this.Je&&f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,this.Je);break;case P:r&&s?this.Je?f.texImage2D(f.TEXTURE_2D,0,this.et===N?f.DEPTH_COMPONENT32F:f.DEPTH_COMPONENT16,r,s,0,f.DEPTH_COMPONENT,this.et===N?f.FLOAT:f.UNSIGNED_SHORT,this.Je):f.texImage2D(f.TEXTURE_2D,0,this.et===N?f.DEPTH_COMPONENT32F:f.DEPTH_COMPONENT16,r,s,0,f.DEPTH_COMPONENT,this.et===N?f.FLOAT:f.UNSIGNED_SHORT,null):this.Je&&f.texImage2D(f.TEXTURE_2D,0,this.et===N?f.DEPTH_COMPONENT32F:f.DEPTH_COMPONENT16,f.DEPTH_COMPONENT,this.et===N?f.FLOAT:f.UNSIGNED_SHORT,this.Je);break;case z:r&&s?this.Je?f.texImage2D(f.TEXTURE_2D,0,f.RGBA16F,r,s,0,f.RGBA,f.FLOAT,this.Je):f.texImage2D(f.TEXTURE_2D,0,f.RGBA16F,r,s,0,f.RGBA,f.FLOAT,null):this.Je&&f.texImage2D(f.TEXTURE_2D,0,f.RGBA16F,f.RGBA,f.FLOAT,this.Je);break;case D:r&&s?this.Je?f.texImage2D(f.TEXTURE_2D,0,f.RGBA32F,r,s,0,f.RGBA,f.FLOAT,this.Je):f.texImage2D(f.TEXTURE_2D,0,f.RGBA32F,r,s,0,f.RGBA,f.FLOAT,null):this.Je&&f.texImage2D(f.TEXTURE_2D,0,f.RGBA32F,f.RGBA,f.FLOAT,this.Je);break;case R:r&&s?this.Je?f.texImage2D(f.TEXTURE_2D,0,f.R11F_G11F_B10F,r,s,0,f.RGB,f.FLOAT,this.Je):f.texImage2D(f.TEXTURE_2D,0,f.R11F_G11F_B10F,r,s,0,f.RGB,f.FLOAT,null):this.Je&&f.texImage2D(f.TEXTURE_2D,0,f.R11F_G11F_B10F,f.RGB,f.FLOAT,this.Je);break;case L:r&&s?this.Je?f.texImage2D(f.TEXTURE_2D,0,f.R16F,r,s,0,f.RED,f.FLOAT,this.Je):f.texImage2D(f.TEXTURE_2D,0,f.R16F,r,s,0,f.RED,f.FLOAT,null):this.Je&&f.texImage2D(f.TEXTURE_2D,0,f.R16F,f.RED,f.FLOAT,this.Je)}f.bindTexture(f.TEXTURE_2D,null)}get Ge(){return this.tt}it(e,t){this.width=Math.floor(e),this.height=Math.floor(t);const i=this.$e.We;switch(i.bindTexture(i.TEXTURE_2D,this.tt),this.type){case M:this.Je?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,this.Je):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null);break;case P:this.Je?i.texImage2D(i.TEXTURE_2D,0,this.et===N?i.DEPTH_COMPONENT32F:i.DEPTH_COMPONENT16,e,t,0,i.DEPTH_COMPONENT,this.et===N?i.FLOAT:i.UNSIGNED_SHORT,this.Je):i.texImage2D(i.TEXTURE_2D,0,this.et===N?i.DEPTH_COMPONENT32F:i.DEPTH_COMPONENT16,e,t,0,i.DEPTH_COMPONENT,this.et===N?i.FLOAT:i.UNSIGNED_SHORT,null);break;case z:this.Je?i.texImage2D(i.TEXTURE_2D,0,i.RGBA16F,e,t,0,i.RGBA,i.FLOAT,this.Je):i.texImage2D(i.TEXTURE_2D,0,i.RGBA16F,e,t,0,i.RGBA,i.FLOAT,null);break;case D:this.Je?i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,e,t,0,i.RGBA,i.FLOAT,this.Je):i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,e,t,0,i.RGBA,i.FLOAT,null);break;case R:this.Je?i.texImage2D(i.TEXTURE_2D,0,i.R11F_G11F_B10F,e,t,0,i.RGB,i.FLOAT,this.Je):i.texImage2D(i.TEXTURE_2D,0,i.R11F_G11F_B10F,e,t,0,i.RGB,i.FLOAT,null);break;case L:this.Je?i.texImage2D(i.TEXTURE_2D,0,i.R16F,e,t,0,i.RED,i.FLOAT,this.Je):i.texImage2D(i.TEXTURE_2D,0,i.R16F,e,t,0,i.RED,i.FLOAT,null)}i.bindTexture(i.TEXTURE_2D,null)}update({width:e,height:t,data:i}){this.width=e,this.height=t;const r=this.$e.We;if(r.bindTexture(r.TEXTURE_2D,this.tt),this.type===D)r.texImage2D(r.TEXTURE_2D,0,r.RGBA32F,e,t,0,r.RGBA,r.FLOAT,i);r.bindTexture(r.TEXTURE_2D,null)}rt(){return new Pt({$e:this.$e,Je:this.Je,type:this.type,width:this.width,height:this.height,Ye:this.Ye,Ke:this.Ke,Ze:this.Ze,Qe:this.Qe,qe:this.qe,flipY:this.flipY})}}class zt extends Ct{constructor(e,t,i,r,s,n,a,o,u){super();const l=e.We;this.width=t,this.height=i,this.st=Math.log2(Math.max(this.width,this.height)),this.#e=l.createTexture(),l.bindTexture(l.TEXTURE_CUBE_MAP,this.#e),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,r),l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_X,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,s),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_Y,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,n),l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,a),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_Z,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o),l.texImage2D(l.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,u),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.generateMipmap(l.TEXTURE_CUBE_MAP),l.bindTexture(l.TEXTURE_CUBE_MAP,null)}#e;get Ge(){return this.#e}}function Dt(e,t){const i=[];switch(e){case ue:case he:i.push(t),i.push(0),i.push(0),i.push(0);break;case pe:i.push(t?1:0),i.push(0),i.push(0),i.push(0);break;case te:case re:i.push(...t.elements),i.push(0);break;case se:case Z:case ce:i.push(...t.elements)}return i}class Rt extends Ct{constructor(e,t,i,r,s,n,a,o){super(),this.$e=e,this.nt=t,this.blockSize=i,this.ot=a,this.ut=o;const{We:u}=this.$e;this.lt=u.createBuffer(),this.bind(),u.bufferData(u.UNIFORM_BUFFER,this.ot,u.DYNAMIC_DRAW),this.je(),u.bindBufferBase(u.UNIFORM_BUFFER,this.ut,this.lt),this.ht=r.map(((e,t)=>({name:e,index:s[t],offset:n[t]})))}get Ge(){return this.lt}bind(){const{We:e}=this.$e;e.bindBuffer(e.UNIFORM_BUFFER,this.lt)}je(){const{We:e}=this.$e;e.bindBuffer(e.UNIFORM_BUFFER,null)}ct(e,t,i=!1){const r=this.ht.find((t=>t.name===e));r&&(this.bind(),this.$e.We.bufferSubData(this.$e.We.UNIFORM_BUFFER,r.offset,t,0),this.je())}ft(e,t,i){switch(t){case ae:i.forEach((t=>{const i=`${e}.${t.name}`,r=Dt(t.type,t.value);this.ct(i,new Float32Array(r))}));break;case oe:i.forEach(((t,i)=>{t.forEach((t=>{const r=`${e}[${i}].${t.name}`,s=Dt(t.type,t.value);this.ct(r,new Float32Array(s))}))}));break;default:if(Array.isArray(i)){const t=[];i.forEach((e=>{"number"==typeof e?(t.push(e),t.push(0),t.push(0),t.push(0)):"boolean"==typeof e?(t.push(e?1:0),t.push(0),t.push(0),t.push(0)):t.push(...e.elements)})),this.ct(e,new Float32Array(t))}else this.ct(e,"number"==typeof i?new Float32Array([i]):i.elements)}}}const Lt=(e="black")=>{const t=document.createElement("canvas"),i=t.getContext("2d");return t.width=1,t.height=1,i.fillStyle=e,i.fillRect(0,0,1,1),t},Bt=(e,t)=>{switch(t){case G:return e.STATIC_DRAW;case j:return e.DYNAMIC_DRAW;case $:return e.DYNAMIC_COPY;default:return-1}};class Ut extends Ct{constructor({$e:e,attributes:t=[],He:i}){super(),this.vt=[],this.Xe=null,this.$e=e;const r=this.$e.We.createVertexArray();this.dt=r,this.bind(),t.forEach((e=>{this.setAttribute(e)})),i&&(this.Xe=new Mt({$e:e,He:i})),this.je(),this.Xe&&this.Xe.je()}get hasIndices(){return!!this.Xe}get Ge(){return this.dt}bind(){const{We:e}=this.$e;e.bindVertexArray(this.Ge)}je(){const{We:e}=this.$e;e.bindVertexArray(null)}setAttribute(e){const t=this.$e.We;t.bindVertexArray(this.dt);const{name:i,data:r,size:s,location:n,_e:a,divisor:o}=e,u=null!=n?n:this.vt.length,l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l);const h=Bt(t,a);switch(t.bufferData(t.ARRAY_BUFFER,r,h),t.enableVertexAttribArray(u),r.constructor){case Float32Array:t.vertexAttribPointer(u,s,t.FLOAT,!1,0,0);break;case Uint16Array:t.vertexAttribIPointer(u,s,t.UNSIGNED_SHORT,0,0);break;default:throw"[VertexArrayObject.setAttribute] invalid data type"}o&&t.vertexAttribDivisor(u,o),this.vt.push({name:i,gt:l,xt:h,location:n,size:s,divisor:o}),t.bindVertexArray(null),t.bindBuffer(t.ARRAY_BUFFER,null)}ct(e,t){const{We:i}=this.$e,r=this.yt(e);i.bindBuffer(i.ARRAY_BUFFER,r.gt),i.bufferSubData(i.ARRAY_BUFFER,0,t),i.bindBuffer(i.ARRAY_BUFFER,null)}Tt(e,t){const{We:i}=this.$e,r=this.wt(e),{location:s,size:n}=this.vt[r];this.bind(),i.bindBuffer(i.ARRAY_BUFFER,t),i.enableVertexAttribArray(s),i.vertexAttribPointer(s,n,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,null),this.je(),this.vt[r].gt=t}St(){return this.vt.map((({gt:e})=>e))}yt(e){const t=this.vt.find((({name:t})=>e===t));if(!t)throw"invalid target vbo";return t}wt(e){for(let t=0;t<this.vt.length;t++)if(e===this.vt[t].name)return t;throw"invalid target vbo"}bt(e){const t=this.yt(e);if(!t)throw"invalid name";return t.gt}}class It{constructor(e,t,i){this.elements=new Float32Array(3),this.set(e,t,i)}get x(){return this.elements[0]}get y(){return this.elements[1]}get z(){return this.elements[2]}set x(e){this.elements[0]=e}set y(e){this.elements[1]=e}set z(e){this.elements[2]=e}get Ct(){return Math.max(1e-4,Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z))}set(e,t,i){return this.elements=new Float32Array([e,t,i]),this}Mt(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}normalize(){const e=this.Ct;return this.x=this.x/e,this.y=this.y/e,this.z=this.z/e,this}add(e){return this.x+=e,this.y+=e,this.z+=e,this}Pt(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e,this.y-=e,this.z-=e,this}zt(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}Dt(){return this.x*=-1,this.y*=-1,this.z*=-1,this}scale(e){return this.x*=e,this.y*=e,this.z*=e,this}Rt(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}clone(){return new It(this.x,this.y,this.z)}Lt(e){const t=this.x,i=this.y,r=this.z,s=e.Bt*t+e.Ut*i+e.It*r+1*e.Vt,n=e.Nt*t+e.m11*i+e.m12*r+1*e.m13,a=e.Et*t+e.m21*i+e.m22*r+1*e.m23;return this.x=s,this.y=n,this.z=a,this}static At(e,t){return new It(e.x*t.x,e.y*t.y,e.z*t.z)}equals(e){const t=1e-7;return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t&&Math.abs(this.z-e.z)<t}Ft(e){return this.x*e.x+this.y*e.y+this.z*e.z}static Ft(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static get Ot(){return new It(0,0,0)}static get _t(){return new It(1,1,1)}static get kt(){return new It(0,1,0)}static get Gt(){return new It(0,-1,0)}static get back(){return new It(0,0,-1)}static get forward(){return new It(0,0,1)}static get right(){return new It(1,0,0)}static get left(){return new It(-1,0,0)}static jt(e){return new It(e[0],e[1],e[2])}static $t(...e){const t=It.Ot;return e.forEach((e=>{t.x+=e.x,t.y+=e.y,t.z+=e.z})),t}static Ht(e,t){return new It(e.x-t.x,e.y-t.y,e.z-t.z)}static Wt(e,t){return new It(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)}static Xt(e,t){const i=e.x,r=e.y,s=e.z,n=t/180*Math.PI,a=Math.cos(n),o=Math.sin(n);return new It(i,r*a+s*-o,r*o+s*a)}static Jt(e,t){const i=e.x,r=e.y,s=e.z,n=t/180*Math.PI,a=Math.cos(n),o=Math.sin(n);return new It(i*a+s*o,r,i*-o+s*a)}static Yt(e,t){const i=e.x,r=e.y,s=e.z,n=t/180*Math.PI,a=Math.cos(n),o=Math.sin(n);return new It(i*a+r*-o,i*o+r*o,s)}static Kt(e){return e.equals(It.kt)||e.equals(It.Gt)?It.right:It.Wt(e,It.Gt)}static Zt(e,t){return It.Wt(e,t.clone().Dt())}static fill(e){return new It(e,e,e)}static Qt(e,t,i){return new It(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i,e.z+(t.z-e.z)*i)}log(){}}class Vt{constructor({$e:e,attributes:t,He:i,qt:r,ei:s=null}){this.attributes=[],this.Ne=0,this.He=null,this.$e=e,this.ei="number"==typeof s?s:null,this.qt=r,i&&(this.He=i),t.forEach(((e,t)=>{e.location=t,e.divisor=e.divisor||0})),this.ti=new Ut({$e:e,attributes:[],He:this.He}),t.filter((e=>Object.keys(e).length>0)).forEach((e=>{this.setAttribute(e)}))}setAttribute(e){const t=e.location?e.location:this.attributes.length,i=new bt({name:e.name,data:e.data,location:t,size:e.size,offset:e.offset,_e:e._e||G,divisor:e.divisor});this.attributes.push(i),this.ti.setAttribute(i)}#t({$e:e}){this.attributes.forEach(((e,t)=>{e.location=t,e.divisor=0})),this.ti=new Ut({$e:e,attributes:this.attributes,He:this.He})}start(){this.ti||this.#t({$e:this.$e})}update(){this.ti||this.#t({$e:this.$e})}ii(e,t){const i=this.attributes.find((({name:t})=>t===e));i&&(i.data=t,this.ti.ct(e,i.data))}getAttribute(e){return this.attributes.find((({name:t})=>t===e))}ri(){return this.attributes.map((e=>e.getDescriptor()))}static si(e){const t=[],i=[];for(let r=0;r<e.length/3;r++){const s=e[3*r+0],n=e[3*r+1],a=e[3*r+2],o=new It(s,n,a),u=It.Kt(o),l=It.Zt(u,o);t.push(...u.elements),i.push(...l.elements)}return{ni:t,ai:i}}static oi(e,t){const i=[];for(let r=0;r<e.length/3;r++){const s=new It(e[3*r+0],e[3*r+1],e[3*r+2]),n=new It(t[3*r+0],t[3*r+1],t[3*r+2]),a=It.Zt(n,s);i.push(...a.elements)}return i}}function Nt(e){const t=function({ui:e,li:t,hi:i,width:r=2,height:s=2,offset:n=It.Ot}){const a=[0,0,1,0,0,1,0,0,1,0,0,1],o=r/2,u=s/2,l=new Float32Array([-o+n.x,u+n.y,0+n.z,-o+n.x,-u+n.y,0+n.z,o+n.x,u+n.y,0+n.z,o+n.x,-u+n.y,0+n.z]),h=new Float32Array(i?[0,0,0,1,1,0,1,1]:[0,1,0,0,1,1,1,0]),c=new Float32Array(a);let f=new Float32Array,m=new Float32Array;if(e||t){const i=Vt.si(a);e&&(f=new Float32Array(i.ni)),t&&(m=new Float32Array(i.ai))}return{ci:l,fi:h,mi:c,ni:f,ai:m,He:[0,1,2,2,1,3],qt:6}}(e),i=[new bt({name:H,data:t.ci,size:3}),new bt({name:W,data:t.fi,size:2}),new bt({name:X,data:t.mi,size:3})];return e.ui&&i.push(new bt({name:J,data:t.ni,size:3})),e.li&&i.push(new bt({name:Y,data:t.ai,size:3})),{attributes:i,He:[0,1,2,2,1,3],qt:6}}class Et extends Vt{constructor({$e:e,...t}){const{attributes:i,He:r,qt:s}=Nt(t);super({$e:e,attributes:i,He:r,qt:s})}}class At extends Ct{#i;#r=[];#s;get pi(){return this.#r}get Ge(){return this.#i}get vi(){return this.#r.length>=2}di(e){this.#r.push(e)}constructor({$e:e}){super(),this.#s=e;const t=this.#s.We.createFramebuffer();this.#i=t}bind(){const e=this.#s.We;e.bindFramebuffer(e.FRAMEBUFFER,this.#i)}je(){const e=this.#s.We;e.bindFramebuffer(e.FRAMEBUFFER,null)}}class Ft extends Ct{#s;#n;#a;get Ge(){return this.#a}constructor({$e:e,type:t,width:i,height:r}){super(),this.#s=e,this.#n=t;const s=this.#s.We,n=s.createRenderbuffer();if(this.#a=n,s.bindRenderbuffer(s.RENDERBUFFER,this.#a),this.#n!==g)throw"[Renderbuffer.constructor] invalid render buffer type.";s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,i,r),s.bindRenderbuffer(s.RENDERBUFFER,null)}it(e,t){const i=this.#s.We;if(i.bindRenderbuffer(i.RENDERBUFFER,this.#a),this.#n===g)i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t);i.bindRenderbuffer(i.RENDERBUFFER,null)}}class Ot{constructor({gi:e=!1}={gi:!1}){this.gi=e}get read(){}get write(){}}class _t extends Ot{constructor({$e:e,name:t="",type:i=E,width:r=1,height:s=1,xi:n=!1,yi:a=!1,Ke:o=V,Ze:u=V,qe:l=U,Qe:h=U,Ye:c=!1,et:f}){super(),this.Ti=null,this.wi=null,this.Si=null,this.$e=e;const m=this.$e.We;switch(this.name=t,this.type=i,this.width=r,this.height=s,this.bi=new At({$e:e}),this.bi.bind(),n&&(this.Ti=new Ft({$e:e,type:g,width:r,height:s})),this.Ti&&m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,this.Ti.Ge),this.type){case E:this.wi=new Pt({$e:e,width:this.width,height:this.height,Ye:c,type:M,Ke:o,Ze:u,Qe:h,qe:l}),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,this.wi.Ge,0);break;case O:if(!e.Ci(Tt))return;this.wi=new Pt({$e:e,width:this.width,height:this.height,Ye:c,type:z,Ke:o,Ze:u,Qe:h,qe:l}),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,this.wi.Ge,0);break;case _:if(!e.Ci(Tt))return;this.wi=new Pt({$e:e,width:this.width,height:this.height,Ye:c,type:R,Ke:o,Ze:u,Qe:h,qe:l}),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,this.wi.Ge,0);break;case k:this.wi=new Pt({$e:e,width:this.width,height:this.height,Ye:c,type:L,Ke:o,Ze:u,Qe:h,qe:l}),m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,this.wi.Ge,0)}if(this.wi){if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==yt)throw"framebuffer not completed";this.bi.di(xt)}if((this.type===A||a)&&(this.Si=new Pt({$e:e,width:this.width,height:this.height,Ye:!1,type:P,Ke:o,Ze:u,Qe:h,qe:l,et:f}),m.framebufferTexture2D(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.TEXTURE_2D,this.Si.Ge,0)),this.Si&&this.Ti)throw"[RenderTarget.constructor] depth texture and depth render buffer are active.";m.bindTexture(m.TEXTURE_2D,null),this.Ti&&m.bindRenderbuffer(m.RENDERBUFFER,null),this.bi.je()}get tt(){return this.wi}get Mi(){return this.Si}get framebuffer(){return this.bi}get read(){return this}get write(){return this}it(e,t){this.width=Math.floor(e),this.height=Math.floor(t),this.wi&&this.wi.it(this.width,this.height),this.Si&&this.Si.it(this.width,this.height),this.Ti&&this.Ti.it(e,t)}Pi(e){const t=this.$e.We;this.wi=e,t.bindFramebuffer(t.FRAMEBUFFER,this.bi.Ge),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.wi.Ge,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}zi(e){const t=this.$e.We;this.Si=e,this.bi.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.Si.Ge,0),this.bi.je()}static Di({$e:e,Ri:t,Li:i,width:r,height:s}){const n=e.We;n.bindFramebuffer(n.READ_FRAMEBUFFER,t.framebuffer.Ge),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,i.framebuffer.Ge),n.clear(n.DEPTH_BUFFER_BIT),n.checkFramebufferStatus(n.READ_FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE&&(n.blitFramebuffer(0,0,r,s,0,0,r,s,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null))}}function kt(e,t,i){const r=e.createShader(t);e.shaderSource(r,i),e.compileShader(r);const s=e.getShaderInfoLog(r);return s&&s.length,r}class Gt extends Ct{constructor({$e:e,Bi:t,Ui:i,transformFeedbackVaryings:r}){super(),this.$e=e;const{We:s}=e,n=s.createProgram(),a=kt(s,s.VERTEX_SHADER,t);s.attachShader(n,a);const o=kt(s,s.FRAGMENT_SHADER,i);s.attachShader(n,o),r&&r.length>0&&s.transformFeedbackVaryings(n,r,s.SEPARATE_ATTRIBS),s.linkProgram(n);const u=s.getProgramInfoLog(n);if(u&&u.length>0)throw u;this.Ii=n}get Ge(){return this.Ii}dispose(){this.$e.We.deleteShader(this.Ii),this.Ii=null}static Vi(e,t,i){return`${i}\n            \n---\n\n${e}\n\n---\n            \n${t.split("\n").map(((e,t)=>`${t+1}: ${e}`)).join("\n")}       \n`}}class jt{constructor(e,t,i,r,s,n,a,o,u,l,h,c,f,m,p,v){this.elements=new Float32Array(16),this.set(e,t,i,r,s,n,a,o,u,l,h,c,f,m,p,v)}get Bt(){return this.elements[0]}get Ut(){return this.elements[4]}get It(){return this.elements[8]}get Vt(){return this.elements[12]}get Nt(){return this.elements[1]}get m11(){return this.elements[5]}get m12(){return this.elements[9]}get m13(){return this.elements[13]}get Et(){return this.elements[2]}get m21(){return this.elements[6]}get m22(){return this.elements[10]}get m23(){return this.elements[14]}get Ni(){return this.elements[3]}get m31(){return this.elements[7]}get m32(){return this.elements[11]}get m33(){return this.elements[15]}set Bt(e){this.elements[0]=e}set Ut(e){this.elements[4]=e}set It(e){this.elements[8]=e}set Vt(e){this.elements[12]=e}set Nt(e){this.elements[1]=e}set m11(e){this.elements[5]=e}set m12(e){this.elements[9]=e}set m13(e){this.elements[13]=e}set Et(e){this.elements[2]=e}set m21(e){this.elements[6]=e}set m22(e){this.elements[10]=e}set m23(e){this.elements[14]=e}set Ni(e){this.elements[3]=e}set m31(e){this.elements[7]=e}set m32(e){this.elements[11]=e}set m33(e){this.elements[15]=e}get position(){return new It(this.Vt,this.m13,this.m23)}set(e,t,i,r,s,n,a,o,u,l,h,c,f,m,p,v){return this.elements=new Float32Array([e,s,u,f,t,n,l,m,i,a,h,p,r,o,c,v]),this}static get identity(){return new jt(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}Ei(e){return this.Vt=e.x,this.m13=e.y,this.m23=e.z,this}static Ai(e){return new jt(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1)}static Fi(e){return new jt(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)}static Oi(e){const t=Math.cos(e),i=Math.sin(e);return new jt(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1)}static _i(e){const t=Math.cos(e),i=Math.sin(e);return new jt(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1)}static ki(e){const t=Math.cos(e),i=Math.sin(e);return new jt(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1)}static Gi(...e){const t=jt.identity;return e.forEach((e=>t.multiply(e))),t}multiply(e){const t=this.elements,i=e.elements,r=t[0],s=t[4],n=t[8],a=t[12],o=t[1],u=t[5],l=t[9],h=t[13],c=t[2],f=t[6],m=t[10],p=t[14],v=t[3],d=t[7],g=t[11],x=t[15],y=i[0],T=i[4],w=i[8],S=i[12],b=i[1],C=i[5],M=i[9],P=i[13],z=i[2],D=i[6],R=i[10],L=i[14],B=i[3],U=i[7],I=i[11],V=i[15],N=new jt(r*y+s*b+n*z+a*B,r*T+s*C+n*D+a*U,r*w+s*M+n*R+a*I,r*S+s*P+n*L+a*V,o*y+u*b+l*z+h*B,o*T+u*C+l*D+h*U,o*w+u*M+l*R+h*I,o*S+u*P+l*L+h*V,c*y+f*b+m*z+p*B,c*T+f*C+m*D+p*U,c*w+f*M+m*R+p*I,c*S+f*P+m*L+p*V,v*y+d*b+g*z+x*B,v*T+d*C+g*D+x*U,v*w+d*M+g*R+x*I,v*S+d*P+g*L+x*V);return this.Mt(N),this}Mt(e){return this.Bt=e.Bt,this.Ut=e.Ut,this.It=e.It,this.Vt=e.Vt,this.Nt=e.Nt,this.m11=e.m11,this.m12=e.m12,this.m13=e.m13,this.Et=e.Et,this.m21=e.m21,this.m22=e.m22,this.m23=e.m23,this.Ni=e.Ni,this.m31=e.m31,this.m32=e.m32,this.m33=e.m33,this}clone(){const e=jt.identity;return e.Bt=this.Bt,e.Ut=this.Ut,e.It=this.It,e.Vt=this.Vt,e.Nt=this.Nt,e.m11=this.m11,e.m12=this.m12,e.m13=this.m13,e.Et=this.Et,e.m21=this.m21,e.m22=this.m22,e.m23=this.m23,e.Ni=this.Ni,e.m31=this.m31,e.m32=this.m32,e.m33=this.m33,e}ji(){const e=this.Ut,t=this.Nt;this.Ut=t,this.Nt=e;const i=this.It,r=this.Et;this.It=r,this.Et=i;const s=this.Vt,n=this.Ni;this.Vt=n,this.Ni=s;const a=this.m12,o=this.m21;this.m12=o,this.m21=a;const u=this.m13,l=this.m31;this.m13=l,this.m31=u;const h=this.m23,c=this.m32;return this.m23=c,this.m32=h,this}$i(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],a=e[5],o=e[6],u=e[7],l=e[8],h=e[9],c=e[10],f=e[11],m=e[12],p=e[13],v=e[14],d=e[15],g=h*v*u-p*c*u+p*o*f-a*v*f-h*o*d+a*c*d,x=m*c*u-l*v*u-m*o*f+n*v*f+l*o*d-n*c*d,y=l*p*u-m*h*u+m*a*f-n*p*f-l*a*d+n*h*d,T=m*h*o-l*p*o-m*a*c+n*p*c+l*a*v-n*h*v,w=t*g+i*x+r*y+s*T;if(0===w)return new jt(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/w;return e[0]=g*S,e[1]=(p*c*s-h*v*s-p*r*f+i*v*f+h*r*d-i*c*d)*S,e[2]=(a*v*s-p*o*s+p*r*u-i*v*u-a*r*d+i*o*d)*S,e[3]=(h*o*s-a*c*s-h*r*u+i*c*u+a*r*f-i*o*f)*S,e[4]=x*S,e[5]=(l*v*s-m*c*s+m*r*f-t*v*f-l*r*d+t*c*d)*S,e[6]=(m*o*s-n*v*s-m*r*u+t*v*u+n*r*d-t*o*d)*S,e[7]=(n*c*s-l*o*s+l*r*u-t*c*u-n*r*f+t*o*f)*S,e[8]=y*S,e[9]=(m*h*s-l*p*s-m*i*f+t*p*f+l*i*d-t*h*d)*S,e[10]=(n*p*s-m*a*s+m*i*u-t*p*u-n*i*d+t*a*d)*S,e[11]=(l*a*s-n*h*s-l*i*u+t*h*u+n*i*f-t*a*f)*S,e[12]=T*S,e[13]=(l*p*r-m*h*r+m*i*c-t*p*c-l*i*v+t*h*v)*S,e[14]=(m*a*r-n*p*r-m*i*o+t*p*o+n*i*v-t*a*v)*S,e[15]=(n*h*r-l*a*r+l*i*o-t*h*o-n*i*c+t*a*c)*S,this}static Hi(e,t,i,r,s,n){return new jt(2/(t-e),0,0,-(t+e)/(t-e),0,2/(r-i),0,-(r+i)/(r-i),0,0,-2/(n-s),-(n+s)/(n-s),0,0,0,1)}static Wi(e,t,i,r){const s=1/Math.tan(e/2),n=jt.identity;if(n.Bt=s/t,n.Nt=0,n.Et=0,n.Ni=0,n.Ut=0,n.m11=s,n.m21=0,n.m31=0,n.It=0,n.m12=0,n.m32=-1,n.Vt=0,n.m13=0,n.m33=0,null!=r&&r!==1/0){const e=1/(i-r);n.m22=(r+i)*e,n.m23=2*r*i*e}else n.m22=-1,n.m23=-2*i;return n}static Xi(e,t,i=new It(0,1,0),r=!1){const s=r?It.Ht(e,t).normalize():It.Ht(t,e).normalize(),n=It.Wt(i.normalize(),s).normalize(),a=It.Wt(s,n);return new jt(n.x,a.x,s.x,e.x,n.y,a.y,s.y,e.y,n.z,a.z,s.z,e.z,0,0,0,1)}static Ji(e,t,i){const r=t.Yi();return jt.Gi(jt.Ai(e),jt._i(r.y),jt.Oi(r.x),jt.ki(r.z),jt.Fi(i))}static Ki(e){const t=e.Zi();return jt.Gi(jt._i(t.y),jt.Oi(t.x),jt.ki(t.z))}static jt(e){return new jt(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}log(){}Qi(){return`--------------------\n${this.Bt}, ${this.Ut}, ${this.It}, ${this.Vt},\n${this.Nt}, ${this.m11}, ${this.m12}, ${this.m13},\n${this.Et}, ${this.m21}, ${this.m22}, ${this.m23},\n${this.Ni}, ${this.m31}, ${this.m32}, ${this.m33},\n--------------------`}}const $t={[dt.re]:"float viewZToLinearDepth(float z, float near, float far) {\r\n    return (z + near) / (near - far);\r\n}\n\nfloat viewZToPerspectiveDepth(float viewZ, float near, float far) {\r\n    return((near + viewZ) * far) / ((far - near) * viewZ);\r\n}\n\nfloat perspectiveDepthToLinearDepth(float rawDepth, float near, float far) {\r\n    float nz = near * rawDepth;\r\n    return -nz / (far * (rawDepth - 1.) - nz);\r\n}\n\nfloat perspectiveDepthToEyeDepth(float rawDepth, float near, float far) {\r\n    float depth = perspectiveDepthToLinearDepth(rawDepth, near, far);\r\n    return mix(near, far, depth);\r\n}\r\n\nfloat ndcZToRawDepth(float ndcZ) {\r\n    return ndcZ * .5 + .5;\r\n}\n\nfloat ndcZToLinearDepth(float ndcZ, float near, float far) {\r\n    float rawDepth = ndcZToRawDepth(ndcZ);\r\n    return perspectiveDepthToLinearDepth(rawDepth, near, far);\r\n}\n\nfloat clipPositionToLinearDepth(vec4 clipPosition, float near, float far) {\r\n    float z = clipPosition.z / clipPosition.w; \n    return ndcZToLinearDepth(z, near, far);\r\n}\n\nvec3 reconstructWorldPositionFromDepth(vec2 screenUV, float rawDepth, mat4 inverseViewProjectionMatrix) {\r\n    \n    vec4 clipPos = vec4(screenUV * 2. - 1., rawDepth * 2. - 1., 1.);\r\n    vec4 worldPos = inverseViewProjectionMatrix * clipPos;\r\n    return worldPos.xyz / worldPos.w;\r\n}\n\nvec3 reconstructViewPositionFromDepth(vec2 screenUV, float rawDepth, mat4 inverseProjectionMatrix) {\r\n    \n    vec4 clipPos = vec4(screenUV * 2. - 1., rawDepth * 2. - 1., 1.);\r\n    vec4 viewPos = inverseProjectionMatrix * clipPos;\r\n    return viewPos.xyz / viewPos.w;\r\n}\n\nfloat sampleRawDepthByViewPosition(\r\n    sampler2D depthTexture,\r\n    vec3 viewPosition,\r\n    mat4 projectionMatrix,\r\n    vec3 offset\r\n) {\r\n    vec4 offsetPosition = vec4(viewPosition + offset, 1.);\r\n    vec4 projectedPosition = projectionMatrix * offsetPosition;\r\n    vec3 projectedPositionNDC = projectedPosition.xyz / projectedPosition.w;\r\n    vec2 projectedPositionUV = projectedPositionNDC.xy * .5 + .5;\r\n    \n    return textureLod(depthTexture, projectedPositionUV, 0.).x;\r\n}",[dt.se]:"layout (std140) uniform ubCommon {\r\n    float uTime;\r\n    vec4 uViewport;\r\n};",[dt.ne]:"layout (std140) uniform ubTransformations {\r\n    mat4 uWorldMatrix;\r\n    mat4 uViewMatrix;\r\n    mat4 uProjectionMatrix;\r\n    mat4 uNormalMatrix;\r\n    mat4 uInverseWorldMatrix;\n\n    mat4 uViewProjectionMatrix;\r\n    mat4 uInverseViewMatrix;\r\n    mat4 uInverseProjectionMatrix;\r\n    mat4 uInverseViewProjectionMatrix;\r\n    mat4 uTransposeInverseViewMatrix;\r\n};",[dt.ae]:"layout (std140) uniform ubCamera {\r\n    vec3 uViewPosition;\r\n    vec3 uViewDirection;\r\n    float uNearClip;\r\n    float uFarClip;\r\n    float uAspect;\r\n    float uFov;\r\n};",[dt.oe]:"vec4 encodePseudoHDR(vec3 color) {\r\n    float base = .25;\r\n    float l = max(max(color.r, color.g), max(color.b, base));\r\n    return vec4(\r\n        color.r / l,\r\n        color.g / l,\r\n        color.b / l,\r\n        base / l\r\n    );\r\n}\n\nvec4 decodePseudoHDR(vec4 encodedColor) {\r\n    float base = .25;\r\n    float rl = encodedColor.a;\r\n    return vec4(\r\n        (encodedColor.r / rl) * base,\r\n        (encodedColor.g / rl) * base,\r\n        (encodedColor.b / rl) * base,\r\n        rl * base\r\n    );\r\n}"},Ht=({qi:e,er:t,tr:i,ir:r,rr:s,sr:n,nr:a,ar:o,ur:u})=>{const l=[];return e&&l.push("#define USE_RECEIVE_SHADOW"),t&&(i?l.push("#define USE_SKINNING_GPU"):l.push("#define USE_SKINNING_CPU")),r&&l.push("#define USE_NORMAL_MAP"),s&&l.push("#define USE_ENV_MAP"),n&&l.push("#define USE_VERTEX_COLOR"),a&&l.push("#define USE_ALPHA_TEST"),o&&l.push("#define USE_INSTANCING"),u&&l.push("#define USE_INSTANCE_LOOK_DIRECTION"),l},Wt=(e,t,i,r)=>{let s=e;return s=s.replaceAll(new RegExp(`#pragma ${gt.ue}`,"g"),(()=>Ht(i).join("\n"))),s=s.replaceAll(new RegExp(`#pragma ${gt.le}`,"g"),(()=>{const e=(e=>[...e].sort(((e,t)=>e.location-t.location)).map((({location:e,size:t,name:i,ke:r})=>{let s;switch(r){case Float32Array:switch(t){case 1:s="float";break;case 2:s="vec2";break;case 3:s="vec3";break;case 4:s="vec4";break;default:throw"[buildVertexAttributeLayouts] invalid attribute float"}break;case Uint16Array:switch(t){case 1:s="uint";break;case 2:s="uvec2";break;case 3:s="uvec3";break;case 4:s="uvec4";break;default:throw"[buildVertexAttributeLayouts] invalid attribute int"}break;default:throw"[buildVertexAttributeLayouts] invalid attribute data type"}return`layout(location = ${e}) in ${s} ${i};`})))(t);return e.join("\n")})),Object.values(pt).forEach((e=>{const t=e;s=s.replaceAll(new RegExp(`#pragma ${t}`,"g"),(()=>r[t]&&r[t]||""))})),Object.values(dt).forEach((e=>{const t=e;s=s.replaceAll(new RegExp(`#pragma ${t}`,"g"),(()=>$t[t]))})),s};class Xt{constructor(...e){this.lr=[],this.data=[];for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++){const r=e[t][i],s=this.data.findIndex((e=>e.name===r.name));s<0?this.data.push(r):this.data[s].value=r.value}}find(e){return this.data.find((t=>t.name===e))}hr(e,t,i){this.data.push({name:e,type:t,value:i})}cr(e,t,i=!1){const r=this.find(e);r&&(r.type===ae?t.forEach((e=>{const t=r.value.findIndex((t=>t.name===e.name));t>=0&&(r.value[t].value=e.value)})):r.type===oe?t.forEach(((e,t)=>{e.forEach((e=>{const i=r.value[t].findIndex((t=>t.name===e.name));i>=0&&(r.value[t][i].value=e.value)}))})):r.value=t)}mr(){}pr(e,t,i){this.lr.push({vr:e,dr:t,data:i})}}const Jt=0;class Yt{constructor({name:e="",type:t=Jt,Bi:i="",Ui:r="",gr:s,yr:a,Tr:u,wr:f,Sr:p,br:g,Cr:x,Mr:y,primitiveType:T,Pr:w=!0,zr:b=!0,Dr:C=!1,Rr:M=o,Lr:P=null,Br:z=S,qi:D=!1,Ur:R=l,Ir:L,ir:B=null,er:U=null,tr:I=null,Vr:V=null,ar:N=!1,ur:E=!1,sr:A=!1,rr:F=!1,Nr:O,Er:_=[],Ar:k=[],Fr:G=[],Or:j=!1}){if(this.name="",this.type=Jt,this._r=null,this.Ar=[],this.kr=!1,this.gr=null,this.yr=null,this.Tr=null,this.Gr=null,this.wr=null,this.Sr=null,this.br=null,this.jr={},this.$r={},this.Hr=!1,this.name=e||"",this.type=t,this.Bi=i||"",this.Ui=r||"",s&&(this.gr=s),a&&(this.yr=a),u&&(this.Tr=u),f&&(this.wr=f),p&&(this.Sr=p),g&&(this.br=g),x&&(this.jr=x),y&&(this.$r=y),this.primitiveType=T||n,this.Ur=R||l,this.Pr=!!w,this.zr=!!b,this.Rr=M,this.Dr=!!C,this.Lr="number"==typeof P?P:null,this.Br=z||S,this.qi=!!D,L)this.Ir=L;else switch(this.Ur){case l:this.Ir=d[m];break;case h:case c:this.Ir=d[v]}this.Ir,this.er=!!U,this.tr=!!I,this.Vr="number"==typeof V?V:null,this.ar=!!N,this.ur=!!E,this.sr=!!A,this.ir=!!B,this.rr=!!F;const $=[{name:Te,type:Z,value:jt.identity},{name:Fe,type:ue,value:0},...this.Lr?[{name:"uAlphaTestThreshold",type:ue,value:this.Lr}]:[]],H=(this.qi,[]);this.Nr=O||null,this.Er=new Xt($,H,_),this.Fr=new Xt($,G),this.Ar=k,this.Or=j}get Wr(){return!!this._r}get Cr(){return this.jr}get Mr(){return this.$r}get nr(){return null!==this.Lr}start({$e:e,Xr:t}){!this.gr&&this.br&&(this.gr=this.br());const i={qi:!!this.qi,er:!!this.er,tr:!!this.tr,ir:!!this.ir,rr:!!this.rr,Jr:!!this.qi,sr:!!this.sr,ar:!!this.ar,nr:!!this.Lr,ur:!!this.ur};if(!this.yr){!this.Bi&&this.wr&&(this.Bi=this.wr({Xr:t,er:!!this.er,Vr:this.Vr,tr:this.tr,ar:this.ar,ur:this.ur}));const e=Wt(this.Bi,t,i,this.Cr);this.yr=e}if(!this.Tr){!this.Ui&&this.Sr&&(this.Ui=this.Sr({Xr:t}));const e=((e,t,i)=>{let r=e;return r=r.replaceAll(new RegExp(`#pragma ${gt.ue}`,"g"),(()=>Ht(t).join("\n"))),Object.values(vt).forEach((e=>{const t=e;r=r.replaceAll(new RegExp(`#pragma ${t}`,"g"),(()=>i[t]&&i[t]||""))})),Object.values(dt).forEach((e=>{const t=e;r=r.replaceAll(new RegExp(`#pragma ${t}`,"g"),(()=>$t[t]))})),r})(this.Ui,i,this.Mr);this.Tr=e}this.Or,this._r=new Gt({$e:e,Bi:this.yr,Ui:this.Tr})}Yr(){}}class Kt{constructor(e,t,i,r){this.elements=new Float32Array(4),this.set(e,t,i,r)}get x(){return this.elements[0]}get y(){return this.elements[1]}get z(){return this.elements[2]}get w(){return this.elements[3]}set(e,t,i,r){return this.elements=new Float32Array([e,t,i,r]),this}Mt(e){return this.elements=new Float32Array(e.elements),this}Kr(){const e=this.x,t=this.y,i=this.z,r=this.w;return new jt(2*r*r+2*e*e-1,2*e*t-2*i*r,2*e*i+2*t*r,0,2*e*t+2*i*r,2*r*r+2*t*t-1,2*t*i-2*e*r,0,2*e*i-2*t*r,2*t*i+2*e*r,2*r*r+2*i*i-1,0,0,0,0,1)}static Zr(e){const t=e.Bt,i=e.m11,r=e.m22,s=t+i+r;let n=0,a=0,o=0,u=0;if(s>0){const t=2*Math.sqrt(s+1);u=.25*t,n=(e.m21-e.m12)/t,a=(e.It-e.Et)/t,o=(e.Nt-e.Ut)/t}else if(t>i&&t>r){const s=2*Math.sqrt(1+t-i-r);u=(e.m21-e.m12)/s,n=.25*s,a=(e.Ut+e.Nt)/s,o=(e.It+e.Et)/s}else if(i>r){const s=2*Math.sqrt(1+i-t-r);u=(e.It-e.Et)/s,n=(e.Ut+e.Nt)/s,a=.25*s,o=(e.m12+e.m21)/s}else{const s=2*Math.sqrt(1+r-t-i);u=(e.Nt-e.Ut)/s,n=(e.It+e.Et)/s,a=(e.m12+e.m21)/s,o=.25*s}return new Kt(n,a,o,u)}Zi(){const e=this.x,t=this.y,i=this.z,r=this.w,s=r*e,n=r*t,a=r*i,o=r*r,u=e*e,l=e*t,h=e*i,c=t*t,f=t*i,m=i*i,p=0===Math.cos(e);return{x:(v=2*f+2*s,v>=1?Math.PI/2:v<=-1?-Math.PI/2:Math.asin(v)),y:p?0:Math.atan2(-(2*h-2*n),2*o+2*m-1),z:p?Math.atan2(2*l+2*a,2*o+2*u-1):Math.atan2(-(2*l-2*a),2*o+2*c-1)};var v}Qr(){const e=this.Zi();return{x:180*e.x/Math.PI,y:180*e.y/Math.PI,z:180*e.z/Math.PI}}static qr(e,t,i){const r=Math.cos(e/2),s=Math.sin(e/2),n=Math.cos(t/2),a=Math.sin(t/2),o=Math.cos(i/2),u=Math.sin(i/2);return new Kt(s*n*o+r*a*u,r*a*o-s*n*u,r*n*u+s*a*o,r*n*o-s*a*u)}static es(e,t,i){return Kt.qr(e*Math.PI/180,t*Math.PI/180,i*Math.PI/180)}ts(){const e=this.x,t=this.y,i=this.z,r=this.w,s=r*e,n=r*t,a=r*i,o=e*e,u=e*t,l=e*i,h=t*t,c=t*i,f=i*i;return new jt(1-2*(h+f),2*(u-a),2*(l+n),0,2*(u+a),1-2*(o+f),2*(c-s),0,2*(l-n),2*(c+s),1-2*(o+h),0,0,0,0,1)}rs(){return new Kt(-this.x,-this.y,-this.z,this.w)}static identity(){return new Kt(0,0,0,1)}}class Zt{constructor(e){this.ss=null,this.quaternion=Kt.identity(),this.quaternion=e}get x(){return this.quaternion.Qr().x}get y(){return this.quaternion.Qr().y}get z(){return this.quaternion.Qr().z}set x(e){const t=this.quaternion.Qr();t.x=e;const i=Kt.es(t.x,t.y,t.z);this.quaternion=i}set y(e){const t=this.quaternion.Qr();t.y=e;const i=Kt.es(t.x,t.y,t.z);this.quaternion=i}set z(e){const t=this.quaternion.Qr();t.z=e;const i=Kt.es(t.x,t.y,t.z);this.quaternion=i}get ns(){return this.quaternion.Qr().z}get pitch(){return this.quaternion.Qr().x}get os(){return this.quaternion.Qr().y}Yi(){const e=this.quaternion.Zi();return{x:e.x,y:e.y,z:e.z}}us(e,t,i){const r=Kt.es(e,t,i);return this.quaternion=r,this}ls(e){const t=Kt.es(e.x,e.y,e.z);return this.quaternion=t,this}Mt(e){return this.quaternion.Mt(e.quaternion),this}static get Ot(){const e=Kt.es(0,0,0);return new Zt(e)}hs(e){const t=this.quaternion.Qr();t.x=e;const i=Kt.es(t.x,t.y,t.z);this.quaternion=i}cs(e){const t=this.quaternion.Qr();t.y=e;const i=Kt.es(t.x,t.y,t.z);this.quaternion=i}fs(e){const t=this.quaternion.Qr();t.z=e;const i=Kt.es(t.x,t.y,t.z);this.quaternion=i}$i(){const e=(this.x+180)%360,t=(this.y+180)%360,i=(this.z+180)%360,r=Kt.es(e,t,i);return new Zt(r)}static Ki(e){return new Zt(e)}static ps(e){const t=Kt.identity(),i=new Zt(t);return i.ss=e,i}}class Qt{constructor(e){this.#o=jt.identity,this.#u=jt.identity,this.#l=jt.identity,this.position=It.Ot,this.rotation=Zt.Ot,this.scale=It._t,this.vs=null,this.#h=jt.identity,this.ds=e}#o;#u;#l;#h;get gs(){return this.#o}get xs(){return this.#u}get ys(){return this.#h}get Ts(){return this.#l}get ws(){return this.#u.position}get Ss(){return new It(this.#u.Bt,this.#u.Nt,this.#u.Et).normalize()}get bs(){return new It(this.#u.Ut,this.#u.m11,this.#u.m21).normalize()}get Cs(){return new It(this.#u.It,this.#u.m12,this.#u.m22).normalize()}Ms(){if(this.vs){const e=this.ds.type===y.C?jt.Xi(this.position,this.vs,It.kt,!0):jt.Xi(this.position,this.vs),t=jt.Fi(this.scale);this.#l=jt.Gi(e,t)}else{const e=jt.Ai(this.position),t=this.rotation.quaternion.Kr(),i=jt.Fi(this.scale);this.#l=jt.Gi(e,t,i)}this.#u=this.ds.parent?jt.Gi(this.ds.parent.transform.xs,this.#l):this.#l,this.#o=this.#u.clone().$i(),this.#h=this.#u.clone().$i().ji()}Ps(e){this.scale=e}hs(e){this.rotation.hs(e)}cs(e){this.rotation.cs(e)}fs(e){this.rotation.fs(e)}Ei(e){this.position=e}zs(e){this.vs=e}}class qt{constructor(e=[]){this.Ds=null,this.Rs=e}get Ls(){return this.Rs}Bs(e){this.Rs=e}play(e,t=!1){const i=this.Rs.find((t=>e===t.name));i&&(i.play(),i.loop=t,this.Ds=i)}update(e){this.Ds&&(this.Ds.loop=!0,this.Ds.update(e))}}class ei{constructor({name:e="",type:t=y.p}={}){this.Us=!1,this.parent=null,this.children=[],this.Is=[],this.Vs=null,this.Ns=null,this.Es=null,this.As=!0,this.name=e,this.transform=new Qt(this),this.type=t||y.p,this.uuid=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),this.Fs=new qt}get Os(){return this.children.length}get _s(){return this.Os>0}set enabled(e){this.As=e}get enabled(){return this.As}ks(e){this.Is.push(e)}set Gs(e){this.Vs=e}set js(e){this.Ns=e}set $s(e){this.Es=e}Hs(e){this.children.push(e),e.parent=this}it(e,t){}#c({$e:e}){this.Us||(this.Us=!0,this.start({$e:e}))}Ws(e){this.transform.Ms()}start({$e:e}){this.Is.forEach((t=>{t({ds:this,$e:e})}))}Xs({$e:e,Js:t,Ys:i}){this.#c({$e:e}),this.Fs&&this.Fs.update(i),this.Vs&&this.Vs({ds:this,$e:e,Js:t,Ys:i})}update({$e:e,time:t,Ks:i}){this.#c({$e:e}),this.Ns&&this.Ns({ds:this,$e:e,time:t,Ks:i})}Zs({$e:e,time:t,Ks:i}){this.#c({$e:e}),this.Es&&this.Es({ds:this,$e:e,time:t,Ks:i})}Qs({$e:e}){}}class ti extends ei{constructor({name:e,qs:t,en:i,tn:r=[],rn:s,sn:n,nn:a=!1,an:o=!1,on:u=!0}){super({name:e,type:n||y.v}),this.tn=[],this.qs=t,this.tn=i?[i]:r||[],this.rn=s||null,this.nn=!!a,this.an=!!o,this.on=!!u}get en(){return this.un,this.ln}set en(e){this.tn=[e]}get ln(){return this.tn[0]}get un(){return this.tn.length>1}start({$e:e}){super.start({$e:e}),this.qs.start(),this.tn.forEach((t=>{t.Wr||t.start({$e:e,Xr:this.qs.ri()})})),!this.rn&&this.on&&(this.rn=new Yt({name:`${this.en.name}/depth`,Bi:this.ln.yr,Ui:this.ln.gr||"#version 300 es\nprecision mediump float;out vec4 outColor;void main(){outColor=vec4(1);}",Er:this.ln.Fr.data,Br:this.ln.Br,Pr:!0,zr:!0,Rr:o,Lr:this.ln.Lr,Dr:!!this.ln.Dr,Ar:this.ln.Ar})),this.rn&&!this.rn.Wr&&this.rn.start({$e:e,Xr:this.qs.ri()})}hn(e){}cn(e){}}class ii{constructor({$e:e,type:t,parameters:i,Bi:r,Ui:s,yr:a,Tr:o,Er:u=[],Ar:l=[],rr:h=!1,qi:c=!1,name:f="",fn:m=E,Ke:p=V,Ze:v=V,qe:d=U,Qe:g=U,mn:x=!0}){this.width=1,this.height=1,this.tn=[],this.Qs=null,this.name=f,this.type=t,this.parameters={...i,enabled:i.enabled||!0};r=r||ii.pn,this.qs=new Et({$e:e}),this.en=new Yt({name:f,Bi:r,Ui:s,yr:a,Tr:o,Er:[...u,...ii.vn,...x?[{name:Ae,type:q,value:null}]:[]],Ar:l,rr:!!h,qi:!!c,primitiveType:n}),this.tn.push(this.en),this.dn=new ti({qs:this.qs,en:this.en}),this.gn=new _t({$e:e,width:1,height:1,type:m,Ke:p,Ze:v,Qe:g,qe:d})}get xn(){return this.gn}static get pn(){return"#version 300 es\n#pragma DEFINES\n#pragma ATTRIBUTES\nout vec2 vUv;void main(){vUv=aUv;gl_Position=vec4(aPosition,1);}"}static get vn(){return[{name:_e,type:ue,value:1},{name:ke,type:ue,value:1},{name:Fe,type:ue,value:0}]}it(e,t){this.width=e,this.height=t,this.gn.it(e,t),this.en.Er.cr("uTargetWidth",this.width),this.en.Er.cr("uTargetHeight",this.height)}yn(e,t,i){i?e.yn(t.xn,!0):e.yn(this.gn,!0)}update(){}Tn({$e:e,wn:t,Sn:i,bn:r,Cn:s}){this.yn(i,t,s),this.dn.Ws(),this.tn.forEach((t=>{t.Wr||(t.start({$e:e,Xr:this.qs.ri()}),i.Mn(t))})),r&&this.en.Er.cr(Ae,r.tt),this.Qs&&this.Qs(),i.Pn(this.qs,this.en)}}class ri{constructor(e,t){this.elements=new Float32Array(2),this.set(e,t)}get x(){return this.elements[0]}get y(){return this.elements[1]}set x(e){this.elements[0]=e}set y(e){this.elements[1]=e}set(e,t){return this.elements=new Float32Array([e,t]),this}static get identity(){return new ri(0,0)}static get _t(){return new ri(1,1)}static get Ot(){return new ri(0,0)}static Ht(e,t){return new ri(e.x-t.x,e.y-t.y)}Mt(e){return this.x=e.x,this.y=e.y,this}div(e){return this.x/=e.x,this.y/=e.y,this}log(){}}const si="#version 300 es\nprecision highp float;\n#define saturate(x)clamp(x,0.,1.)\n#define smooth(x)smoothstep(0.,1.,x)\nin vec2 vUv;out vec4 outColor;uniform vec2 uResolution,uGridSize;uniform float uTime;float t(float v){return v*v*v*v*v*6.-v*v*v*v*15.+v*v*v*10.;}vec2 v(vec2 v){v=vec2(dot(v,vec2(127.1,311.7)),dot(v,vec2(269.5,183.3)));return-1.+2.*fract(sin(v)*43758.5453123);}uniform float uTiling,uIsImproved;float t(vec2 x,float u){vec2 s=floor(x),d=fract(x),f=normalize(v(s)),m=normalize(v(s+vec2(1,0))),e=normalize(v(s+vec2(0,1))),g=normalize(v(s+vec2(1)));u=step(.5,u);float y=mix(smooth(d.x),t(d.x),u),r=mix(smooth(d.y),t(d.y),u);return mix(mix(dot(f,d),dot(m,d-vec2(1,0)),y),mix(dot(e,d-vec2(0,1)),dot(g,d-vec2(1)),y),r);}void main(){float v=t(vUv*uGridSize+uTime,uIsImproved);outColor=vec4(vec3(v),1);}",ni=1,ai=2,oi=3,ui=[{key:0,width:512,height:512,zn:"#version 300 es\nprecision highp float;\n#define saturate(x)clamp(x,0.,1.)\n#define smooth(x)smoothstep(0.,1.,x)\nin vec2 vUv;out vec4 outColor;uniform vec2 uResolution,uGridSize;uniform float uTime,uTiling;float v(vec2 v){return fract(tan(distance(v*1.6180339887499,v))*v.x);}void main(){float x=v(floor(vUv*uGridSize)+uTime);outColor=vec4(vec3(x),1);}",Dn:[{name:"uTime",type:ue,value:0},{name:"uGridSize",type:te,value:new ri(512,512)}],Rn:!0,Ln:1,Bn:0,Un:1},{key:ni,width:512,height:512,zn:si,Dn:[{name:"uTime",type:ue,value:0},{name:"uGridSize",type:te,value:new ri(4,4)},{name:"uIsImproved",type:ue,value:0}],Rn:!0,Ln:1,Bn:0,Un:1},{key:ai,width:512,height:512,zn:si,Dn:[{name:"uTime",type:ue,value:0},{name:"uGridSize",type:te,value:new ri(4,4)},{name:"uIsImproved",type:ue,value:1}],Rn:!0,Ln:1,Bn:0,Un:1},{key:oi,width:512,height:512,zn:"#version 300 es\nprecision highp float;\n#define saturate(x)clamp(x,0.,1.)\n#define smooth(x)smoothstep(0.,1.,x)\nin vec2 vUv;out vec4 outColor;uniform vec2 uResolution,uGridSize;uniform float uTime;vec3 v(vec3 v){return v-floor(v*(1./289.))*289.;}vec2 v(vec2 v){return v-floor(v*(1./289.))*289.;}vec3 t(vec3 x){return v((x*34.+1.)*x);}uniform float uTiling;float f(vec2 x){const vec4 u=vec4(.211324865405187,.366025403784439,-.577350269189626,.024390243902439);vec2 f=floor(x+dot(x,u.yy)),d=x-f+dot(f,u.xx),o=vec2(0);o=d.x>d.y?vec2(1,0):vec2(0,1);vec2 y=d.xy+u.xx-o,e=d.xy+u.zz;f=v(f);vec3 z=t(t(f.y+vec3(0,o.y,1))+f.x+vec3(0,o.x,1)),r=max(.5-vec3(dot(d,d),dot(y,y),dot(e,e)),0.);r*=r;r*=r;vec3 m=2.*fract(z*u.www)-1.,w=abs(m)-.5,a=m-floor(m+.5);r*=1.79284291400159-.85373472095314*(a*a+w*w);vec3 s=vec3(0);s.x=a.x*d.x+w.x*d.y;s.yz=a.yz*vec2(y.x,e)+w.yz*vec2(y.y,e.y);return 130.*dot(r,s);}void main(){float v=f(vUv*uGridSize+uTime);outColor=vec4(vec3(v),1);}",Dn:[{name:"uTime",type:ue,value:0},{name:"uGridSize",type:te,value:new ri(4,4)}],Rn:!0,Ln:1,Bn:0,Un:1}];class li{constructor(e,t,i,r){this.elements=new Float32Array(4),this.set(e,t,i,r)}static get _t(){return new li(1,1,1,1)}static get Ot(){return new li(0,0,0,0)}get x(){return this.elements[0]}get y(){return this.elements[1]}get z(){return this.elements[2]}get w(){return this.elements[3]}set x(e){this.elements[0]=e}set y(e){this.elements[1]=e}set z(e){this.elements[2]=e}set w(e){this.elements[3]=e}set(e,t,i,r){this.elements=new Float32Array([e,t,i,r])}Lt(e){const t=this.x,i=this.y,r=this.z,s=this.w,n=e.Bt*t+e.Ut*i+e.It*r+e.Vt*s,a=e.Nt*t+e.m11*i+e.m12*r+e.m13*s,o=e.Et*t+e.m21*i+e.m22*r+e.m23*s,u=e.Ni*t+e.m31*i+e.m32*r+e.m33*s;return this.x=n,this.y=a,this.z=o,this.w=u,this}}class hi{constructor(e,t){this.origin=e,this.dir=t}}const ci={In:"nearLeftTop",Vn:"nearRightTop",Nn:"nearLeftBottom",En:"nearRightBottom",An:"farLeftTop",Fn:"farRightTop",On:"farLeftBottom",_n:"farRightBottom"};class fi extends ei{constructor({name:e,kn:t,clearColor:i,Gn:r}){super({name:e,type:y.C}),this.jn=jt.identity,this.projectionMatrix=jt.identity,this.$n=jt.identity,this.Hn=jt.identity,this.Wn=jt.identity,this.Xn=jt.identity,this.#f=null,this.near=1,this.Jn=10,this.Yn=!1,this.Kn=null,this.kn=t,this.clearColor=i||new li(0,0,0,1),this.#m=r||null}#f;#m;get Zn(){return this.transform.Cs.Dt()}get Gn(){return this.#m}get Qn(){return!!this.Gn&&this.Gn.enabled}get qn(){return!!this.Qn&&this.Gn.ea}get xn(){return this.#f}get ta(){return this.#f?this.#f.gi?this.#f.write:this.#f:null}it(e,t){this.#f&&this.#f.it(e,t),this.#m&&this.#m.it(e,t)}ia(e){this.#m=e}ra(e){this.clearColor=e}update({$e:e,time:t,Ks:i}){if(super.update({$e:e,time:t,Ks:i}),this.Kn||(this.Kn=new ti({qs:new Vt({$e:e,attributes:[new bt({name:H,data:new Float32Array(new Array(24).fill(0)),size:3,_e:j})],qt:36,He:[6,7,4,4,7,5,0,1,2,2,1,3,0,4,5,5,1,0,0,2,4,2,6,4,2,3,6,6,3,7,1,5,7,7,1,3]}),en:new Yt({Bi:`#version 300 es\n                    \n                    layout (location = 0) in vec3 ${H};\n\n                    #pragma TRANSFORM_VERTEX_UNIFORMS\n                   \n                    void main() {\n                        gl_Position = ${ge} * ${de} * ${ve} * vec4(${H}, 1.);\n                    }\n                    `,Ui:"#version 300 es\n                   \n                    precision mediump float;\n                    \n                    out vec4 outColor;\n                    \n                    void main() {\n                        outColor = vec4(0, 1., 0, 1.);\n                    }\n                    ",primitiveType:s,Ur:h,zr:!1})}),this.Hs(this.Kn)),this.Kn){const e=this.sa();if(!e)return;this.Kn.qs.ii(H,new Float32Array([...e.In.elements,...e.Nn.elements,...e.Vn.elements,...e.En.elements,...e.An.elements,...e.On.elements,...e.Fn.elements,...e._n.elements])),this.Kn.enabled=this.Yn}}Ws(){super.Ws(),this.jn=this.transform.xs.clone().$i(),this.Xn=this.projectionMatrix.clone().$i(),this.Wn=this.jn.clone().$i(),this.$n=jt.Gi(this.projectionMatrix,this.jn),this.Hn=this.$n.clone().$i()}na(){return this.kn===T}aa(e){const t=jt.Gi(this.projectionMatrix,this.jn,jt.Ai(e)),i=t.position,r=0===t.m33?1e-4:t.m33;return new It(i.x/r,i.y/r,i.z/r)}yn(e){this.#f=e}oa(){}sa(){}ua(){}la(){return this.transform.Cs.clone().Dt()}ha(e){const t=new li(2*e.x-1,2*e.y-1,1,1).Lt(this.Hn);t.x=t.x/t.w,t.y=t.y/t.w,t.z=t.z/t.w;const i=new It(t.x,t.y,t.z),r=this.transform.ws,s=i.zt(r).normalize();return new hi(r,s)}}class mi extends fi{constructor(e,t,i,r,s,n){super({kn:w}),this.left=0,this.right=0,this.bottom=0,this.top=0,this.near=0,this.Jn=0,this.ca=1,this.left=e,this.right=t,this.bottom=i,this.top=r,this.near=s,this.Jn=n,this.fa(1,1,e,t,i,r)}fa(e,t,i,r,s,n){i&&r&&n&&s&&(this.left=i,this.right=r,this.bottom=s,this.top=n),null!==e&&null!==t&&this.it(e,t),this.ca=(r-i)/(n-s)}it(e,t){super.it(e,t),this.oa()}oa(){this.projectionMatrix=jt.Hi(this.left,this.right,this.bottom,this.top,this.near,this.Jn)}sa(){const e=It.back,t=It.right,i=It.kt,r=(Math.abs(this.left)+Math.abs(this.right))/2,s=(Math.abs(this.top)+Math.abs(this.right))/2,n=e.clone().scale(this.near),a=e.clone().scale(this.Jn),o=t.clone().scale(r),u=i.clone().scale(s);return{In:It.$t(n,o.clone().Dt(),u),Vn:It.$t(n,o,u),Nn:It.$t(n,o.clone().Dt(),u.clone().Dt()),En:It.$t(n,o,u.clone().Dt()),An:It.$t(a,o.clone().Dt(),u),Fn:It.$t(a,o,u),On:It.$t(a,o.clone().Dt(),u.clone().Dt()),_n:It.$t(a,o,u.clone().Dt())}}ua(){const e={In:It.Ot,Vn:It.Ot,Nn:It.Ot,En:It.Ot,An:It.Ot,Fn:It.Ot,On:It.Ot,_n:It.Ot},t=this.sa();for(const i in ci){const r=i,s=t[r].Lt(this.transform.xs);e[r]=s}return e}static ma(){const e=new mi(-1,1,-1,1,0,2);return e.transform.Ei(new It(0,0,1)),e}}class pi{constructor(e){this.de=[],this.#p=!0,this.#v=e||mi.ma()}#v;#p;get enabled(){if(!this.#p)return!1;for(let e=0;e<this.de.length;e++)if(this.de[e].parameters.enabled)return!0;return!1}get pa(){return this.#v}set enabled(e){this.#p=e}get ea(){for(let e=0;e<this.de.length;e++)if(this.de[e].parameters.enabled)return!0;return!1}get va(){let e=null;for(let t=this.de.length-1;t>=0;t--)if(this.de[t].parameters.enabled){e=this.de[t];break}return null==e?null:e.xn}it(e,t){this.#v.it(e,t),this.de.forEach((i=>i.it(e,t)))}da(e){this.de.push(e)}update(){this.de.forEach((e=>{e.update()}))}static ga({xa:e,Sn:t,wn:i,ya:r,Ta:s}){e.tn.forEach((e=>{r&&er(e,r,s),e.Er.cr(xe,i.$n),e.Er.cr(Se,i.Hn),e.Er.cr(we,i.Wn),e.Er.cr(be,i.Xn),e.Er.cr(Ce,i.jn.clone().$i().ji()),e.Er.cr(Re,t.Sa.wa),e.Er.cr(Le,t.Sa.ba),e.Er.cr(Be,t.Sa.Ca),e.Er.cr(Ue,t.Sa.Ma),e.Er.cr(Ve,t.Pa.Mi)}))}static za({xa:e,$e:t,Sn:i,Da:r,bn:s,wn:n,Sa:a,time:o,Cn:u,ya:l}){pi.ga({xa:e,Sn:i,wn:n,ya:l,Ta:t.Ra}),i.La(n),e.Tn({$e:t,Sn:i,Da:r,bn:s,Cn:u,wn:n,Sa:a,time:o,ya:l})}Tn({$e:e,Sn:t,bn:i,Sa:r,wn:s,time:n,Ba:a,ya:o}){this.#v.Ws();const u=this.de.filter((e=>e.parameters.enabled));u.forEach(((l,h)=>{const c=a&&h===u.length-1;pi.za({xa:l,$e:e,Sn:t,Da:this.#v,bn:i,Cn:c,wn:s,Sa:r,time:n,ya:o}),i=l.xn}))}}class vi extends Ot{constructor({$e:e,name:t,width:i=1,height:r=1}){super(),this.Ua=[],this.Si=null,this.$e=e;const s=V,n=V,a=e.We;this.name=t,this.width=i,this.height=r,this.bi=new At({$e:e}),this.bi.bind();const o=a.COLOR_ATTACHMENT0+0;this.Ia=new Pt({$e:e,width:this.width,height:this.height,Ye:!1,type:M,Ke:s,Ze:n}),a.framebufferTexture2D(a.FRAMEBUFFER,o,a.TEXTURE_2D,this.Ia.Ge,0),this.Ua.push(this.Ia),this.framebuffer.di(o);const u=a.COLOR_ATTACHMENT0+1;this.Va=new Pt({$e:e,width:this.width,height:this.height,Ye:!1,type:M,Ke:s,Ze:n}),a.framebufferTexture2D(a.FRAMEBUFFER,u,a.TEXTURE_2D,this.Va.Ge,0),this.framebuffer.di(u),this.Ua.push(this.Va);const l=a.COLOR_ATTACHMENT0+2;this.Na=new Pt({$e:e,width:this.width,height:this.height,Ye:!1,type:M,Ke:s,Ze:n}),a.framebufferTexture2D(a.FRAMEBUFFER,l,a.TEXTURE_2D,this.Na.Ge,0),this.framebuffer.di(l),this.Ua.push(this.Na);const h=a.COLOR_ATTACHMENT0+3;this.Ea=new Pt({$e:e,width:this.width,height:this.height,Ye:!1,type:R,Ke:s,Ze:n}),a.framebufferTexture2D(a.FRAMEBUFFER,h,a.TEXTURE_2D,this.Ea.Ge,0),this.framebuffer.di(h),this.Ua.push(this.Ea),a.bindTexture(a.TEXTURE_2D,null),this.framebuffer.je()}get wa(){return this.Ia}get ba(){return this.Va}get Ca(){return this.Na}get Ma(){return this.Ea}get Mi(){return this.Si}get framebuffer(){return this.bi}get read(){return this}get write(){return this}it(e,t){this.width=e,this.height=t,this.Ua.forEach((e=>e.it(this.width,this.height))),this.Si&&this.Si.it(this.width,this.height)}zi(e){const t=this.$e.We;this.Si=e,this.bi.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.Si.Ge,0),this.bi.je()}}function di(e,t){const i=[...e];for(let r=0;r<e.length;r++)i[r]=t;return i}function gi(e,t=!1){const i=new Array(e).fill(0);return t?i.map(((e,t)=>t)):i}function xi(e){return[...e].filter(Boolean)}const yi=(e=[])=>function(e){const t=e;return{value:()=>t,fill:function(...e){return di(t,e[0]),this},range:function(e){return gi(e),this},compact:function(){return xi(t),this}}}(e);yi.fill=di,yi.range=gi,yi.compact=xi;class Ti extends ii{constructor(e){const{$e:t}=e,i={...e.parameters},r=[{name:Re,type:q,value:null},{name:Le,type:q,value:null},{name:Be,type:q,value:null},{name:Ue,type:q,value:null},{name:Ve,type:q,value:null},{name:"uScreenSpaceShadowTexture",type:q,value:null},{name:"uAmbientOcclusionTexture",type:q,value:null},{name:qe,type:q,value:null},{name:et,type:me,value:yi.range(4).map((()=>null))},{name:at,type:ae,value:[{name:"cubeMap",type:ee,value:null},{name:"diffuseIntensity",type:ue,value:0},{name:"specularIntensity",type:ue,value:0},{name:"rotationOffset",type:ue,value:0},{name:"maxLodLevel",type:ue,value:0}]}];super({$e:t,type:K.A,parameters:i,name:"DeferredShadingPass",Ui:"#version 300 es\nprecision highp float;\n#pragma DEFINES\n#define MAX_SPOT_LIGHT_COUNT 4\n#define MAX_POINT_LIGHT_COUNT 4\nlayout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};struct DirectionalLight{vec3 direction;float intensity;vec4 color;mat4 shadowMapProjectionMatrix;};layout(std140) uniform ubDirectionalLight{DirectionalLight uDirectionalLight;};struct SpotLight{vec4 color;vec3 position;vec3 direction;float intensity;float distance;float attenuation;float coneCos;float penumbraCos;mat4 shadowMapProjectionMatrix;};layout(std140) uniform ubSpotLight{SpotLight uSpotLight[MAX_SPOT_LIGHT_COUNT];};struct PointLight{vec4 color;vec3 position;float intensity;float distance;float attenuation;};layout(std140) uniform ubPointLight{PointLight uPointLight[MAX_POINT_LIGHT_COUNT];};\n#define saturate(a)clamp(a,0.,1.)\n#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\nstruct IncidentLight{vec3 color;vec3 direction;bool visible;float intensity;};struct IncidentSkyboxLight{vec3 diffuseDirection;float diffuseIntensity;vec3 specularDirection;float specularIntensity;float maxLodLevel;};struct ReflectedLight{vec3 directDiffuse;vec3 directSpecular;vec3 indirectDiffuse;vec3 indirectSpecular;};struct GeometricContext{vec3 position;vec3 normal;vec3 viewDir;};struct Material{vec3 baseColor;vec3 diffuseColor;vec3 specularColor;float roughness;float metallic;};bool u(const float u,const float s){return any(bvec2(s==0.,u<s));}float u(const float u,const float e,const float v){return v>0.?pow(saturate(-u/e+1.),v):1.;}void f(const DirectionalLight u,const GeometricContext e,out IncidentLight v){v.color=u.color.xyz;v.direction=-u.direction;v.visible=true;v.intensity=u.intensity;}void v(const SpotLight v,const GeometricContext s,out IncidentLight f){vec3 d=v.position-s.position,n=normalize(d);f.direction=n;f.intensity=v.intensity;float e=length(d),c=dot(-n,v.direction),r=v.coneCos,l=v.penumbraCos;if(all(bvec2(c>r,u(e,v.distance))))f.color=v.color.xyz,f.color*=smoothstep(r,l,c)*u(e,v.distance,v.attenuation),f.visible=true;else f.color=vec3(0),f.visible=false;}void s(const PointLight v,const GeometricContext s,out IncidentLight f){vec3 d=v.position-s.position;float e=length(d);f.direction=normalize(d);f.intensity=v.intensity;if(u(e,v.distance))f.color=v.color.xyz,f.color*=u(e,v.distance,v.attenuation),f.visible=true;else f.color=vec3(0),f.visible=false;}struct SkyboxLight{float diffuseIntensity;float specularIntensity;float rotationOffset;float maxLodLevel;};vec3 f(vec3 v,float u){v.x*=-1.;float s=cos(3.14+u),e=sin(3.14+u);v.xz*=mat2(s,e,-e,s);return v;}void e(const SkyboxLight u,const GeometricContext v,out IncidentSkyboxLight s){vec3 n=f(v.normal,u.rotationOffset),r=f(reflect(-v.viewDir,normalize(v.normal)),u.rotationOffset);s.diffuseDirection=n;s.diffuseIntensity=u.diffuseIntensity;s.specularDirection=r;s.specularIntensity=u.specularIntensity;s.maxLodLevel=u.maxLodLevel;}vec3 t(vec3 u,vec3 v,vec3 s){return u+(1.-u)*pow(1.-saturate(dot(s,v)),5.);}vec3 e(vec3 u,float s){return u+(1.-u)*pow(1.-s,5.);}float s(float u,float s){float d=u*u,v=s*s*(d-1.)+1.;return d/(PI*v*v);}float p(float u,float s,float v){float d=u*u*.5+EPSILON;return v/(v*(1.-d)+d)*(s/(s*(1.-d)+d));}vec3 e(const vec3 u,const GeometricContext v,vec3 e,float d){vec3 r=normalize(v.normal),n=normalize(v.viewDir),c=normalize(u);float f=saturate(dot(r,c)),l=saturate(dot(r,n));vec3 G=normalize(c+n);float y=saturate(dot(r,G)),a=d*d,m=s(a,y),I=p(a,l,f);vec3 S=t(e,n,G);return I*m*S/(4.*f*l+EPSILON);}void e(const IncidentLight u,const GeometricContext v,const Material s,inout ReflectedLight f,const float n){float d=saturate(dot(v.normal,u.direction));vec3 r=d*u.color;r*=PI;r*=u.intensity;r*=1.-n;f.directDiffuse+=r*(s.diffuseColor/PI);f.directSpecular+=r*e(u.direction,v,s.specularColor,s.roughness);}void f(samplerCube u,const IncidentSkyboxLight v,const GeometricContext s,const Material d,inout ReflectedLight f){f.directDiffuse+=d.diffuseColor*textureLod(u,v.diffuseDirection,v.maxLodLevel).xyz*v.diffuseIntensity;vec3 r=textureLod(u,v.specularDirection,log2(d.roughness*pow(2.,v.maxLodLevel))).xyz,n=e(d.specularColor,max(0.,dot(s.viewDir,s.normal)));f.directSpecular+=mix(r*v.specularIntensity*d.specularColor,r*v.specularIntensity,n);}struct Camera{vec3 worldPosition;};struct Surface{vec3 worldNormal;vec3 worldPosition;vec4 diffuseColor;float specularAmount;};struct Skybox{samplerCube cubeMap;float diffuseIntensity;float specularIntensity;float rotationOffset;float maxLodLevel;};vec3 d(vec2 u,float v,mat4 s){vec4 f=s*vec4(u*2.-1.,v*2.-1.,1);return f.xyz/f.w;}const vec2 G[4]=vec2[](vec2(-.94201624,-.39906216),vec2(.94558609,-.76890725),vec2(-.094184101,-.9293887),vec2(.34495938,.2938776));float d(vec3 u,vec3 s,vec3 v,mat4 e,sampler2D d,float f){float r=.005*tan(acos(max(dot(s,-v),0.)));r=clamp(r,.1,.5);vec4 n=e*vec4(u,1);vec2 c=n.xy;float G=n.z;return clamp(smoothstep(0.,.25,c.x)*(1.-smoothstep(.75,1.,c.x))*smoothstep(0.,.25,c.y)*(1.-smoothstep(.75,1.,c.y))*step(0.,G)*(1.-step(1.,G))*0.*.5,0.,1.);}float e(vec3 u,vec3 s,vec3 v,mat4 e,sampler2D d,float f){float r=.005*tan(acos(max(dot(s,-v),0.)));r=clamp(r,.01,.02);vec4 n=e*vec4(u,1);vec2 c=n.xy/n.w;float G=n.z/n.w;return clamp(smoothstep(0.,.25,c.x)*(1.-smoothstep(.75,1.,c.x))*smoothstep(0.,.25,c.y)*(1.-smoothstep(.75,1.,c.y))*step(0.,G)*(1.-step(1.,G))*0.*.5,0.,1.);}in vec2 vUv;\n#ifdef USE_RECEIVE_SHADOW\nin vec4 vShadowMapProjectionUv;\n#endif\nuniform sampler2D uDirectionalLightShadowMap,uSpotLightShadowMap[MAX_SPOT_LIGHT_COUNT];\n#ifdef USE_RECEIVE_SHADOW\nuniform sampler2D uShadowMap;uniform float uShadowBias;\n#endif\nuniform sampler2D uGBufferATexture,uGBufferBTexture,uGBufferCTexture,uGBufferDTexture,uDepthTexture,uScreenSpaceShadowTexture,uAmbientOcclusionTexture;uniform float uTime;uniform Skybox uSkybox;\n#define SHADING_MODEL_NUM 3.\nstruct GBufferA{vec3 baseColor;};struct GBufferB{vec3 normal;float shadingModelId;};struct GBufferC{float metallic;float roughness;};struct GBufferD{vec3 emissiveColor;};GBufferA d(sampler2D u,vec2 v){GBufferA f;f.baseColor=texture(u,v).xyz;return f;}GBufferB p(sampler2D u,vec2 v){vec4 s=texture(u,v);GBufferB f;f.normal=normalize(s.xyz*2.-1.);f.shadingModelId=s.w*SHADING_MODEL_NUM;return f;}GBufferC t(sampler2D u,vec2 v){vec4 s=texture(u,v);GBufferC f;f.metallic=s.x;f.roughness=s.y;return f;}GBufferD v(sampler2D u,vec2 v){GBufferD f;f.emissiveColor=texture(u,v).xyz;return f;}layout(location=0) out vec4 outColor;void main(){vec4 u=vec4(0,0,0,1);vec2 r=vUv;GBufferA n=d(uGBufferATexture,r);GBufferB c=p(uGBufferBTexture,r);GBufferC G=t(uGBufferCTexture,r);GBufferD m=v(uGBufferDTexture,r);vec3 y=n.baseColor;float l=G.metallic;vec3 x=m.emissiveColor;float I=c.shadingModelId,a=texture(uDepthTexture,r).x;vec3 S=d(r,a,uInverseViewProjectionMatrix);if(step(a,.9999)<.5){outColor=vec4(y,1);return;}if(1.5<I&&I<2.5){u=vec4(x,1);outColor=u;return;}float i=texture(uScreenSpaceShadowTexture,r).x;Surface o;o.worldPosition=S;o.worldNormal=c.normal;o.diffuseColor=vec4(y,1);o.specularAmount=.5;Camera M;M.worldPosition=uViewPosition;GeometricContext z;z.position=o.worldPosition;z.normal=o.worldNormal;z.viewDir=normalize(M.worldPosition-o.worldPosition);Material R;vec3 P=y;R.baseColor=P;R.diffuseColor=mix(P,vec3(0),l);R.specularColor=mix(vec3(.04),P,l);R.roughness=G.roughness;R.metallic=l;ReflectedLight D=ReflectedLight(vec3(0),vec3(0),vec3(0),vec3(0));IncidentLight w;float b=0.;DirectionalLight C;C.direction=uDirectionalLight.direction;C.color=uDirectionalLight.color;C.intensity=uDirectionalLight.intensity;f(C,z,w);b=d(S,o.worldNormal,uDirectionalLight.direction,uDirectionalLight.shadowMapProjectionMatrix,uDirectionalLightShadowMap,uShadowBias);e(w,z,R,D,b);v(uSpotLight[0],z,w);b=e(S,o.worldNormal,uSpotLight[0].direction,uSpotLight[0].shadowMapProjectionMatrix,uSpotLightShadowMap[0],uShadowBias);e(w,z,R,D,b);v(uSpotLight[1],z,w);b=e(S,o.worldNormal,uSpotLight[1].direction,uSpotLight[1].shadowMapProjectionMatrix,uSpotLightShadowMap[1],uShadowBias);e(w,z,R,D,b);v(uSpotLight[2],z,w);b=e(S,o.worldNormal,uSpotLight[2].direction,uSpotLight[2].shadowMapProjectionMatrix,uSpotLightShadowMap[2],uShadowBias);e(w,z,R,D,b);v(uSpotLight[3],z,w);b=e(S,o.worldNormal,uSpotLight[3].direction,uSpotLight[3].shadowMapProjectionMatrix,uSpotLightShadowMap[3],uShadowBias);e(w,z,R,D,b);s(uPointLight[0],z,w);e(w,z,R,D,i);s(uPointLight[1],z,w);e(w,z,R,D,i);s(uPointLight[2],z,w);e(w,z,R,D,i);s(uPointLight[3],z,w);e(w,z,R,D,i);SkyboxLight U;U.diffuseIntensity=uSkybox.diffuseIntensity;U.specularIntensity=uSkybox.specularIntensity;U.rotationOffset=uSkybox.rotationOffset;U.maxLodLevel=uSkybox.maxLodLevel;IncidentSkyboxLight N;e(U,z,N);f(uSkybox.cubeMap,N,z,R,D);vec3 E=D.directDiffuse+D.directSpecular+D.indirectDiffuse+D.indirectSpecular;u=vec4(E,1);u.xyz*=texture(uAmbientOcclusionTexture,r).x;u.xyz+=x;outColor=u;}",Er:r,qi:!0,fn:_,Ar:[lt,ht,ct,ft]})}Aa(e){this.en.Er.cr(at,[{name:"cubeMap",type:ee,value:e.Fa},{name:"diffuseIntensity",type:ue,value:e.Oa},{name:"specularIntensity",type:ue,value:e._a},{name:"rotationOffset",type:ue,value:e.ka},{name:"maxLodLevel",type:ue,value:e.Fa.st}])}Tn(e){super.Tn(e)}}class wi{constructor(e=0,t=0,i=0,r=1){this.elements=new Float32Array(4),this.set(e,t,i,r)}get r(){return this.elements[0]}get Ga(){return this.elements[1]}get b(){return this.elements[2]}get a(){return this.elements[3]}get ja(){return 255*this.elements[0]}get $a(){return 255*this.elements[1]}get Ha(){return 255*this.elements[2]}get Wa(){return 255*this.elements[3]}get Xa(){return[this.r,this.Ga,this.b]}set r(e){this.elements[0]=e}set Ga(e){this.elements[1]=e}set b(e){this.elements[2]=e}set a(e){this.elements[3]=e}set(e,t,i,r){this.elements=new Float32Array([e,t,i,r])}Ja(e,t=!1){return this.elements[0]*=e,this.elements[1]*=e,this.elements[2]*=e,t&&(this.elements[3]*=e),this}Ya(){return{r:this.ja,Ga:this.$a,b:this.Ha}}Ka(e=!0){const t=this.Ya(),i=t.r.toString(16).padStart(2,"0"),r=t.Ga.toString(16).padStart(2,"0"),s=t.b.toString(16).padStart(2,"0");return e?`#${i}${r}${s}`:`${i}${r}${s}`}static get Za(){return new wi(1,1,1,1)}static get Qa(){return new wi(0,0,0,1)}static get green(){return new wi(0,0,1,1)}static qa(e,t,i,r=255){return new wi(e/255,t/255,i/255,r/255)}static jt(e){return new wi(e[0],e[1],e[2],e[3]?e[3]:1)}static eo(e){const t="#"===e.slice(0,1)?e.slice(1):e,i=t.slice(0,2),r=t.slice(2,4),s=t.slice(4,6);return new wi(Number.parseInt(i,16)/255,Number.parseInt(r,16)/255,Number.parseInt(s,16)/255,1)}}function Si(e,t,i){return Math.min(i,Math.max(e,t))}const bi=e=>{const t=[.1*Math.PI,Math.PI*(1/3*4+.1),Math.PI*(1/3*2+.1),Math.PI*(1/3*1+.1),1.1*Math.PI,Math.PI*(1/3*5+.1)],i=1/16*Math.PI*2,r=new Array(16).fill(0).map(((e,t)=>[function(e,t,i){return e+(t-e)*Math.random()}(i*(4*t),i*(4*t+4))%(2*Math.PI),1+.0625*t,1,1])).flat(),s=new Pt({$e:e,width:4,height:4,type:D,Qe:B,qe:B});return s.update({width:4,height:4,data:new Float32Array(r)}),{io:t,ro:[.1,.8/6*4+.1,.8/6*2+.1,.8/6*1+.1,.5,.8/6*5+.1],so:s}};class Ci extends ii{constructor(e){const{$e:t}=e,{io:i,ro:r,so:s}=bi(t),n=function(e={}){return{enabled:e.enabled??!0}}(e.parameters??{});super({$e:t,type:K.O,Ui:"#version 300 es\nprecision highp float;\n#pragma DEFINES\nin vec2 vUv;out vec4 outColor;layout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};uniform sampler2D uDepthTexture,uGBufferBTexture;uniform float[6] uSamplingRotations,uSamplingDistances;uniform mat4 uSamplingTableMatrix;uniform sampler2D uSamplingTexture;uniform float uOcclusionSampleLength,uOcclusionBias,uOcclusionMinDistance,uOcclusionMaxDistance;uniform vec4 uOcclusionColor;uniform float uOcclusionPower,uOcclusionStrength,uBlendRate;float u(float u,float e,float f){float m=e*u;return-m/(f*(u-1.)-m);}vec3 e(vec2 u,float e,mat4 f){vec4 m=f*vec4(u*2.-1.,e*2.-1.,1);return m.xyz/m.w;}float e(sampler2D u,vec3 e,mat4 f,vec3 x){vec4 m=f*vec4(e+x,1);return textureLod(u,(m.xyz/m.w).xy*.5+.5,0.).x;}mat2 e(float u){float e=cos(u),m=sin(u);return mat2(e,-m,m,e);}void main(){float m=0.;vec2 f=vUv;vec4 x=vec4(1,1,1,0);float s=u(texture(uDepthTexture,f).x,uNearClip,uFarClip);vec3 v=normalize((uTransposeInverseViewMatrix*vec4(normalize(texture(uGBufferBTexture,f).xyz*2.-1.),1)).xyz),r=e(f,texture(uDepthTexture,f).x,uInverseProjectionMatrix);vec2 t=gl_FragCoord.xy/4.;vec4 d=texture(uSamplingTexture,t);float w=d.x,c=d.y;if(s>.9999){outColor=x;return;}for(int i=0;i<6;i++){mat2 D=e(uSamplingRotations[i]+w);float n=uSamplingDistances[i]*c*uOcclusionSampleLength;vec3 h=vec3(D*vec2(1,0),0)*n;float o=e(uDepthTexture,r,uProjectionMatrix,h),p=e(uDepthTexture,r,uProjectionMatrix,-h);vec3 A=e(f,o,uInverseProjectionMatrix),B=e(f,p,uInverseProjectionMatrix);float z=distance(A,r),C=distance(B,r);if(z<uOcclusionMinDistance||uOcclusionMaxDistance<z)continue;if(C<uOcclusionMinDistance||uOcclusionMaxDistance<C)continue;vec3 E=-normalize(r),F=normalize(A-r),G=normalize(B-r);m+=max(0.,dot(F,E)-min(dot(v,F),0.)+(dot(G,E)-min(dot(v,G),0.)));}float i=m/float(6);i=clamp(i,0.,1.);i=pow(i,uOcclusionPower);vec4 n=mix(x,uOcclusionColor,clamp(i*uBlendRate*uOcclusionStrength,0.,1.));n.w=1.;outColor=n;}",parameters:n,Er:[{name:Le,type:q,value:null},{name:Ve,type:q,value:null},{name:"uSamplingRotations",type:le,value:new Float32Array(i)},{name:"uSamplingDistances",type:le,value:new Float32Array(r)},{name:"uSamplingTexture",type:q,value:s},{name:"uOcclusionSampleLength",type:ue,value:1},{name:"uOcclusionBias",type:ue,value:1},{name:"uOcclusionMinDistance",type:ue,value:1},{name:"uOcclusionMaxDistance",type:ue,value:1},{name:"uOcclusionColor",type:ce,value:new wi(0,0,0,1)},{name:"uOcclusionPower",type:ue,value:1},{name:"uOcclusionStrength",type:ue,value:1},{name:"uBlendRate",type:ue,value:1}],Ar:[ut,lt]}),this.no=.121,this.ao=1e-4,this.oo=.006,this.uo=.2,this.lo=new wi(0,0,0,1),this.ho=1.85,this.co=.448,this.fo=1,this.so=s}it(e,t){super.it(e,t),this.en.Er.cr(_e,e),this.en.Er.cr(ke,t)}Tn(e){this.en.Er.cr("uOcclusionSampleLength",this.no),this.en.Er.cr("uOcclusionBias",this.ao),this.en.Er.cr("uOcclusionMinDistance",this.oo),this.en.Er.cr("uOcclusionMaxDistance",this.uo),this.en.Er.cr("uOcclusionColor",this.lo),this.en.Er.cr("uOcclusionPower",this.ho),this.en.Er.cr("uOcclusionStrength",this.co),this.en.Er.cr("uBlendRate",this.fo),this.en.Er.cr("uSamplingTexture",this.so),super.Tn(e)}}class Mi extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0,mo:e.mo??.0099,po:e.po??.13,vo:e.vo??3.25,do:e.do??.3,xo:e.xo??.05,yo:e.yo??.05,To:e.To??0,wo:e.wo??4.2,So:e.So??.42,bo:e.bo??.955,Co:e.Co??.444,Mo:e.Mo??1,Po:e.Po??.5,zo:e.zo??.355,fo:e.fo??1}}(e.parameters??{}),r=[{name:Re,type:q,value:null},{name:Le,type:q,value:null},{name:Be,type:q,value:null},{name:Ve,type:q,value:null},{name:"uRayDepthBias",type:ue,value:0},{name:"uRayNearestDistance",type:ue,value:0},{name:"uRayMaxDistance",type:ue,value:0},{name:"uReflectionAdditionalRate",type:ue,value:0},{name:"uReflectionRayThickness",type:ue,value:0},{name:"uReflectionRayJitterSizeX",type:ue,value:0},{name:"uReflectionRayJitterSizeY",type:ue,value:0},{name:"uReflectionFadeMinDistance",type:ue,value:0},{name:"uReflectionFadeMaxDistance",type:ue,value:0},{name:"uReflectionScreenEdgeFadeFactorMinX",type:ue,value:0},{name:"uReflectionScreenEdgeFadeFactorMaxX",type:ue,value:0},{name:"uReflectionScreenEdgeFadeFactorMinY",type:ue,value:0},{name:"uReflectionScreenEdgeFadeFactorMaxY",type:ue,value:0},{name:"uReflectionRoughnessPower",type:ue,value:0},{name:"uBlendRate",type:ue,value:1}];super({$e:t,type:K._,Ui:"#version 300 es\nprecision highp float;\n#pragma DEFINES\nin vec2 vUv;out vec4 outColor;\n#define saturate(a)clamp(a,0.,1.)\nfloat u(vec2 u){return fract(sin(dot(u,vec2(12.9898,78.233)))*43758.5453);}layout(std140) uniform ubCommon{float uTime;vec4 uViewport;};layout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};\n#define SHADING_MODEL_NUM 3.\nstruct GBufferA{vec3 baseColor;};struct GBufferB{vec3 normal;float shadingModelId;};struct GBufferC{float metallic;float roughness;};struct GBufferD{vec3 emissiveColor;};GBufferA u(sampler2D u,vec2 v){GBufferA f;f.baseColor=texture(u,v).xyz;return f;}GBufferB e(sampler2D u,vec2 v){vec4 s=texture(u,v);GBufferB f;f.normal=normalize(s.xyz*2.-1.);f.shadingModelId=s.w*SHADING_MODEL_NUM;return f;}GBufferC t(sampler2D u,vec2 v){vec4 f=texture(u,v);GBufferC x;x.metallic=f.x;x.roughness=f.y;return x;}uniform sampler2D uSrcTexture,uDepthTexture,uGBufferATexture,uGBufferBTexture,uGBufferCTexture;uniform float uBlendRate,uRayDepthBias,uRayNearestDistance,uRayMaxDistance,uReflectionRayThickness,uReflectionRayJitterSizeX,uReflectionRayJitterSizeY,uReflectionFadeMinDistance,uReflectionFadeMaxDistance,uReflectionScreenEdgeFadeFactorMinX,uReflectionScreenEdgeFadeFactorMaxX,uReflectionScreenEdgeFadeFactorMinY,uReflectionScreenEdgeFadeFactorMaxY,uReflectionRoughnessPower,uReflectionAdditionalRate;float e(float u,float e,float v){float f=e*u;return-f/(v*(u-1.)-f);}vec3 t(vec2 u,float e,mat4 v){vec4 f=v*vec4(u*2.-1.,e*2.-1.,1);return f.xyz/f.w;}float u(sampler2D u,vec3 e,mat4 v){vec4 f=v*vec4(e+vec3(0),1);return textureLod(u,(f.xyz/f.w).xy*.5+.5,0.).x;}void main(){vec2 v=vUv;GBufferA f=u(uGBufferATexture,v);GBufferB s=e(uGBufferBTexture,v);GBufferC G=t(uGBufferCTexture,v);vec3 x=normalize((uTransposeInverseViewMatrix*vec4(s.normal,1)).xyz);vec4 r=texture(uSrcTexture,v),m=vec4(0,0,0,1);vec3 n=t(vUv,texture(uDepthTexture,v).x,uInverseProjectionMatrix),w=normalize(vec3(u(v+.1),u(v+.2),u(v+.3))*2.-1.),c=reflect(normalize(n),x)+w*G.roughness*uReflectionRoughnessPower,z=n;float Y=uRayMaxDistance/float(16);vec3 X=z;bool a=false;float b=1.,d=u(v+uTime)*2.-1.;vec2 i=vec2(d*uReflectionRayJitterSizeX,d*uReflectionRayJitterSizeY);float D=e(texture(uDepthTexture,v).x,uNearClip,uFarClip);if(D>.999){outColor=r;return;}for(int l=0;l<16;l++){float S=Y*(float(l)+1.)+uRayNearestDistance;X=z+vec3(i,0)+c*S;float h=u(uDepthTexture,X,uProjectionMatrix);vec3 o=t(v,h,uInverseProjectionMatrix);vec4 A=uProjectionMatrix*vec4(X,1);A.xyz=A.xyz/A.w;if(abs(A.x)>1.||abs(A.y)>1.)break;float B=o.z-X.z;if(uRayDepthBias<B&&B<uReflectionRayThickness){a=true;break;}}if(a){X-=c*Y;float S=Y,l=1.;vec3 A=n;for(int o=0;o<4;o++){S*=.5*l;X+=c*S;float h=u(uDepthTexture,X,uProjectionMatrix);A=t(v,h,uInverseProjectionMatrix);float B=A.z-X.z;l=uRayDepthBias<B?-1.:1.;}vec4 h=uProjectionMatrix*vec4(X,1);float o=(abs(v.x*2.-1.)-uReflectionScreenEdgeFadeFactorMinX)/max(uReflectionScreenEdgeFadeFactorMaxX-uReflectionScreenEdgeFadeFactorMinX,.001),p=(abs(v.y*2.-1.)-uReflectionScreenEdgeFadeFactorMinY)/max(uReflectionScreenEdgeFadeFactorMaxY-uReflectionScreenEdgeFadeFactorMinY,.001);o=1.-clamp(o,0.,1.);p=1.-clamp(p,0.,1.);float B=distance(n,A),y=(B-uReflectionFadeMinDistance)/max(uReflectionFadeMaxDistance-uReflectionFadeMinDistance,.001);y=clamp(y,0.,1.);y=1.-y*y;b=y*o*p;m+=texture(uSrcTexture,h.xy/h.w*.5+.5)*vec4(mix(vec3(.04),f.baseColor*G.metallic,G.metallic),1)*b*uReflectionAdditionalRate;}vec4 o=mix(r,r+m,uBlendRate);outColor=o;}",Er:r,fn:_,Ar:[ot],parameters:i}),this.parameters=i}it(e,t){super.it(e,t),this.en.Er.cr(_e,e),this.en.Er.cr(ke,t)}Tn(e){this.en.Er.cr("uRayDepthBias",this.parameters.mo),this.en.Er.cr("uRayNearestDistance",this.parameters.po),this.en.Er.cr("uRayMaxDistance",this.parameters.vo),this.en.Er.cr("uReflectionRayThickness",this.parameters.do),this.en.Er.cr("uReflectionRayJitterSizeX",this.parameters.xo),this.en.Er.cr("uReflectionRayJitterSizeY",this.parameters.yo),this.en.Er.cr("uReflectionFadeMinDistance",this.parameters.To),this.en.Er.cr("uReflectionFadeMaxDistance",this.parameters.wo),this.en.Er.cr("uReflectionScreenEdgeFadeFactorMinX",this.parameters.So),this.en.Er.cr("uReflectionScreenEdgeFadeFactorMaxX",this.parameters.bo),this.en.Er.cr("uReflectionScreenEdgeFadeFactorMinY",this.parameters.Co),this.en.Er.cr("uReflectionScreenEdgeFadeFactorMaxY",this.parameters.Mo),this.en.Er.cr("uReflectionAdditionalRate",this.parameters.zo),this.en.Er.cr("uReflectionRoughnessPower",this.parameters.Po),this.en.Er.cr("uBlendRate",this.parameters.fo),super.Tn(e)}}class Pi extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0}}(e.parameters),r=[{name:Ae,type:q,value:null}];super({$e:t,type:K.G,name:"ToneMappingPass",Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;vec3 v(vec3 v){return clamp(v*(2.51*v+.03)/(v*(2.43*v+.59)+.14),0.,1.);}void main(){vec3 o=texture(uSrcTexture,vUv).xyz;o=v(o);o=pow(o,vec3(1./2.2));if(o.x>1.||o.y>1.||o.z>1.)o=vec3(1,0,1);outColor=vec4(o,1);}",Er:r,parameters:i})}Tn(e){super.Tn(e)}}class zi extends ii{constructor(e){const{$e:t,Ui:i,Er:r=[],Ar:s=[],name:n,fn:a,mn:o}=e,u=function(e={}){return{enabled:e.enabled??!0}}(e.parameters??{});super({$e:t,type:K.H,Ui:i,Er:r,Ar:s,name:n,fn:a,mn:o,parameters:u})}}function Di(e,t){const i=Math.floor(e/2);let r=0;const s=new Array(e).fill(0).map(((e,s)=>{const n=function(e,t){const i=e*e;return Math.exp(-t*t/(2*i))}(t,s-i);return r+=n,n}));return s.map((e=>e/r))}const Ri="#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform float uTargetWidth,uTargetHeight;uniform float[7] uBlurWeights;uniform float uIsHorizontal;void main(){vec4 u=vec4(0);vec2 f=vec2(1./uTargetWidth,1./uTargetHeight);float v=floor(float(7)/2.);for(int i=0;i<7;i++){float l=float(i)-v,r=uBlurWeights[i];u+=texture(uSrcTexture,vUv+vec2(step(.5,uIsHorizontal)>.5?l:0.,step(.5,uIsHorizontal)>.5?0.:l)*f)*r;}outColor=u;}";function Li({enabled:e,threshold:t,tone:i,Do:r}={}){return{enabled:e??!0,threshold:t??1.534,tone:i??.46,Do:r??.26}}class Bi{constructor({$e:e,parameters:t}){this.name="BloomPass",this.type=K.D,this.width=1,this.height=1,this.tn=[],this.parameters=Li(t),this.qs=new Et({$e:e}),this.Ro=new _t({$e:e,type:_}),this.Lo=new _t({$e:e,type:_}),this.Bo=new _t({$e:e,type:_}),this.Uo=new _t({$e:e,type:_}),this.Io=new _t({$e:e,type:_}),this.Vo=new _t({$e:e,type:_}),this.No=new _t({$e:e,type:_}),this.Eo=new _t({$e:e,type:_}),this.Ao=new _t({$e:e,type:_}),this.Fo=new _t({$e:e,type:_}),this.Oo=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;out vec4 outColor;in vec2 vUv;uniform sampler2D uSrcTexture;uniform float uThreshold;void main(){outColor=vec4(max(texture(uSrcTexture,vUv).xyz-vec3(1.+uThreshold),vec3(0)),1);}",Er:[{name:"uThreshold",type:ue,value:this.parameters.threshold}],fn:_}),this.tn.push(...this.Oo.tn);const i=Di(7,.92);this._o=new Yt({Bi:ii.pn,Ui:Ri,Er:[{name:Ae,type:q,value:null},{name:"uBlurWeights",type:le,value:new Float32Array(i)},{name:"uIsHorizontal",type:ue,value:1},...ii.vn]}),this.tn.push(this._o),this.ko=new Yt({Bi:ii.pn,Ui:Ri,Er:[{name:Ae,type:q,value:null},{name:"uBlurWeights",type:le,value:new Float32Array(i)},{name:"uIsHorizontal",type:ue,value:0},...ii.vn]}),this.tn.push(this.ko),this.Go=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture,uBlur4Texture,uBlur8Texture,uBlur16Texture,uBlur32Texture,uBlur64Texture,uExtractTexture;uniform float uTone,uBloomAmount;void main(){outColor=texture(uSrcTexture,vUv)*uTone+(texture(uBlur4Texture,vUv)+texture(uBlur8Texture,vUv)+texture(uBlur16Texture,vUv)+texture(uBlur32Texture,vUv)+texture(uBlur64Texture,vUv))*.2*uBloomAmount;}",Er:[{name:Ae,type:q,value:null},{name:"uBlur4Texture",type:q,value:null},{name:"uBlur8Texture",type:q,value:null},{name:"uBlur16Texture",type:q,value:null},{name:"uBlur32Texture",type:q,value:null},{name:"uTone",type:ue,value:this.parameters.tone},{name:"uBloomAmount",type:ue,value:this.parameters.Do},{name:"uExtractTexture",type:q,value:null},...ii.vn],fn:_}),this.tn.push(...this.Go.tn)}get jo(){return this.Lo}get $o(){return this.Uo}get Ho(){return this.Vo}get Wo(){return this.Eo}get Xo(){return this.Fo}get xn(){return this.Go.xn}it(e,t){this.width=e,this.height=t,this.Oo.it(e,t),this.Ro.it(this.width/4,this.height/4),this.Lo.it(this.width/4,this.height/4),this.Bo.it(this.width/8,this.height/8),this.Uo.it(this.width/8,this.height/8),this.Io.it(this.width/16,this.height/16),this.Vo.it(this.width/16,this.height/16),this.No.it(this.width/32,this.height/32),this.Eo.it(this.width/32,this.height/32),this.Ao.it(this.width/64,this.height/64),this.Fo.it(this.width/64,this.height/64),this.Go.it(e,t)}yn(e,t,i){}update(){}Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,Sa:n,wn:a,time:o}){this.qs.start(),this._o.Wr||this._o.start({$e:e,Xr:this.qs.ri()}),this.ko.Wr||this.ko.start({$e:e,Xr:this.qs.ri()}),this.Jo(),this.Oo.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:!1,wn:a,time:o});const u=(e,t,r,s)=>{const n=this.width/s,a=this.height/s;i.yn(e,!0),this._o.Er.cr(Ae,r.tt),this._o.Er.cr("uTargetWidth",n),this._o.Er.cr("uTargetHeight",n),i.Pn(this.qs,this._o),i.yn(t,!0),this.ko.Er.cr(Ae,e.tt),this.ko.Er.cr("uTargetWidth",n),this.ko.Er.cr("uTargetHeight",a),i.Pn(this.qs,this.ko)};u(this.Ro,this.Lo,this.Oo.xn,4),u(this.Bo,this.Uo,this.Lo,8),u(this.Io,this.Vo,this.Uo,16),u(this.No,this.Eo,this.Vo,32),u(this.Ao,this.Fo,this.Eo,64),r&&this.Go.en.Er.cr(Ae,r.tt),this.Go.en.Er.cr("uBlur4Texture",this.Lo.tt),this.Go.en.Er.cr("uBlur8Texture",this.Uo.tt),this.Go.en.Er.cr("uBlur16Texture",this.Vo.tt),this.Go.en.Er.cr("uBlur32Texture",this.Eo.tt),this.Go.en.Er.cr("uBlur64Texture",this.Fo.tt),this.Go.en.Er.cr("uExtractTexture",this.Oo.xn.tt),this.Go.Tn({$e:e,Da:t,Sn:i,bn:null,Cn:s,wn:a,Sa:n,time:o})}Yo(e){var t,i;this.parameters=(t=this.parameters,i=e,{...t,enabled:i.enabled??t.enabled,threshold:i.threshold??t.threshold,tone:i.tone??t.tone,Do:i.Do??t.Do}),this.Jo()}Jo(){this.Oo.en.Er.cr("uThreshold",this.parameters.threshold),this.Go.en.Er.cr("uTone",this.parameters.tone),this.Go.en.Er.cr("uBloomAmount",this.parameters.Do)}}function Ui(e={}){return{enabled:e.enabled??!0,Ko:e.Ko??14,Zo:e.Zo??10,Qo:e.Qo??4}}class Ii{constructor({$e:e,parameters:t}){this.type=K.R,this.name="DepthOfFieldPass",this.enabled=!0,this.width=1,this.height=1,this.tn=[],this.qs=new Et({$e:e}),this.parameters=Ui(t),this.qo=new zi({name:"circleOfConfusionPass",$e:e,Ui:"#version 300 es\nprecision mediump float;float u(float u,float v,float f){float m=v*u;return-m/(f*(u-1.)-m);}float v(float v,float f,float e){return mix(f,e,u(v,f,e));}in vec2 vUv;out vec4 outColor;layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};uniform sampler2D uSrcTexture,uDepthTexture;uniform float uFocusDistance,uFocusRange,uBokehRadius;void main(){float u=v(texture(uDepthTexture,vUv).x,uNearClip,uFarClip),f=(u-uFocusDistance)/uFocusRange;f=clamp(f,-1.,1.)*uBokehRadius;outColor=vec4(vec3(f),1);}",Er:[{name:Ae,type:q,value:null},{name:Ve,type:q,value:null},{name:"uFocusDistance",type:ue,value:this.parameters.Ko},{name:"uFocusRange",type:ue,value:this.parameters.Zo},{name:"uBokehRadius",type:ue,value:this.parameters.Qo},{name:"uCocParams",type:se,value:li.Ot},...ii.vn],Ar:[lt],fn:k}),this.tn.push(...this.qo.tn),this.eu=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture,uCocTexture;uniform vec2 uTexelSize;float e(vec3 v){return 1./(1.+max(max(v.x,v.y),v.z));}void main(){vec4 v=uTexelSize.xyxy*vec2(-.5,.5).xxyy;vec3 u=texture(uSrcTexture,vUv+v.xy).xyz,m=texture(uSrcTexture,vUv+v.zy).xyz,y=texture(uSrcTexture,vUv+v.xw).xyz,w=texture(uSrcTexture,vUv+v.zw).xyz;float x=e(u),z=e(m),r=e(y),t=e(w),C=texture(uCocTexture,vUv+v.xy).xyz.x,D=texture(uCocTexture,vUv+v.zy).xyz.x,L=texture(uCocTexture,vUv+v.xw).xyz.x,K=texture(uCocTexture,vUv+v.zw).xyz.x,f=0.,I=min(min(min(C,D),L),K),d=max(max(max(C,D),L),K);f=d>=-I?d:I;vec3 o=u*x+m*z+y*r+w*t;o/=dot(vec4(x,z,r,t),vec4(1));outColor=vec4(o.xyz,f);}",Er:[{name:"uCocTexture",type:q,value:null},{name:"uTexelSize",type:te,value:ri.Ot},...ii.vn],fn:O}),this.tn.push(...this.eu.tn),this.tu=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform vec2 uTexelSize;uniform float uBokehRadius;\n#define BOKEH_KERNEL_MEDIUM\n#define KERNEL_SAMPLE_COUNT 22\nconst vec2[22] v=vec2[](vec2(0),vec2(.53333336,0),vec2(.3325279,.4169768),vec2(-.11867785,.5199616),vec2(-.48051673,.2314047),vec2(-.48051673,-.23140468),vec2(-.11867763,-.51996166),vec2(.33252785,-.4169769),vec2(1,0),vec2(.90096885,.43388376),vec2(.6234898,.7818315),vec2(.22252098,.9749279),vec2(-.22252095,.9749279),vec2(-.62349,.7818314),vec2(-.90096885,.43388382),vec2(-1,0),vec2(-.90096885,-.43388376),vec2(-.6234896,-.7818316),vec2(-.22252055,-.974928),vec2(.2225215,-.9749278),vec2(.6234897,-.7818316),vec2(.90096885,-.43388376));float m(float v,float m){return clamp((v-m+2.)/2.,0.,1.);}void main(){vec2 e=uTexelSize;vec3 f=vec3(0),u=vec3(0);float o=0.,i=0.,T=texture(uSrcTexture,vUv).w;for(int B=0;B<KERNEL_SAMPLE_COUNT;B++){vec2 K=v[B].xy*uBokehRadius;float c=length(K);K*=e;vec4 t=texture(uSrcTexture,vUv+K);float s=m(max(0.,min(t.w,T)),c);f+=t.xyz*s;o+=s;float r=m(-t.w,c);u+=t.xyz*r;i+=r;}f*=vec3(1)/(o+(o==0.?1.:0.));u*=vec3(1)/(i+(i==0.?1.:0.));float c=min(1.,i*3.141592/float(KERNEL_SAMPLE_COUNT));vec3 K=mix(f,u,c);outColor=vec4(K,c);}",fn:O,Er:[{name:"uTexelSize",type:te,value:ri.Ot},{name:"uBokehRadius",type:ue,value:this.parameters.Qo},{name:"uBokehKernel",type:ne,value:[]}]}),this.tn.push(...this.tu.tn),this.iu=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform vec2 uTexelSize;uniform float uBokehRadius;void main(){vec4 v=uTexelSize.xyxy*vec2(-.5,.5).xxyy;outColor=(texture(uSrcTexture,vUv+v.xy)+texture(uSrcTexture,vUv+v.zy)+texture(uSrcTexture,vUv+v.xw)+texture(uSrcTexture,vUv+v.zw))*.25;}",fn:O,Er:[{name:"uTexelSize",type:te,value:ri.Ot},{name:"uBokehRadius",type:ue,value:this.parameters.Qo}]}),this.tn.push(...this.iu.tn),this.Go=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture,uCocTexture,uDofTexture;void main(){vec4 v=texture(uDofTexture,vUv);float u=smoothstep(.1,1.,texture(uCocTexture,vUv).x);outColor=vec4(mix(texture(uSrcTexture,vUv).xyz,v.xyz,u+v.w-u*v.w),1);}",fn:_,Er:[{name:"uCocTexture",type:q,value:null},{name:"uDofTexture",type:q,value:null}]}),this.tn.push(...this.Go.tn)}get xn(){return this.Go.xn}it(e,t){this.width=e,this.height=t,this.qo.it(e,t),this.eu.it(e/2,t/2),this.tu.it(e/2,t/2),this.iu.it(e/2,t/2),this.Go.it(e,t)}yn(e,t,i){}update(){}Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,Sa:n,wn:a,time:o}){this.qs.start(),this.qo.en.Er.cr("uFocusDistance",this.parameters.Ko),this.qo.en.Er.cr("uFocusRange",this.parameters.Zo),this.qo.en.Er.cr("uBokehRadius",this.parameters.Qo),this.qo.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:!1,wn:a,Sa:n,time:o}),this.eu.en.Er.cr("uCocTexture",this.qo.xn.tt),this.eu.en.Er.cr("uTexelSize",new ri(1/this.qo.width,1/this.qo.height)),this.eu.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:!1,wn:a,Sa:n,time:o}),this.tu.en.Er.cr("uTexelSize",new ri(1/this.eu.width,1/this.eu.height)),this.tu.en.Er.cr("uBokehRadius",this.parameters.Qo),this.tu.Tn({$e:e,Da:t,Sn:i,bn:this.eu.xn,Cn:!1,wn:a,Sa:n,time:o}),this.iu.en.Er.cr("uTexelSize",new ri(1/this.tu.width,1/this.tu.height)),this.iu.en.Er.cr("uBokehRadius",this.parameters.Qo),this.iu.Tn({$e:e,Da:t,Sn:i,bn:this.tu.xn,Cn:!1,wn:a,Sa:n,time:o}),this.Go.en.Er.cr("uCocTexture",this.qo.xn.tt),this.Go.en.Er.cr("uDofTexture",this.iu.xn.tt),this.Go.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,wn:a,Sa:n,time:o})}}const Vi="#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform vec2 uRadialBlurOrigin;uniform float uRadialBlurPassScaleBase,uRadialBlurPassIndex,uRadialBlurRayStepStrength;void main(){outColor=texture(uSrcTexture,vUv);float v=0.;vec4 u=vec4(0);vec2 e=(uRadialBlurOrigin-vUv)*pow(uRadialBlurPassScaleBase*float(12),uRadialBlurPassIndex)*uRadialBlurRayStepStrength;for(int f=0;f<=12;f++){float r=float(f);vec2 o=vUv+e*r;o=vec2(clamp(o.x,0.,1.),clamp(o.y,0.,1.));u+=texture(uSrcTexture,o);v+=1.;}u/=v;outColor=u;}";class Ni{constructor({$e:e,ratio:t=.5,parameters:i}){this.name="LightShaftPass",this.type=K.N,this.width=1,this.height=1,this.tn=[],this.#d=null,this.#g="uRadialBlurOrigin",this.#x="uRadialBlurPassScaleBase",this.#y="uRadialBlurPassIndex",this.#T="uRadialBlurRayStepStrength",this.ratio=1,this.parameters=function(e={}){return{enabled:e.enabled||!0,fo:e.fo||.65,ru:e.ru||.2,su:e.su||.012}}(i),this.ratio=t,this.qs=new Et({$e:e}),this.nu=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture,uDepthTexture;uniform float uNearClip,uFarClip;void main(){float v=texture(uDepthTexture,vUv).x,u=step(1e-4,1.-v)*v;u*=smoothstep(0.,.05,vUv.x)*(1.-smoothstep(.95,1.,vUv.x))*smoothstep(0.,.05,vUv.y)*(1.-smoothstep(.95,1.,vUv.y));outColor=vec4(vec3(u),1);}",fn:_,Er:[{name:Ve,type:q,value:null},...ii.vn]}),this.tn.push(...this.nu.tn),this.au=new zi({$e:e,Ui:Vi,fn:_,Er:[{name:this.#y,type:ue,value:0},{name:this.#g,type:te,value:ri.identity},{name:this.#x,type:ue,value:this.parameters.ru},{name:this.#T,type:ue,value:this.parameters.su}]}),this.tn.push(...this.au.tn),this.ou=new zi({$e:e,Ui:Vi,fn:_,Er:[{name:this.#y,type:ue,value:1},{name:this.#g,type:te,value:ri.identity},{name:this.#x,type:ue,value:this.parameters.ru},{name:this.#T,type:ue,value:this.parameters.su}]}),this.tn.push(...this.ou.tn),this.uu=new zi({$e:e,Ui:Vi,fn:_,Er:[{name:this.#y,type:ue,value:2},{name:this.#g,type:te,value:ri.identity},{name:this.#x,type:ue,value:this.parameters.ru},{name:this.#T,type:ue,value:this.parameters.su}]}),this.tn.push(...this.uu.tn),this.Go=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture,uLightShaftTexture;uniform float uBlendRate;void main(){vec4 v=texture(uLightShaftTexture,vUv);float u=mix(0.,1.,v.x*v.x);u*=uBlendRate;outColor=vec4(vec3(u),1);}",fn:_,Er:[{name:"uLightShaftTexture",type:q,value:null},{name:"uBlendRate",type:ue,value:this.parameters.fo}]}),this.tn.push(...this.Go.tn)}#d;#g;#x;#y;#T;get xn(){return this.Go.xn}it(e,t){this.width=e*this.ratio,this.height=t*this.ratio,this.nu.it(this.width,this.height),this.au.it(this.width,this.height),this.ou.it(this.width,this.height),this.uu.it(this.width,this.height),this.Go.it(this.width,this.height)}yn(e,t,i){}update(){}Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,Sa:n,wn:a,time:o}){this.qs.start(),this.nu.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:!1,wn:a,Sa:n,time:o});const u=a.aa(this.#d.transform.position.clone().scale(1e4)),l=new ri(.5*u.x+.5,.5*u.y+.5);this.au.en.Er.cr(this.#g,l),this.au.en.Er.cr(this.#x,this.parameters.ru),this.au.en.Er.cr(this.#T,this.parameters.su),this.ou.en.Er.cr(this.#g,l),this.ou.en.Er.cr(this.#x,this.parameters.ru),this.ou.en.Er.cr(this.#T,this.parameters.su),this.uu.en.Er.cr(this.#g,l),this.uu.en.Er.cr(this.#x,this.parameters.ru),this.uu.en.Er.cr(this.#T,this.parameters.su),this.au.Tn({$e:e,Da:t,Sn:i,bn:this.nu.xn,Cn:!1,wn:a,Sa:n,time:o}),this.ou.Tn({$e:e,Da:t,Sn:i,bn:this.au.xn,Cn:!1,wn:a,Sa:n,time:o}),this.uu.Tn({$e:e,Da:t,Sn:i,bn:this.ou.xn,Cn:!1,wn:a,Sa:n,time:o}),this.Go.en.Er.cr("uLightShaftTexture",this.uu.xn.read.tt),this.Go.en.Er.cr("uBlendRate",this.parameters.fo),this.Go.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,wn:a,Sa:n,time:o})}lu(e){this.#d=e}}class Ei extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0,hu:e.hu??.5,fo:e.fo??1,cu:e.cu??1,fu:e.fu??.1,mu:e.mu??.1,ratio:e.ratio??.5}}(e.parameters??{});super({$e:t,type:K.$,Ui:"#version 300 es\nprecision highp float;\n#pragma DEFINES\n#define MAX_SPOT_LIGHT_COUNT 4\n#define MAX_POINT_LIGHT_COUNT 4\n#define MARCH_COUNT 64\n#define MARCH_COUNT_F 64.\n#define saturate(a)clamp(a,0.,1.)\nbool u(const float u,const float f){return any(bvec2(f==0.,u<f));}float u(const float u,const float e,const float f){return f>0.?pow(saturate(-u/e+1.),f):1.;}in vec2 vUv;out vec4 outColor;layout(std140) uniform ubCommon{float uTime;vec4 uViewport;};layout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};struct SpotLight{vec4 color;vec3 position;vec3 direction;float intensity;float distance;float attenuation;float coneCos;float penumbraCos;mat4 shadowMapProjectionMatrix;};layout(std140) uniform ubSpotLight{SpotLight uSpotLight[MAX_SPOT_LIGHT_COUNT];};uniform sampler2D uSrcTexture,uGBufferATexture,uDepthTexture,uVolumetricDepthTexture;uniform float uBlendRate;uniform sampler2D uSpotLightShadowMap[MAX_SPOT_LIGHT_COUNT];uniform float uDensityMultiplier,uRayStep,uRayJitterSizeX,uRayJitterSizeY;float f(float u,float e,float f){float s=e*u;return-s/(f*(u-1.)-s);}float e(float u,float s,float e){return mix(s,e,f(u,s,e));}vec3 p(vec2 u,float f,mat4 e){vec4 s=e*vec4(u*2.-1.,f*2.-1.,1);return s.xyz/s.w;}\n#define SHADING_MODEL_NUM 3.\nstruct GBufferA{vec3 baseColor;};struct GBufferB{vec3 normal;float shadingModelId;};struct GBufferC{float metallic;float roughness;};struct GBufferD{vec3 emissiveColor;};float e(SpotLight f,sampler2D s,vec3 e,vec3 a,float M){float r=0.;vec4 v=f.shadowMapProjectionMatrix*vec4(e,1);vec3 c=v.xyz/v.w;float p=v.z/v.w,m=texture(s,c.xy).x,y=step(0.,c.x)*(1.-step(1.,c.x))*step(0.,c.y)*(1.-step(1.,c.y))*step(0.,c.z)*(1.-step(1.,c.z));vec3 n=f.position-e;float G=length(n),z=dot(normalize(-normalize(n)),f.direction),x=smoothstep(f.coneCos,f.penumbraCos,z),t=u(G,f.distance,f.attenuation);if(abs(a.z)<M)if(all(bvec4(z>f.coneCos,u(G,f.distance),m>p,m<1.)))r=1./MARCH_COUNT_F*t*x*y*uDensityMultiplier;return r;}void main(){vec2 u=vUv;float f=fract(sin(dot(u+uTime,vec2(12.9898,78.233)))*43758.5453)*2.-1.;vec2 s=vec2(f*uRayJitterSizeX,f*uRayJitterSizeY*uViewport.z);vec3 v=p(vUv,texture(uVolumetricDepthTexture,vUv).x,uInverseViewProjectionMatrix),c=v+vec3(s,0),y=normalize(c-uViewPosition);float r=0.;vec4 m=vec4(vec3(0),1);float[MAX_SPOT_LIGHT_COUNT] t;vec3 a,x;float z=e(texture(uDepthTexture,u).x,uNearClip,uFarClip);for(int n=0;n<MARCH_COUNT;n++)r=uRayStep*float(n),a=c+y*r,x=(uViewMatrix*vec4(a,1)).xyz,t[0]+=e(uSpotLight[0],uSpotLightShadowMap[0],a,x,z),t[1]+=e(uSpotLight[1],uSpotLightShadowMap[1],a,x,z),t[2]+=e(uSpotLight[2],uSpotLightShadowMap[2],a,x,z),t[3]+=e(uSpotLight[3],uSpotLightShadowMap[3],a,x,z);vec4 n=vec4(0);float G=0.;vec4 l=vec4(0);float M=0.;M=t[0]*uSpotLight[0].intensity*uBlendRate;G+=M;l=M*uSpotLight[0].color;n+=l;M=t[1]*uSpotLight[1].intensity*uBlendRate;G+=M;l=M*uSpotLight[1].color;n+=l;M=t[2]*uSpotLight[2].intensity*uBlendRate;G+=M;l=M*uSpotLight[2].color;n+=l;M=t[3]*uSpotLight[3].intensity*uBlendRate;G+=M;l=M*uSpotLight[3].color;n+=l;m.w=G;m.xyz=n.xyz;outColor=m;}",Er:[{name:et,type:me,value:yi.range(4).map((()=>null))},{name:"uRayStep",type:ue,value:0},{name:"uDensityMultiplier",type:ue,value:0},{name:"uRayJitterSizeX",type:ue,value:0},{name:"uRayJitterSizeY",type:ue,value:0},{name:Re,type:q,value:null},{name:Ve,type:q,value:null},{name:"uVolumetricDepthTexture",type:q,value:null},{name:"uBlendRate",type:ue,value:1}],Ar:[ot,ut,lt,ct],fn:O,parameters:i}),this.#w=[],this.pu=1,this.vu=1,this.parameters=i,this.du=new _t({$e:t,type:A,width:1,height:1,et:N}),this.gu=new Yt({Bi:`#version 300 es\n                    \n                    layout (location = 0) in vec3 ${H};\n\nuniform mat4 uWorldMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n                    \n                    // out vec4 vWorldPosition;\n                   \n                    void main() {\n                        vec4 worldPosition = ${ve} * vec4(${H}, 1.);\n                        // vWorldPosition = worldPosition;\n                        gl_Position = ${ge} * ${de} * worldPosition;\n                    }\n                    `,Ui:"#version 300 es\n                   \n                    precision mediump float;\n\n                    // in vec4 vWorldPosition; \n                    out vec4 outColor;\n                 \n                    void main() {\n                        outColor = vec4(1., 0., 0., 1.);\n                        // outColor = vec4(vWorldPosition.xyz, 1.);\n                    }\n                    ",primitiveType:n,Ur:l,Rr:o,zr:!0,Pr:!0,Br:C,Er:[{name:ve,type:Z,value:null},{name:de,type:Z,value:null},{name:ge,type:Z,value:null}]}),this.tn.push(this.gu)}#w;it(e,t){this.pu=e,this.vu=t,this.width=Math.floor(e*this.parameters.ratio),this.height=Math.floor(t*this.parameters.ratio),super.it(this.width,this.height),this.du.it(this.pu,this.vu),this.en.Er.cr(_e,this.width),this.en.Er.cr(ke,this.height)}Tn(e){const{$e:t,Sn:i}=e;!this.gu.Wr&&this.#w.length>0&&this.gu.start({$e:t,Xr:this.#w[0].xu?.Kn?.qs.ri()}),i.yn(this.du.write,!1,!0),this.gu.Er.cr(de,e.wn.jn),this.gu.Er.cr(ge,e.wn.projectionMatrix),this.#w.forEach((e=>{e.xu&&null!==e.xu.Kn&&(this.gu.Er.cr(ve,e.xu.transform.xs),i.Pn(e.xu.Kn.qs,this.gu))})),this.en.Er.cr(et,this.#w.map((e=>e.yu?e.yu?.read.Mi:null))),this.en.Er.cr("uVolumetricDepthTexture",this.du.Mi),this.en.Er.cr("uRayStep",this.parameters.hu),this.en.Er.cr("uDensityMultiplier",this.parameters.cu),this.en.Er.cr("uRayJitterSizeX",this.parameters.fu),this.en.Er.cr("uRayJitterSizeY",this.parameters.mu),this.en.Er.cr("uBlendRate",this.parameters.fo),super.Tn(e)}Tu(e){this.#w=e}}const Ai="uFogColor",Fi="uFogStrength",Oi="uFogDensity",_i="uFogDensityAttenuation",ki="uFogEndHeight",Gi="uDistanceFogStart",ji="uDistanceFogPower";class $i extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0,wu:e.wu??wi.Za,Su:e.Su??.01,bu:e.bu??.023,Cu:e.Cu??.45,Mu:e.Mu??1,Pu:e.Pu??20,zu:e.zu??.1,fo:e.fo??1}}();super({$e:t,type:K.W,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;\n#define saturate(a)clamp(a,0.,1.)\nlayout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};uniform sampler2D uSrcTexture,uLightShaftTexture,uVolumetricLightTexture,uDepthTexture;uniform vec4 uFogColor;uniform float uFogStrength,uFogDensity,uFogDensityAttenuation,uFogEndHeight,uDistanceFogStart,uDistanceFogPower,uBlendRate;vec3 u(vec2 u,float e,mat4 v){vec4 r=v*vec4(u*2.-1.,e*2.-1.,1);return r.xyz/r.w;}vec3 e(vec2 u,float e,mat4 v){vec4 r=v*vec4(u*2.-1.,e*2.-1.,1);return r.xyz/r.w;}float e(vec3 u,vec3 e,float v,float r){vec3 m=e-u;float x,f=length(m)*v*exp(-r*u.y);if(m.y==0.)x=exp(-f);else{float s=r*m.y;x=exp(f/s*(exp(-s)-1.));}return 1.-x;}float u(vec3 u,vec3 e,float v,float r){float f=length(e-u);f=max(0.,f-v);return max(0.,1.-exp(-f*r));}void main(){vec2 v=vUv;vec4 r=texture(uSrcTexture,v);float f=saturate(texture(uLightShaftTexture,v).x),x=texture(uDepthTexture,v).x;vec3 m=u(v,x,uInverseViewProjectionMatrix);float s=e(m,uViewPosition,uFogDensity,uFogDensityAttenuation);s*=1.-step(.9999,x);s+=u(m,uViewPosition,uDistanceFogStart,uDistanceFogPower);s=saturate(s);outColor=vec4(mix((r*(1.-f)).xyz,uFogColor.xyz.xyz,s),1);outColor+=vec4(texture(uVolumetricLightTexture,v).xyz,0);outColor=vec4(mix(r.xyz,outColor.xyz,uBlendRate),1);}",fn:_,Er:[{name:Ai,type:ce,value:wi.Za},{name:Ve,type:q,value:null},{name:$i.Du,type:q,value:null},{name:$i.Ru,type:q,value:null},{name:Fi,type:ue,value:i.Su},{name:Oi,type:ue,value:i.bu},{name:_i,type:ue,value:i.Cu},{name:ki,type:ue,value:i.Mu},{name:Gi,type:ue,value:i.Pu},{name:ji,type:ue,value:i.zu},{name:"uBlendRate",type:ue,value:1}],Ar:[lt],parameters:i}),this.parameters=i}static{this.Du="uLightShaftTexture"}static{this.Ru="uVolumetricLightTexture"}Lu(e){this.en.Er.cr($i.Du,e.read.tt)}Bu(e){this.en.Er.cr($i.Ru,e.read.tt)}Tn(e){this.en.Er.cr(Ai,this.parameters.wu),this.en.Er.cr(Fi,this.parameters.Su),this.en.Er.cr(Oi,this.parameters.bu),this.en.Er.cr(_i,this.parameters.Cu),this.en.Er.cr(ki,this.parameters.Mu),this.en.Er.cr(Gi,this.parameters.Pu),this.en.Er.cr(ji,this.parameters.zu),this.en.Er.cr("uBlendRate",this.parameters.fo),super.Tn(e)}}const Hi="uChromaticAberrationScale";class Wi extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0}}(e.parameters??{});super({$e:t,type:K.B,Ui:"#version 300 es\nprecision mediump float;in vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform float uTargetWidth,uTargetHeight,uChromaticAberrationScale;const vec3 v[5]=vec3[](vec3(0,0,.5),vec3(0,.25,.5),vec3(0,.5,0),vec3(.5,.25,0),vec3(.5,0,0));void main(){vec2 e=vUv*2.-1.;outColor=vec4(0);for(int u=0;u<5;u++){vec2 f=e*(1.-uChromaticAberrationScale*(float(u)+1.)/float(5));f=(f+1.)*.5;vec3 m=v[u];vec4 i=texture(uSrcTexture,f);outColor+=vec4(i.xyz*m,1);}}",Er:[{name:Hi,type:ue,value:.015}],parameters:i}),this.Uu=.015}it(e,t){super.it(e,t),this.en.Er.cr(_e,e),this.en.Er.cr(ke,t)}Tn(e){this.en.Er.cr(Hi,this.Uu),super.Tn(e)}}const Xi="uVignetteRadius",Ji="uVignettePower",Yi="uBlendRate";class Ki extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0,Iu:e.Iu??2.5,Vu:e.Vu??1.4,fo:e.fo??1}}(e.parameters??{});super({$e:t,type:K.j,Ui:"#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nin vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform float uVignetteRadius,uVignettePower,uBlendRate,uAspect;void main(){vec2 u=vUv*2.-1.;u.x*=uAspect;float v=dot(u,u);outColor=vec4(mix(texture(uSrcTexture,vUv).xyz,vec3(0),pow(min(1.,v/uVignetteRadius),uVignettePower)*uBlendRate),1);}",Er:[{name:Xi,type:ue,value:2.5},{name:Ji,type:ue,value:1.4},{name:Yi,type:ue,value:1},{name:Ge,type:ue,value:1}],parameters:i}),this.parameters=i}it(e,t){super.it(e,t),this.en.Er.cr(Ge,e/t)}Tn(e){this.en.Er.cr(Xi,this.parameters.Iu),this.en.Er.cr(Ji,this.parameters.Vu),this.en.Er.cr(Yi,this.parameters.fo),super.Tn(e)}}class Zi{constructor({$e:e,parameters:t}){this.name="StreakPass",this.type=K.k,this.width=1,this.height=1,this.tn=[],this.Nu=[],this.Eu=[],this.Au=0,this.parameters=function(e={}){return{enabled:e.enabled||!0,threshold:e.threshold||.9,stretch:e.stretch||.5,color:e.color||wi.Za,Fu:e.Fu||.6,Ou:e.Ou||1.5,_u:e._u||1.25}}(t),this.qs=new Et({$e:e}),this.ku=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nin vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform vec2 uTexelSize;uniform float uThreshold,uVerticalScale;void main(){float u=uTexelSize.y*uVerticalScale/2.;vec2 v=vUv;vec3 e=(texture(uSrcTexture,vec2(v.x,v.y-u)).xyz+texture(uSrcTexture,vec2(v.x,v.y+u)).xyz)/2.;float a=max(e.x,max(e.y,e.z));e*=max(0.,a-uThreshold)/max(a,1e-5);outColor=vec4(e,1);}",Er:[{name:Ae,type:q,value:null},{name:je,type:te,value:ri.Ot},{name:"uThreshold",type:ue,value:this.parameters.threshold},{name:"uVerticalScale",type:ue,value:this.parameters.Ou},...ii.vn],fn:_}),this.tn.push(...this.ku.tn);const i=[2,4,8,16,32].map((t=>{const i=new zi({name:`DownSampleMip${t}Pass`,$e:e,Ui:"#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nin vec2 vUv;out vec4 outColor;uniform sampler2D uPrevTexture;uniform vec2 uTexelSize;uniform float uHorizontalScale;void main(){vec2 v=vUv;float e=uTexelSize.x*uHorizontalScale;outColor=vec4(((texture(uPrevTexture,vec2(v.x-e*5.,v.y))+texture(uPrevTexture,vec2(v.x-e*3.,v.y))+texture(uPrevTexture,vec2(v.x-e,v.y))+texture(uPrevTexture,vec2(v.x+e,v.y))+texture(uPrevTexture,vec2(v.x+e*3.,v.y))+texture(uPrevTexture,vec2(v.x+e*5.,v.y)))/6.).xyz,1);}",Er:[{name:je,type:te,value:ri.Ot},{name:"uPrevTexture",type:q,value:null},{name:"uHorizontalScale",type:ue,value:this.parameters._u},...ii.vn]});return this.tn.push(...i.tn),{xa:i,Gu:t}}));this.Nu=i.map((({xa:e,Gu:t},r)=>({xa:e,ju:0===r?this.ku:i[r-1].xa,Gu:t})));const r=yi.range(5).map(((t,i)=>{const r=new zi({name:`UpSampleMip${i}Pass`,$e:e,Ui:"#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nin vec2 vUv;out vec4 outColor;uniform sampler2D uDownSampleTexture,uPrevTexture;uniform float uStretch;void main(){vec2 u=vUv;outColor=vec4(mix(texture(uDownSampleTexture,u).xyz,texture(uPrevTexture,u).xyz*.25+texture(uPrevTexture,u).xyz*.5+texture(uPrevTexture,u).xyz*.25,uStretch).xyz,1);}",Er:[{name:"uDownSampleTexture",type:q,value:null},{name:"uPrevTexture",type:q,value:null},{name:"uStretch",type:ue,value:this.parameters.stretch},...ii.vn]});return this.tn.push(...r.tn),{xa:r}}));this.Eu=r.map((({xa:e},t)=>({xa:e,ju:0===t?this.Nu[this.Nu.length-1].xa:r[t-1].xa,$u:this.Nu[this.Nu.length-1-t].xa}))),this.Go=new zi({$e:e,Ui:"#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nin vec2 vUv;out vec4 outColor;uniform vec4 uColor;uniform float uIntensity;uniform sampler2D uSrcTexture,uStreakTexture;void main(){vec2 u=vUv;outColor=vec4((texture(uStreakTexture,u).xyz*.25+texture(uStreakTexture,u).xyz*.5+texture(uStreakTexture,u).xyz*.25)*uColor.xyz*uIntensity*5.+texture(uSrcTexture,u).xyz,1);}",Er:[{name:"uStreakTexture",type:q,value:null},{name:"uColor",type:ce,value:this.parameters.color},{name:"uIntensity",type:ue,value:this.parameters.Fu},...ii.vn],fn:_}),this.tn.push(...this.Go.tn)}get xn(){return this.Go.xn}it(e,t){this.width=e,this.height=t,this.Au=Math.floor(this.height/2),this.ku.it(this.width,this.Au),this.Go.it(this.width,this.height)}yn(e,t,i){}update(){}Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,Sa:n,wn:a,time:o}){this.qs.start(),this.ku.en.Er.cr("uTexelSize",new ri(1/this.width,1/this.height)),this.ku.en.Er.cr("uThreshold",this.parameters.threshold),this.ku.en.Er.cr("uVerticalScale",this.parameters.Ou),this.ku.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:!1,wn:a,Sa:n,time:o}),this.Nu.forEach((({xa:r,ju:s,Gu:u})=>{const l=Math.floor(this.width/u);r.it(l,this.Au),r.en.Er.cr(je,new ri(1/l,1/this.Au)),r.en.Er.cr("uPrevTexture",s.xn.tt),r.en.Er.cr("uHorizontalScale",this.parameters._u),r.Tn({$e:e,Da:t,Sn:i,bn:null,Cn:!1,wn:a,Sa:n,time:o})})),this.Eu.forEach((({xa:r,ju:s,$u:u})=>{r.it(u.width,u.height),r.en.Er.cr("uPrevTexture",s.xn.tt),r.en.Er.cr("uDownSampleTexture",u.xn.tt),r.en.Er.cr("uStretch",this.parameters.stretch),r.Tn({$e:e,Da:t,Sn:i,bn:null,Cn:!1,wn:a,Sa:n,time:o})})),this.Go.en.Er.cr("uStreakTexture",this.Eu[this.Eu.length-1].xa.xn.tt),this.Go.en.Er.cr("uColor",this.parameters.color),this.Go.en.Er.cr("uIntensity",this.parameters.Fu),this.Go.Tn({$e:e,Da:t,Sn:i,bn:r,Cn:s,wn:a,Sa:n,time:o})}}class Qi extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0}}(e.parameters??{});super({$e:t,type:K.V,parameters:i,Ui:"#version 300 es\nprecision mediump float;\n#define MAX_EDGE_STEP_COUNT 9\nin vec2 vUv;out vec4 outColor;uniform sampler2D uSrcTexture;uniform float uTargetWidth,uTargetHeight,uContrastThreshold,uRelativeThreshold,uSubpixelBlending;struct EdgeData{bool isHorizontal;float pixelStep;float oppositeLuma;float gradient;};struct LuminanceData{float center;float top;float right;float bottom;float left;float topLeft;float topRight;float bottomLeft;float bottomRight;float highest;float lowest;float contrast;};float s(vec3 u){return dot(u,vec3(.299,.587,.114));}vec4 s(sampler2D u,vec2 z){return texture(u,z);}vec4 s(sampler2D u,vec2 e,float z,float v){return s(u,e+vec2(z,v));}LuminanceData f(vec2 e,vec2 z){LuminanceData f;vec3 u=s(uSrcTexture,e,0.,z.y).xyz,t=s(uSrcTexture,e,z.x,0.).xyz,v=s(uSrcTexture,e,0.,-z.y).xyz,m=s(uSrcTexture,e,-z.x,0.).xyz,r=s(uSrcTexture,e,0.,0.).xyz,y=s(uSrcTexture,e,z.x,z.y).xyz,L=s(uSrcTexture,e,-z.x,z.y).xyz,p=s(uSrcTexture,e,z.x,-z.y).xyz,a=s(uSrcTexture,e,-z.x,-z.y).xyz;float x=s(u),l=s(m),d=s(r),g=s(t),h=s(v),E=s(L),c=s(y),n=s(a),A=s(p),B=max(d,max(max(x,l),max(h,g))),C=min(d,min(min(x,l),min(h,g)));f.top=x;f.left=l;f.center=d;f.right=g;f.bottom=h;f.topLeft=E;f.topRight=c;f.bottomLeft=n;f.bottomRight=A;f.highest=B;f.lowest=C;f.contrast=B-C;return f;}bool f(LuminanceData z){return z.contrast<max(uContrastThreshold,z.highest*uRelativeThreshold);}float a(LuminanceData z){float u=2.*(z.top+z.right+z.bottom+z.left);u+=z.topLeft+z.topRight+z.bottomLeft+z.bottomRight;u*=1./12.;u=abs(u-z.center);u=clamp(u/z.contrast,0.,1.);float f=smoothstep(0.,1.,u);f*=f;f*=uSubpixelBlending;return f;}EdgeData a(LuminanceData z,vec2 f){EdgeData s;s.isHorizontal=abs(z.top+z.bottom-2.*z.center)*2.+abs(z.topRight+z.bottomRight-2.*z.right)+abs(z.topLeft+z.bottomLeft-2.*z.left)>=abs(z.right+z.left-2.*z.center)*2.+abs(z.topRight+z.topLeft-2.*z.top)+abs(z.bottomRight+z.bottomLeft-2.*z.bottom);float u=s.isHorizontal?z.top:z.right,e=s.isHorizontal?z.bottom:z.left,a=abs(u-z.center),t=abs(e-z.center);s.pixelStep=s.isHorizontal?f.y:f.x;if(a<t)s.pixelStep=-s.pixelStep,s.oppositeLuma=e,s.gradient=t;else s.oppositeLuma=u,s.gradient=a;return s;}float a(LuminanceData z,EdgeData e,vec2 a,vec2 u){float[10] t=float[](1.,1.5,2.,2.,2.,2.,2.,2.,2.,4.);vec2 f=a,i=vec2(0);i=e.isHorizontal?(f.y+=e.pixelStep*.5,vec2(u.x,0)):(f.x+=e.pixelStep*.5,vec2(0,u.y));float x=(z.center+e.oppositeLuma)*.5,v=e.gradient*.25;vec2 m=f+i*vec2(t[0]);float r=s(s(uSrcTexture,m).xyz)-x;bool y=abs(r)>=v;if(!y)m+=i*vec2(t[1]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[2]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[3]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[4]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[5]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[6]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[7]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[8]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(t[9]),r=s(s(uSrcTexture,m).xyz)-x,y=abs(r)>=v;if(!y)m+=i*vec2(8);vec2 l=f-i*vec2(t[0]);float L=s(s(uSrcTexture,l).xyz)-x;bool p=abs(L)>=v;if(!p)l-=i*vec2(t[1]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[2]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[3]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[4]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[5]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[6]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[7]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[8]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(t[9]),L=s(s(uSrcTexture,l).xyz)-x,p=abs(L)>=v;if(!p)l-=i*vec2(8);float d,g;g=e.isHorizontal?(d=m.x-a.x,a.x-l.x):(d=m.y-a.y,a.y-l.y);float h;bool b;b=d<=g?(h=d,r>=0.):(h=g,L>=0.);return b==z.center-x>=0.?0.:.5-h/(d+g);}void main(){vec2 z=vUv,r=vec2(1./uTargetWidth,1./uTargetHeight);LuminanceData u=f(z,r);if(f(u)){outColor=s(uSrcTexture,z);return;}EdgeData e=a(u,r);float t=a(u),y=a(u,e,z,r),v=max(t,y);if(e.isHorizontal)z.y+=e.pixelStep*v;else z.x+=e.pixelStep*v;outColor=s(uSrcTexture,z);}",Er:[{name:"uContrastThreshold",type:ue,value:.0625},{name:"uRelativeThreshold",type:ue,value:.125},{name:"uSubpixelBlending",type:ue,value:.75}]})}it(e,t){super.it(e,t),this.en.Er.cr(_e,e),this.en.Er.cr(ke,t)}}class qi extends ii{constructor(e){const{$e:t}=e,i=function(e={}){return{enabled:e.enabled??!0,bias:e.bias??0,Hu:e.Hu??new It(.025,.025,.025),Wu:e.Wu??2,Xu:e.Xu??1,ratio:e.ratio??.5}}(e.parameters??{});super({$e:t,type:K.F,parameters:i,Ui:"#version 300 es\nprecision highp float;\n#pragma DEFINES\n#define MAX_SPOT_LIGHT_COUNT 4\n#define MAX_POINT_LIGHT_COUNT 4\nin vec2 vUv;out vec4 outColor;\n#define saturate(a)clamp(a,0.,1.)\nfloat u(vec2 u){return fract(sin(dot(u,vec2(12.9898,78.233)))*43758.5453);}float u(float u,float e,float v){float f=e*u;return-f/(v*(u-1.)-f);}vec3 t(vec2 u,float e,mat4 v){vec4 M=v*vec4(u*2.-1.,e*2.-1.,1);return M.xyz/M.w;}vec3 e(vec2 u,float e,mat4 v){vec4 f=v*vec4(u*2.-1.,e*2.-1.,1);return f.xyz/f.w;}layout(std140) uniform ubCommon{float uTime;vec4 uViewport;};layout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};struct PointLight{vec4 color;vec3 position;float intensity;float distance;float attenuation;};layout(std140) uniform ubPointLight{PointLight uPointLight[MAX_POINT_LIGHT_COUNT];};uniform sampler2D uDepthTexture,uGBufferBTexture;uniform float uBias;uniform vec3 uJitterSize;uniform float uSharpness,uStrength;void e(PointLight u,vec3 f,vec3 v,vec3 x,out float M){vec3 n=(uViewMatrix*vec4(u.position,1)).xyz,t=n+x*uJitterSize,s=v-t,m=normalize(s);float r=length(s)/float(24),l=uSharpness/float(24);for(int a=0;a<24;a++){float h=r*float(a);vec3 P=t+m*h;vec4 i=uProjectionMatrix*vec4(P,1);i/=i.w;vec2 d=i.xy*.5+.5;vec3 D=e(d,textureLod(uDepthTexture,d,0.).x,uInverseProjectionMatrix);if(abs(P.z)>abs(D.z))M+=l*saturate(u.intensity);}}void main(){vec2 v=vUv;float f=u(texture(uDepthTexture,v).x,uNearClip,uFarClip);if(f>.9999){outColor=vec4(0,0,0,1);return;}vec3 s=t(v,texture(uDepthTexture,v).x,uInverseViewProjectionMatrix),m=(uViewMatrix*vec4(s,1)).xyz;m=e(v,texture(uDepthTexture,v).x,uInverseProjectionMatrix);vec3 d=normalize(vec3(u(v+uTime+.1),u(v+uTime+.2),u(v+uTime+.3))*2.-1.);float a=0.;e(uPointLight[0],s,m,d,a);a*=uStrength;outColor=vec4(vec3(a),1);}",Er:[{name:Le,type:q,value:null},{name:Ve,type:q,value:null},{name:"uBias",type:ue,value:0},{name:"uJitterSize",type:re,value:It.Ot},{name:"uSharpness",type:ue,value:0},{name:"uStrength",type:ue,value:0}],Ar:[ot,ut,lt,ft]}),this.parameters=i}it(e,t){super.it(e*this.parameters.ratio,t*this.parameters.ratio)}Tn(e){this.en.Er.cr("uBias",this.parameters.bias),this.en.Er.cr("uJitterSize",this.parameters.Hu),this.en.Er.cr("uSharpness",this.parameters.Wu),this.en.Er.cr("uStrength",this.parameters.Xu),super.Tn(e)}}function er(e,t,i){e.Er.cr(qe,t.Ju&&t.Ju.yu?t.Ju.yu.read.Mi:i);const r=yi.range(4).map((e=>{const r=t.Yu[e];return r&&r.yu?r.yu.read.Mi:i}));e.Er.cr(et,r)}class tr{constructor(){this.children=[]}add(e){this.children.push(e)}Ku(e){for(let t=0;t<this.children.length;t++)this.#S(this.children[t],e)}find(e){return this.children.find((t=>t.name===e))}static find(e,t){return e.find((e=>e.name===t))}#S(e,t){if(t(e),e._s)for(let i=0;i<e.children.length;i++)this.#S(e.children[i],t)}}const ir="#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nfloat u(vec2 u){return step(0.,u.x)*(1.-step(1.,u.x))*step(0.,u.y)*(1.-step(1.,u.y));}vec4 u(sampler2D v,vec2 s,vec2 m,vec2 t){return texture(v,s*m+t)*u(s*m+t);}uniform vec2 uTiling;uniform sampler2D uTextureCol0;uniform vec2 uTextureCol0UvOffset;uniform sampler2D uTextureCol1;uniform vec2 uTextureCol1UvOffset;uniform sampler2D uTextureCol2;uniform vec2 uTextureCol2UvOffset;uniform sampler2D uTextureCol3;uniform vec2 uTextureCol3UvOffset;uniform sampler2D uTextureCol4;uniform vec2 uTextureCol4UvOffset;uniform sampler2D uTextureCol5;uniform vec2 uTextureCol5UvOffset;in vec2 vUv;out vec4 outColor;void main(){vec2 v=uTiling;vec4 s=u(uTextureCol0,vUv,v,uTextureCol0UvOffset),m=u(uTextureCol1,vUv,v,uTextureCol1UvOffset),t=u(uTextureCol2,vUv,v,uTextureCol2UvOffset),r=u(uTextureCol3,vUv,v,uTextureCol3UvOffset),C=u(uTextureCol4,vUv,v,uTextureCol4UvOffset),g=u(uTextureCol5,vUv,v,uTextureCol5UvOffset);outColor=s+m+t+r+C+g;}",rr="depthTexture",sr="gBufferATexture",nr="gBufferBTexture",ar="gBufferCTexture",or="gBufferDTexture",ur="directionalLightShadowMap",lr="spotLightShadowMap",hr="screenSpaceShadowTexture",cr="ambientOcclusionTexture",fr="deferredShadingTexture",mr="ssrTexture",pr="lightShaftTexture",vr="volumetricLightTexture",dr="fogTexture",gr="depthOfFieldTexture",xr="bloomBlurMip4Texture",yr="bloomBlurMip8Texture",Tr="bloomBlurMip16Texture",wr="bloomBlurMip32Texture",Sr="bloomBlurMip64Texture",br="bloomTexture",Cr="streakPrefilterTexture",Mr="streakDownSampleMip2Texture",Pr="streakDownSampleMip4Texture",zr="streakDownSampleMip8Texture",Dr="streakDownSampleMip16Texture",Rr="streakDownSampleMip32Texture",Lr="streakUpSample0Texture",Br="streakUpSample1Texture",Ur="streakUpSample2Texture",Ir="streakUpSample3Texture",Vr="streakUpSample4Texture",Nr="streakTexture";class Er{constructor({$e:e,parameters:t}){this.name="BufferVisualizerPass",this.type=K.L,this.Zu=[],this.width=1,this.height=1,this.tn=[],this.parameters=function(e={}){return{enabled:e.enabled||!1,Qu:e.Qu||!1}}(t),this.qs=new Et({$e:e}),this.Zu.push({xa:new zi({$e:e,Ui:"#version 300 es\n\nprecision mediump float;\n\n#define saturate(a) clamp(a, 0., 1.)\n\nfloat isArea(vec2 uv) {\r\n    return step(0., uv.x) * (1. - step(1., uv.x)) * step(0., uv.y) * (1. - step(1., uv.y));\r\n}\n\nvec4 calcAreaColor(vec4 color, vec2 uv, vec2 tiling, vec2 offset) {\r\n    return color * isArea(uv * tiling + offset);\r\n}\n\nvec4 calcTextureAreaColor(sampler2D tex, vec2 uv, vec2 tiling, vec2 offset) {\r\n    return calcAreaColor(texture(tex, uv * tiling + offset), uv, tiling, offset);\r\n}\n\nfloat viewZToLinearDepth(float z, float near, float far) {\r\n    return (z + near) / (near - far);\r\n}\n\nfloat viewZToPerspectiveDepth(float viewZ, float near, float far) {\r\n    return((near + viewZ) * far) / ((far - near) * viewZ);\r\n}\n\nfloat perspectiveDepthToLinearDepth(float rawDepth, float near, float far) {\r\n    float nz = near * rawDepth;\r\n    return -nz / (far * (rawDepth - 1.) - nz);\r\n}\n\nfloat perspectiveDepthToEyeDepth(float rawDepth, float near, float far) {\r\n    float depth = perspectiveDepthToLinearDepth(rawDepth, near, far);\r\n    return mix(near, far, depth);\r\n}\n\nfloat ndcZToRawDepth(float ndcZ) {\r\n    return ndcZ * .5 + .5;\r\n}\n\nfloat ndcZToLinearDepth(float ndcZ, float near, float far) {\r\n    float rawDepth = ndcZToRawDepth(ndcZ);\r\n    return perspectiveDepthToLinearDepth(rawDepth, near, far);\r\n}\n\nfloat clipPositionToLinearDepth(vec4 clipPosition, float near, float far) {\r\n    float z = clipPosition.z / clipPosition.w; \n    return ndcZToLinearDepth(z, near, far);\r\n}\n\nvec3 reconstructWorldPositionFromDepth(vec2 screenUV, float rawDepth, mat4 inverseViewProjectionMatrix) {\r\n    \n    vec4 clipPos = vec4(screenUV * 2. - 1., rawDepth * 2. - 1., 1.);\r\n    vec4 worldPos = inverseViewProjectionMatrix * clipPos;\r\n    return worldPos.xyz / worldPos.w;\r\n}\n\nvec3 reconstructViewPositionFromDepth(vec2 screenUV, float rawDepth, mat4 inverseProjectionMatrix) {\r\n    \n    vec4 clipPos = vec4(screenUV * 2. - 1., rawDepth * 2. - 1., 1.);\r\n    vec4 viewPos = inverseProjectionMatrix * clipPos;\r\n    return viewPos.xyz / viewPos.w;\r\n}\n\nfloat sampleRawDepthByViewPosition(\r\n    sampler2D depthTexture,\r\n    vec3 viewPosition,\r\n    mat4 projectionMatrix,\r\n    vec3 offset\r\n) {\r\n    vec4 offsetPosition = vec4(viewPosition + offset, 1.);\r\n    vec4 projectedPosition = projectionMatrix * offsetPosition;\r\n    vec3 projectedPositionNDC = projectedPosition.xyz / projectedPosition.w;\r\n    vec2 projectedPositionUV = projectedPositionNDC.xy * .5 + .5;\r\n    \n    return textureLod(depthTexture, projectedPositionUV, 0.).x;\r\n}\n\nuniform vec2 uTiling;\r\nuniform sampler2D uTextureCol0;\r\nuniform vec2 uTextureCol0UvOffset;\r\nuniform vec2 uTextureCol1UvOffset;\r\nuniform sampler2D uTextureCol2;\r\nuniform vec2 uTextureCol2UvOffset;\r\nuniform sampler2D uTextureCol3;\r\nuniform vec2 uTextureCol3UvOffset;\r\nuniform sampler2D uTextureCol4;\r\nuniform vec2 uTextureCol4UvOffset;\r\nuniform sampler2D uTextureCol5;\r\nuniform vec2 uTextureCol5UvOffset;\n\nuniform float uNearClip;\r\nuniform float uFarClip;\r\nuniform mat4 uInverseViewProjectionMatrix;\n\nin vec2 vUv;\n\nout vec4 outColor;\n\nvoid main() {\r\n    vec2 tiling = uTiling;\r\n    \n\n    \n    vec2 depthUv = vUv * tiling + uTextureCol0UvOffset;\r\n    vec2 worldPositionUv = vUv * tiling + uTextureCol1UvOffset;\r\n    \r\n    \r\n    \n\n    float rawDepth = texture(uTextureCol0, depthUv).x * isArea(depthUv);\r\n    float sceneDepth = perspectiveDepthToLinearDepth(rawDepth, uNearClip, uFarClip);\r\n    \r\n    vec3 worldPosition = reconstructWorldPositionFromDepth(\r\n        worldPositionUv,\r\n        texture(uTextureCol0, worldPositionUv).x,\r\n        uInverseViewProjectionMatrix\r\n    );\n\n    vec4 depthColor = calcAreaColor(vec4(sceneDepth), vUv, tiling, vec2(0., 0.));\r\n    vec4 worldPositionColor = calcAreaColor(vec4(worldPosition, 1.), vUv, tiling, vec2(-1., 0.));\r\n    vec4 color2 = calcTextureAreaColor(uTextureCol2, vUv, tiling, uTextureCol2UvOffset);\r\n    vec4 color3 = calcTextureAreaColor(uTextureCol3, vUv, tiling, uTextureCol3UvOffset);\r\n    vec4 color4 = calcTextureAreaColor(uTextureCol4, vUv, tiling, uTextureCol4UvOffset);\r\n    vec4 color5 = calcTextureAreaColor(uTextureCol5, vUv, tiling, uTextureCol5UvOffset);\n\n    outColor = depthColor + worldPositionColor + color2 + color3 + color4 + color5;\r\n}",Er:[{name:"uNearClip",type:ue,value:.1},{name:"uFarClip",type:ue,value:1},{name:"uInverseViewProjectionMatrix",type:Z,value:jt.identity}]}),qu:new Map([[rr,{label:"depth",type:"Texture"}],["worldPosition",{type:"Other",el:"uWorldPosition"}],[sr,{type:"Texture"}],[nr,{type:"Texture"}],[ar,{type:"Texture"}],[or,{type:"Texture"}]])}),this.Zu.push({xa:new zi({$e:e,Ui:ir,mn:!1}),qu:new Map([[ur,{type:"Texture"}],[`${lr}0`,{type:"Texture"}],[`${lr}1`,{type:"Texture"}],[`${lr}2`,{type:"Texture"}],[`${lr}3`,{type:"Texture"}]])}),this.Zu.push({xa:new zi({$e:e,Ui:ir,mn:!1}),qu:new Map([[hr,{type:"Texture"}],[cr,{type:"Texture"}],[fr,{type:"Texture"}],[mr,{type:"Texture",label:"combine ssr"}]])}),this.Zu.push({xa:new zi({$e:e,Ui:ir,mn:!1}),qu:new Map([[pr,{type:"Texture"}],[vr,{type:"Texture"}],[dr,{type:"Texture",label:"combine fog"}],[gr,{type:"Texture",label:"dof"}]])}),this.Zu.push({xa:new zi({$e:e,Ui:ir,mn:!1}),qu:new Map([[xr,{type:"Texture",label:"bloom blur mip4"}],[yr,{type:"Texture",label:"bloom blur mip8"}],[Tr,{type:"Texture",label:"bloom blur mip16"}],[wr,{type:"Texture",label:"bloom blur mip32"}],[Sr,{type:"Texture",label:"bloom blur mip64"}],[br,{type:"Texture",label:"bloom"}]])}),this.Zu.push({xa:new zi({$e:e,Ui:ir,mn:!1}),qu:new Map([[Cr,{type:"Texture"}],[Mr,{type:"Texture"}],[Pr,{type:"Texture"}],[zr,{type:"Texture"}],[Dr,{type:"Texture"}],[Rr,{type:"Texture"}]])}),this.Zu.push({xa:new zi({$e:e,Ui:ir,mn:!1}),qu:new Map([[Lr,{type:"Texture"}],[Br,{type:"Texture"}],[Ur,{type:"Texture"}],[Ir,{type:"Texture"}],[Vr,{type:"Texture"}],[Nr,{type:"Texture"}]])}),this.Go=new zi({$e:e,name:"BufferVisualizerPass",Ui:"#version 300 es\nprecision mediump float;\n#define saturate(a)clamp(a,0.,1.)\nfloat p(vec2 v){return step(0.,v.x)*(1.-step(1.,v.x))*step(0.,v.y)*(1.-step(1.,v.y));}vec4 p(sampler2D e,vec2 v,vec2 s,vec2 u){return texture(e,v*s+u)*p(v*s+u);}uniform vec2 uTiling;uniform sampler2D uRow0Texture,uRow1Texture,uRow2Texture,uRow3Texture,uRow4Texture,uRow5Texture,uRow6Texture,uFullViewTexture;uniform float uFullViewTextureEnabled;in vec2 vUv;out vec4 outColor;void main(){vec2 v=vec2(1,7);vec4 u=p(uRow0Texture,vUv,v,vec2(0,-6)),s=p(uRow1Texture,vUv,v,vec2(0,-5)),r=p(uRow2Texture,vUv,v,vec2(0,-4)),t=p(uRow3Texture,vUv,v,vec2(0,-3)),C=p(uRow4Texture,vUv,v,vec2(0,-2)),D=p(uRow5Texture,vUv,v,vec2(0,-1)),e=p(uRow6Texture,vUv,v,vec2(0));outColor=mix(u+s+r+t+C+D+e,texture(uFullViewTexture,vUv),step(.5,uFullViewTextureEnabled));}",mn:!1,Er:[{name:"uFullViewTexture",type:q,value:e.Ra},{name:"uFullViewTextureEnabled",type:ue,value:0},...yi.range(7).map(((t,i)=>[{name:`uRow${i}Texture`,type:q,value:e.Ra}])).flat(),...ii.vn]}),this.Zu.forEach((({xa:e})=>this.tn.push(e.en))),this.tn.push(this.Go.en),this.Zu.forEach((({xa:t,qu:i},r)=>{let s=0;t.en.Er.hr("uTiling",te,new ri(7,1));for(const[n,a]of i){const o=a.tl||"uTextureCol",u=`${o}${s}`,l=`${u}UvOffset`,h=-s;a.tl||(i.get(n).tl=o),"Texture"===a.type&&(i.get(n).il=u),i.get(n).rl=l,0===r?(t.en.Er.hr(l,te,new ri(h,0)),"Texture"===a.type&&t.en.Er.hr(u,q,e.Ra)):(t.en.Er.hr(l,te,new ri(h,0)),t.en.Er.hr(u,q,e.Ra)),s++}})),this.Go.en.Er.hr("uTiling",te,new ri(1,7));const i=document.createElement("style");i.textContent="\n.buffer-visualizer-pass {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    display: grid;\n    grid-template-rows: repeat(7, 1fr);\n}\n.buffer-visualizer-pass.hidden {\n    display: none;\n}\n.buffer-visualizer-pass-tile {\n    display: flex;\n    justify-content: flex-start;\n    align-items: flex-end;\n    font-size: 9px;\n    line-height: 1em;\n    font-weight: bold;\n    text-shadow: 1px 1px #333;\n    padding: 4px;\n}\n\n.buffer-visualizer-pass-row {\n    // display: flex;\n    display: grid;\n    grid-template-columns: repeat(7, 1fr);\n}\n        ",document.head.appendChild(i),this.sl=document.createElement("div"),this.sl.classList.add("buffer-visualizer-pass");const r=document.createDocumentFragment();this.Zu.forEach((({qu:e},t)=>{let i=0;const s=document.createElement("div");s.classList.add("buffer-visualizer-pass-row");for(const[r,n]of e){const e=`[${i}, ${t}] ${n.label||r}`,a=document.createElement("div");a.classList.add("buffer-visualizer-pass-tile");const o=document.createElement("p");o.textContent=e,a.appendChild(o),s.appendChild(a),i++}r.appendChild(s)})),this.sl.appendChild(r),document.body.appendChild(this.sl),this.nl()}get xn(){return this.Go.xn}it(e,t){this.width=e,this.height=t,this.Zu.forEach((({xa:e})=>{e.it(this.width,this.height/7)})),this.Go.it(this.width,this.height)}yn(e,t,i){}update(){}al(){this.sl.classList.remove("hidden")}nl(){this.sl.classList.add("hidden")}Tn(e){const{$e:t,Sn:i,ya:r}=e,s=i.ol,n=i.ul;this.qs.start(),this.Zu.forEach((({xa:e,qu:t})=>{r?.Ju&&t.has(ur)&&e.en.Er.cr(t.get(ur).il,r.Ju.yu.read.Mi),r?.Yu&&r.Yu.forEach(((i,r)=>{const s=`${lr}${r}`;t.has(s)&&i.yu&&e.en.Er.cr(t.get(s).il,i.yu.read.Mi)})),t.has(rr)&&e.en.Er.cr(t.get(rr).il,i.Pa.Mi),t.has(sr)&&e.en.Er.cr(t.get(sr).il,i.Sa.wa),t.has(nr)&&e.en.Er.cr(t.get(nr).il,i.Sa.ba),t.has(ar)&&e.en.Er.cr(t.get(ar).il,i.Sa.Ca),t.has(or)&&e.en.Er.cr(t.get(or).il,i.Sa.Ma),t.has(hr)&&e.en.Er.cr(t.get(hr).il,i.ll.xn.read.tt),t.has(cr)&&e.en.Er.cr(t.get(cr).il,i.hl.xn.read.tt),t.has(fr)&&e.en.Er.cr(t.get(fr).il,i.cl.xn.read.tt),t.has(mr)&&e.en.Er.cr(t.get(mr).il,i.fl.xn.read.tt),t.has(pr)&&e.en.Er.cr(t.get(pr).il,i.ml.xn.read.tt),t.has(vr)&&e.en.Er.cr(t.get(vr).il,i.pl.xn.read.tt),t.has(gr)&&e.en.Er.cr(t.get(gr).il,i.vl.xn.read.tt),t.has(dr)&&e.en.Er.cr(t.get(dr).il,i.dl.xn.read.tt),t.has(Cr)&&e.en.Er.cr(t.get(Cr).il,i.gl.ku.xn.read.tt),t.has(Mr)&&e.en.Er.cr(t.get(Mr).il,i.gl.Nu[0].xa.xn.read.tt),t.has(Pr)&&e.en.Er.cr(t.get(Pr).il,i.gl.Nu[1].xa.xn.read.tt),t.has(zr)&&e.en.Er.cr(t.get(zr).il,i.gl.Nu[2].xa.xn.read.tt),t.has(Dr)&&e.en.Er.cr(t.get(Dr).il,i.gl.Nu[3].xa.xn.read.tt),t.has(Rr)&&e.en.Er.cr(t.get(Rr).il,i.gl.Nu[4].xa.xn.read.tt),t.has(Lr)&&e.en.Er.cr(t.get(Lr).il,i.gl.Eu[0].xa.xn.read.tt),t.has(Br)&&e.en.Er.cr(t.get(Br).il,i.gl.Eu[1].xa.xn.read.tt),t.has(Ur)&&e.en.Er.cr(t.get(Ur).il,i.gl.Eu[2].xa.xn.read.tt),t.has(Ir)&&e.en.Er.cr(t.get(Ir).il,i.gl.Eu[3].xa.xn.read.tt),t.has(Vr)&&e.en.Er.cr(t.get(Vr).il,i.gl.Eu[4].xa.xn.read.tt),t.has(Nr)&&e.en.Er.cr(t.get(Nr).il,i.gl.xn.read.tt),t.has(xr)&&e.en.Er.cr(t.get(xr).il,i.xl.jo.read.tt),t.has(yr)&&e.en.Er.cr(t.get(yr).il,i.xl.$o.read.tt),t.has(Tr)&&e.en.Er.cr(t.get(Tr).il,i.xl.Ho.read.tt),t.has(wr)&&e.en.Er.cr(t.get(wr).il,i.xl.Wo.read.tt),t.has(Sr)&&e.en.Er.cr(t.get(Sr).il,i.xl.Xo.read.tt),t.has(br)&&e.en.Er.cr(t.get(br).il,i.xl.xn.read.tt)})),this.Zu[0].xa.en.Er.cr("uInverseViewProjectionMatrix",e.wn.Hn),t.it(0,0,this.width,this.height/7),this.Zu.forEach((({xa:t,qu:i},r)=>{i.size>0&&(t.Tn({...e,Cn:!1}),this.Go.en.Er.cr(`uRow${r}Texture`,t.xn.read.tt))})),this.Go.en.Er.cr("uFullViewTexture",i.Sa.ba),this.Go.en.Er.cr("uFullViewTextureEnabled",this.parameters.Qu?1:0),t.it(0,0,s,n),this.Go.Tn({...e})}}class Ar{#b=ri.Ot;#C=ri.Ot;#M=ri.Ot;#P=ri.Ot;#z=ri.Ot;#D=!1;#R=!1;#L=!1;#B=0;#U=0;get yl(){return!this.#R}get Tl(){return this.#D}get wl(){return this.#R}get Sl(){return this.#L}get bl(){return this.#P}get Cl(){return this.#z}constructor(){}start(){}it(e,t){this.#B=e,this.#U=t}update(){}Ml({Pl:e,wl:t}){this.#I(t),this.#V(e)}#I(e){const t=this.wl;return this.#R=e,!t&&this.wl?(this.#D=!0,void(this.#L=!1)):!t&&this.wl?(this.#D=!1,void(this.#L=!1)):t&&!this.wl?(this.#D=!1,void(this.#L=!0)):(this.#D=!1,void(this.#L=!1))}#V(e){this.yl||this.Tl&&(this.#C.Mt(e),this.#b.Mt(this.#C),this.#M.set(0,0),this.#P.set(0,0)),this.#b.Mt(this.#C),this.#C.Mt(e);const t=ri.Ht(this.#C,this.#b);this.#M.Mt(t);const i=Math.min(this.#B,this.#U);this.#P.set(this.#M.x/i,this.#M.y/i),this.#z.set(this.#C.x/this.#B,this.#C.y/this.#U)}zl(){this.#b.set(-1/0,-1/0),this.#C.set(-1/0,-1/0),this.#M.set(-1/0,-1/0),this.#P.set(-1/0,-1/0)}dispose(){}}const Fr={name:"SampleScene",Dl:[{name:"TestMain",transform:{Rl:{x:0,y:0,z:0},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:1,y:1,z:1}},Ul:[{name:"MainTimeline",duration:.699999999999,Il:[{Vl:[{name:"TEST Signal Emitter",time:.13333334}],type:4},{Nl:[{El:{x:0,y:0,z:0},Al:{x:0,y:0,z:0},Fl:[{propertyName:"localEulerAnglesRaw.x",Ol:[{time:0,value:0,_l:0,kl:0},{time:.7,value:81.06097,_l:0,kl:0}]},{propertyName:"localEulerAnglesRaw.y",Ol:[{time:0,value:0,_l:0,kl:0},{time:.216666669,value:127.556816,_l:-756.29126,kl:-756.29126},{time:.7,value:151.009659,_l:0,kl:0}]},{propertyName:"localEulerAnglesRaw.z",Ol:[{time:0,value:0,_l:0,kl:0},{time:.35,value:-4.82784653,_l:273.68158,kl:273.68158},{time:.7,value:118.314247,_l:0,kl:0}]},{propertyName:"m_LocalPosition.x",Ol:[{time:.0166666675,value:0,_l:0,kl:0},{time:.7,value:0,_l:0,kl:0}]},{propertyName:"m_LocalPosition.y",Ol:[{time:.0166666675,value:0,_l:0,kl:0},{time:.7,value:1.99,_l:0,kl:0}]},{propertyName:"m_LocalPosition.z",Ol:[{time:.0166666675,value:0,_l:0,kl:0},{time:.7,value:0,_l:0,kl:0}]}],type:1,start:0,duration:.7}],Gl:"GameObject",type:1},{Nl:[{El:{x:0,y:0,z:0},Al:{x:0,y:0,z:0},Fl:[{propertyName:"bloomIntensity",Ol:[{time:0,value:1.41393065,_l:0,kl:0},{time:.416666657,value:0,_l:0,kl:0},{time:.7,value:2.98,_l:0,kl:0}]}],type:1,start:0,duration:.7}],Gl:"Global Volume",type:1},{Nl:[{Fl:[{propertyName:"range",Ol:[{time:0,value:10,_l:0,kl:0},{time:.333333343,value:0,_l:0,kl:0},{time:.7,value:10,_l:0,kl:0}]}],type:2,start:0,duration:.7}],Gl:"SpotLight",type:2}],type:1}],children:[]},{name:"DirectionalLight",transform:{Rl:{x:0,y:3,z:0},Ll:{x:.408217877,y:-.234569684,z:-.109381631,w:-.8754261},Bl:{x:1,y:1,z:1}},Ul:[{jl:"Directional",Fu:.07,color:"FFFFFFFF",type:2}],children:[]},{name:"MainCamera",transform:{Rl:{x:0,y:1,z:6.97},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:1,y:1,z:1}},Ul:[{kn:"Perspective",$l:!0,Hl:60,type:3}],children:[]},{name:"Global Volume",transform:{Rl:{x:0,y:0,z:0},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:1,y:1,z:1}},Ul:[{Wl:[{Fu:2.54,Xl:"Bloom"},{Ko:4.71942759,Xl:"DepthOfField"}],type:6}],children:[]},{name:"Plane",transform:{Rl:{x:0,y:0,z:0},Ll:{x:.67946887,y:-.08294426,z:.202946216,w:-.7001822},Bl:{x:6,y:2.56296,z:6}},Ul:[{Jl:"Plane",en:{color:"FFFFFFFF",Yl:0,Kl:0,name:"Plane",type:1},type:4},{Zl:"Quad",type:5}],children:[]},{name:"SpotLight",transform:{Rl:{x:0,y:3.84,z:0},Ll:{x:.5838468,y:.24579294,z:.0872257352,w:-.768830538},Bl:{x:1,y:1,z:1}},Ul:[{range:10,Ql:20,ql:45,jl:"Spot",Fu:2,color:"FFFFFFFF",type:2}],children:[]},{name:"GameObject",transform:{Rl:{x:0,y:0,z:0},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:1,y:1,z:1}},Ul:[],children:[{name:"Cube (1)",transform:{Rl:{x:.65,y:0,z:0},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:.4,y:.4,z:.4}},Ul:[{Jl:"Lit",en:{color:"808080FF",Yl:0,Kl:.5,name:"Lit",type:1},type:4},{Zl:"Cube",type:5}],children:[]},{name:"Cube",transform:{Rl:{x:0,y:0,z:0},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:1,y:.2,z:.2}},Ul:[{Jl:"Lit",en:{color:"808080FF",Yl:0,Kl:.5,name:"Lit",type:1},type:4},{Zl:"Cube",type:5}],children:[]},{name:"Cube",transform:{Rl:{x:.69,y:0,z:-.358},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:.08402,y:.099351,z:.396934569}},Ul:[{Jl:"Lit",en:{color:"808080FF",Yl:0,Kl:.5,name:"Lit",type:1},type:4},{Zl:"Cube",type:5}],children:[]},{name:"Cube (2)",transform:{Rl:{x:.69,y:.559,z:-.018},Ll:{x:0,y:0,z:0,w:-1},Bl:{x:.08402,y:.8225347,z:.05105364}},Ul:[{Jl:"Lit",en:{color:"808080FF",Yl:0,Kl:.5,name:"Lit",type:1},type:4},{Zl:"Cube",type:5}],children:[]}]}]};class Or{get Ce(){return this.rootElement}constructor(e=!0){this.rootElement=document.createElement("div"),e&&(this.rootElement.style.cssText="\n                background-color: rgb(200 200 255 / 70%);\n                position: absolute;\n                top: 0px;\n                right: 0px;\n                box-sizing: border-box;\n                padding: 0px 10px 10px 10px;\n                display: grid;\n                justify-items: start;\n                \n                font-size: 9px;\n                font-weight: bold;\n                line-height: 1.2em;\n                min-width: 200px;\n        "),this.eh=document.createElement("div"),this.eh.style.cssText="\n            width: 100%;\n        ",this.rootElement.appendChild(this.eh)}#N(e){const t=document.createElement("div");t.style.cssText="\n            box-sizing: border-box;\n            padding-top: 8px;\n        ";const i=document.createElement("div");if(t.appendChild(i),e){const t=document.createElement("span");t.style.cssText="\n                padding-right: 1em;\n            ",t.textContent=e,i.appendChild(t)}const r=document.createElement("div");return t.appendChild(r),{be:t,th:i,eh:r}}ih(e,t=!0){const i=new Or(!1),r=document.createElement("p");r.textContent=e,r.style.cssText="\n            font-size: 11px;\n            font-style: italic;\n            box-sizing: border-box;\n            padding: 4px 0 0 0;\n            cursor: pointer;\n        ",i.rootElement.insertBefore(r,i.eh);const s=()=>{i.eh.classList.remove("is-hidden"),i.eh.style.cssText="",r.textContent=` ${e}`},n=()=>{i.eh.classList.add("is-hidden"),i.eh.style.cssText="display: none;",r.textContent=` ${e}`};return r.addEventListener("click",(()=>{i.eh.classList.contains("is-hidden")?s():n()})),t?s():n(),this.eh.appendChild(i.Ce),i}rh({label:e,sh:t,nh:i=null,ah:r=!0,options:s=[]}){const{be:n,eh:a}=this.#N(e),o=document.createElement("select");o.style.cssText="\n                    font-size: 9px;\n                ",s.forEach((e=>{const t=document.createElement("option");t.value=e.value,t.label=e.label||e.value,o.appendChild(t),e.oh&&(o.value=e.value)})),o.addEventListener("change",(()=>{t(o.value)})),null!==i&&(o.value=i),r&&t(o.value),a.appendChild(o),this.eh.appendChild(n)}uh({label:e,sh:t,lh:i=null,nh:r=null,ah:s=!0}){const{be:n,eh:a}=this.#N(e),o=document.createElement("input");o.type="color",o.addEventListener("change",(()=>{t(o.value)})),o.addEventListener("input",(()=>{i?i(o.value):t(o.value)})),null!==r&&(o.value=r),s&&t(o.value),a.appendChild(o),this.eh.appendChild(n)}hh({label:e,sh:t,nh:i=null,ah:r=!0}){const{be:s,eh:n}=this.#N(e),a=document.createElement("input");a.type="checkbox",a.checked=!!i,a.addEventListener("change",(()=>{t(a.checked)})),r&&t(a.checked),n.appendChild(a),this.eh.appendChild(s)}fh({label:e,sh:t,lh:i,nh:r,ah:s=!0,minValue:n,maxValue:a,mh:o}){const{be:u,th:l,eh:h}=this.#N(e),c=document.createElement("span"),f=document.createElement("input"),m=()=>{c.textContent=`value: ${f.value}`},p=()=>(m(),Number.parseFloat(f.value));f.type="range",f.min=n.toString(),f.max=a.toString(),null!==o&&(f.step=o.toString()),f.addEventListener("change",(()=>p())),f.addEventListener("input",(()=>{i?i(p()):t(p())})),null!==r&&(f.value=r.toString()),s?t(p()):m(),l.appendChild(c),h.appendChild(f),this.eh.appendChild(u)}ph({dh:e,gh:t}){const{be:i,eh:r}=this.#N(""),s=document.createElement("input");s.type="button",s.value=e,s.style.cssText="\n        font-size: 9px;\n        font-weight: bold;\n        line-height: 1.2em;\n        padding: 1px 2px;\n",s.addEventListener("click",(()=>t())),r.appendChild(s),this.eh.appendChild(i)}xh(){const e=document.createElement("hr");e.style.cssText="\n            width: 100%;\n            height: 1px;\n            border: none;\n            border-top: 1px solid #777;\n            margin: 0.5em 0 0.25em 0;\n        ",this.eh.appendChild(e)}}class _r extends Ct{constructor({$e:e,yh:t}){super(),this.$e=e;const{We:i}=e;this.Th=i.createTransformFeedback(),this.bind();for(let r=0;r<t.length;r++)i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,r,t[r]);i.bindBuffer(i.ARRAY_BUFFER,null),this.je()}get Ge(){return this.Th}bind(){const{We:e}=this.$e;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,this.Ge)}je(){const{We:e}=this.$e;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}}class kr{constructor({$e:e,attributes:t,qt:i,Bi:r,wh:s,Er:n=[],Ar:a=[]}){this.attributes=[],this.Ar=[],this.outputs=[];const{We:o}=e,u=s.map((({name:e})=>e));this._r=new Gt({$e:e,Bi:r,Ui:"#version 300 es\nvoid main(){}",transformFeedbackVaryings:u}),this.Er=new Xt(n),this.Ar=a,this.qt=i,t.forEach(((e,t)=>{e.location=t,e.divisor=0})),this.attributes=t,this.ti=new Ut({$e:e,attributes:t});const l=s.map((({data:e,_e:t})=>{const i=o.createBuffer();return o.bindBuffer(o.ARRAY_BUFFER,i),o.bufferData(o.ARRAY_BUFFER,e,Bt(o,t||j)),o.bindBuffer(o.ARRAY_BUFFER,null),this.outputs.push({buffer:i}),i}));this.Th=new _r({$e:e,yh:l})}}const Gr=65536;class jr{constructor(e,t,i){this.$e=e,this.Sh=2,this.duration=i,this.node=null,this.bh=null,this.volume=1;const r=new AudioContext,s=r.createBuffer(this.Sh,r.sampleRate*i,r.sampleRate),{We:n}=e,a=new Float32Array(this.Sh*Gr),o=new kr({$e:e,attributes:[],wh:[{name:"vSound",data:a,_e:$}],Bi:t,Er:[{name:"uBlockOffset",type:ue,value:0},{name:"uSampleRate",type:ue,value:0}],qt:Gr}),u=Math.ceil(r.sampleRate*i/Gr),l=s.getChannelData(0),h=s.getChannelData(1);o.Er.cr("uSampleRate",r.sampleRate);for(let c=0;c<u;c++){const t=c*Gr/r.sampleRate;o.Er.cr("uBlockOffset",t),e.Ch({_r:o._r,Er:o.Er,Th:o.Th,ti:o.ti,qt:Gr}),e.We.getBufferSubData(n.TRANSFORM_FEEDBACK_BUFFER,0,a);for(let e=0;e<Gr;e++)l[c*Gr+e]=a[2*e+0],h[c*Gr+e]=a[2*e+1]}this.Mh=r,this.Ph=s}play(e){this.bh&&(this.bh.disconnect(),this.bh=null),this.node&&(this.node.stop(),this.node=null);const t=this.Mh.createBufferSource(),i=this.Mh.createGain();i.connect(this.Mh.destination),i.gain.value=this.volume,t.connect(i),t.buffer=this.Ph,t.loop=!1,t.start(0,e),this.node=t,this.bh=i}zh(e){this.volume=e,this.bh&&(this.bh.gain.value=this.volume)}stop(){this.node?.stop()}}class $r extends fi{constructor(e,t,i,r,s){super({name:s,kn:T}),this.ca=1,this.Dh=!1,this.Hl=e,this.ca=t,this.near=i,this.Jn=r,this.Rh(t)}Rh(e){this.ca=e,this.oa()}it(e,t){super.it(e,t),this.Dh||this.Rh(e/t)}oa(){this.projectionMatrix=jt.Wi(this.Hl*Math.PI/180,this.ca,this.near,this.Jn)}sa(){const e=It.back,t=It.right,i=It.kt,r=this.Hl/2*Math.PI/180,s=this.near*r,n=s*this.ca,a=this.Jn*r,o=a*this.ca,u=e.clone().scale(this.near),l=e.clone().scale(this.Jn),h=t.clone().scale(n),c=i.clone().scale(s),f=t.clone().scale(o),m=i.clone().scale(a);return{In:It.$t(u,h.clone().Dt(),c),Vn:It.$t(u,h,c),Nn:It.$t(u,h.clone().Dt(),c.clone().Dt()),En:It.$t(u,h,c.clone().Dt()),An:It.$t(l,f.clone().Dt(),m),Fn:It.$t(l,f,m),On:It.$t(l,f.clone().Dt(),m.clone().Dt()),_n:It.$t(l,f,m.clone().Dt())}}}class Hr extends Vt{constructor({$e:e}){const t=[-.5,.5,.5],i=[-.5,-.5,.5],r=[.5,.5,.5],s=[.5,-.5,.5],n=[.5,.5,-.5],a=[.5,-.5,-.5],o=[-.5,.5,-.5],u=[-.5,-.5,-.5];super({$e:e,attributes:[new bt({name:H,data:new Float32Array([...t,...i,...r,...s,...r,...s,...n,...a,...n,...a,...o,...u,...o,...u,...t,...i,...o,...t,...n,...r,...i,...u,...s,...a]),size:3}),new bt({name:W,data:new Float32Array(new Array(6).fill(0).map((()=>[0,1,0,0,1,1,1,0])).flat()),size:2}),new bt({name:X,data:new Float32Array([[0,0,1],[1,0,0],[0,0,-1],[-1,0,0],[0,1,0],[0,-1,0]].map((e=>new Array(4).fill(0).map((()=>e)))).flat(2)),size:3})],He:Array.from(Array(6).keys()).map((e=>[4*e+0,4*e+1,4*e+2,4*e+2,4*e+1,4*e+3])).flat(),qt:36})}}class Wr extends Yt{constructor({Lh:e,Bh:t,Uh:i,Ih:r,Vh:s,Nh:n,Eh:o,Yl:l,Kl:h,Ah:c,Cr:f={},Fh:m=a,Er:p=[],...v}={}){super({...v,name:"GBufferMaterial",Cr:f,Er:[...[{name:"uDiffuseColor",type:ce,value:e||wi.Za},{name:"uDiffuseMap",type:q,value:t||null},{name:"uDiffuseMapUvScale",type:te,value:i||ri._t},{name:"uDiffuseMapUvOffset",type:te,value:r||ri._t},{name:Ne,type:ue,value:l||0},{name:Ee,type:ue,value:h||0},{name:"uNormalMap",type:q,value:s||null},{name:"uNormalMapUvScale",type:te,value:n||ri._t},{name:"uNormalMapUvOffset",type:te,value:o||ri._t},{name:"uEmissiveColor",type:ce,value:c||wi.Qa},{name:Ie,type:he,value:m}],...p||[]],Fr:[{name:"uDiffuseMap",type:q,value:t||null},{name:"uDiffuseMapUvScale",type:te,value:ri._t},{name:"uDiffuseMapUvOffset",type:te,value:ri._t}],ir:!!s,Pr:!0,zr:!1,Rr:u,Ar:[ot,ut,lt]})}start({$e:e,Xr:t=[]}){this.Bi="#version 300 es\nprecision highp float;\n#pragma DEFINES\n#pragma ATTRIBUTES\n#pragma APPEND_ATTRIBUTES\nlayout(std140) uniform ubCommon{float uTime;vec4 uViewport;};layout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};\n#if defined(USE_SKINNING_GPU)||defined(USE_SKINNING_CPU)\nmat4 u(mat4 u,mat4 m,mat4 U,mat4 e,vec4 v){return u*aBoneWeights.x+m*aBoneWeights.y+U*aBoneWeights.z+e*aBoneWeights.w;}mat4 u(sampler2D u,uint U,int m){int v=int(mod(float(U),float(m))),a=int(floor(float(U)/float(m)));return mat4(texelFetch(u,ivec2(v*4,a),0),texelFetch(u,ivec2(v*4+1,a),0),texelFetch(u,ivec2(v*4+2,a),0),texelFetch(u,ivec2(v*4+3,a),0));}mat4 u(sampler2D u,uint U,int m,int t,int v,float e,float d){float n=float(int(mod(floor(e+d),float(v)))*m);int f=int(mod(float(U)+n,float(t))),a=int(floor(float(U)+n/float(t)));return mat4(texelFetch(u,ivec2(f*4,a),0),texelFetch(u,ivec2(f*4+1,a),0),texelFetch(u,ivec2(f*4+2,a),0),texelFetch(u,ivec2(f*4+3,a),0));}\n#endif\nout vec2 vUv;out vec3 vLocalPosition,vWorldPosition,vNormal;\n#ifdef USE_NORMAL_MAP\nout vec3 vTangent,vBinormal;\n#endif\n#ifdef USE_RECEIVE_SHADOW\nout vec4 vShadowMapProjectionUv;\n#endif\n#ifdef USE_VERTEX_COLOR\nout vec4 vVertexColor;\n#endif\n#pragma APPEND_UNIFORMS\n#ifdef USE_RECEIVE_SHADOW\nuniform mat4 uShadowMapProjectionMatrix;\n#endif\n#if defined(USE_SKINNING_GPU)||defined(USE_SKINNING_CPU)\nuniform sampler2D uJointTexture;uniform int uBoneCount,uJointTextureColNum,uTotalFrameCount;\n#endif\nmat4 u(float u){float a=cos(u),t=sin(u);return mat4(1.,0.,0.,0.,0.,a,t,0.,0.,-t,a,0.,0.,0.,0.,1.);}mat4 d(float u){float a=cos(u),t=sin(u);return mat4(a,0.,-t,0.,0.,1.,0.,0.,t,0.,a,0.,0.,0.,0.,1.);}mat4 m(float u){float a=cos(u),t=sin(u);return mat4(a,t,0.,0.,-t,a,0.,0.,0.,0.,1.,0.,0.,0.,0.,1.);}mat4 t(vec3 u){return mat4(1.,0.,0.,0.,0.,1.,0.,0.,0.,0.,1.,0.,u.x,u.y,u.z,1.);}mat4 U(vec3 u){return mat4(u.x,0.,0.,0.,0.,u.y,0.,0.,0.,0.,u.z,0.,0.,0.,0.,1.);}mat4 U(vec3 u,vec3 U){vec3 a=normalize(u-U),t=normalize(cross(vec3(0,1,0),a)),i=cross(a,t);return mat4(t.x,t.y,t.z,0.,i.x,i.y,i.z,0.,a.x,a.y,a.z,0.,0.,0.,0.,1.);}void main(){\n#pragma BEGIN_MAIN\nvec4 v=vec4(aPosition,1);\n#if defined(USE_SKINNING_GPU)||defined(USE_SKINNING_CPU)\nmat4 a=mat4(1.,0.,0.,0.,0.,1.,0.,0.,0.,0.,1.,0.,0.,0.,0.,1.);\n#ifdef USE_SKINNING_GPU\nmat4 f=u(uJointTexture,aBoneIndices[0],uBoneCount,uJointTextureColNum,uTotalFrameCount,uTime*30.,aInstanceAnimationOffset),i=u(uJointTexture,aBoneIndices[1],uBoneCount,uJointTextureColNum,uTotalFrameCount,uTime*30.,aInstanceAnimationOffset),e=u(uJointTexture,aBoneIndices[2],uBoneCount,uJointTextureColNum,uTotalFrameCount,uTime*30.,aInstanceAnimationOffset),n=u(uJointTexture,aBoneIndices[3],uBoneCount,uJointTextureColNum,uTotalFrameCount,uTime*30.,aInstanceAnimationOffset);a=u(f,i,e,n,aBoneWeights);\n#endif\n\n#ifdef USE_SKINNING_CPU\nmat4 s=u(uJointTexture,aBoneIndices[0],uJointTextureColNum),x=u(uJointTexture,aBoneIndices[1],uJointTextureColNum),l=u(uJointTexture,aBoneIndices[2],uJointTextureColNum),r=u(uJointTexture,aBoneIndices[3],uJointTextureColNum);a=u(s,x,l,r,aBoneWeights);\n#endif\nv=a*v;\n#endif\n\n#pragma LOCAL_POSITION_POST_PROCESS\nvUv=aUv;vLocalPosition=aPosition;mat4 c=uWorldMatrix;\n#ifdef USE_INSTANCING\nmat4 A=t(aInstancePosition),p=U(aInstanceScale.xyz),y=u(aInstanceRotation.x),B=d(aInstanceRotation.y),w=m(aInstanceRotation.z),C=B*y*w;\n#ifdef USE_INSTANCE_LOOK_DIRECTION\nC=U(aInstancePosition+aInstanceVelocity*1e3,aInstancePosition);\n#endif\n\n#pragma INSTANCE_TRANSFORM_PRE_PROCESS\nc=uWorldMatrix*A*C*p;\n#endif\nvec4 D=c*v;\n#pragma WORLD_POSITION_POST_PROCESS\nvWorldPosition=D.xyz;mat3 E;\n#ifdef USE_NORMAL_MAP\n\n#if defined(USE_SKINNING_GPU)||defined(USE_SKINNING_CPU)\n\n#ifdef USE_INSTANCING\nE=mat3(transpose(inverse(c)))*mat3(a);\n#else\nE=mat3(uNormalMatrix)*mat3(a);\n#endif\n\n#else\n\n#ifdef USE_INSTANCING\nE=mat3(transpose(inverse(c)));\n#else\nE=mat3(uNormalMatrix);\n#endif\n\n#endif\nvNormal=E*aNormal;vTangent=E*aTangent;vBinormal=E*aBinormal;\n#else\n\n#if defined(USE_SKINNING_GPU)||defined(USE_SKINNING_CPU)\n\n#ifdef USE_INSTANCING\nE=mat3(transpose(inverse(c)))*mat3(a);\n#else\nE=mat3(uNormalMatrix);\n#endif\n\n#else\n\n#ifdef USE_INSTANCING\nE=mat3(transpose(inverse(c)));\n#else\nE=mat3(uNormalMatrix);\n#endif\n\n#endif\nvNormal=E*aNormal;\n#endif\n\n#ifdef USE_RECEIVE_SHADOW\nvShadowMapProjectionUv=uShadowMapProjectionMatrix*D;\n#endif\ngl_Position=uProjectionMatrix*uViewMatrix*D;\n#if defined(USE_INSTANCING)&&defined(USE_VERTEX_COLOR)\nvVertexColor=aInstanceVertexColor;\n#endif\n\n#pragma END_MAIN\n}",this.Ui="#version 300 es\nprecision highp float;\n#pragma DEFINES\n#define MAX_SPOT_LIGHT_COUNT 4\n#define MAX_POINT_LIGHT_COUNT 4\nlayout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};uniform vec4 uDiffuseColor;uniform sampler2D uDiffuseMap;uniform vec2 uDiffuseMapUvScale;uniform float uSpecularAmount;uniform samplerCube uEnvMap;uniform float uAmbientAmount,uMetallic,uRoughness;uniform vec4 uEmissiveColor;uniform int uShadingModelId;\n#pragma APPEND_UNIFORMS\n#ifdef USE_NORMAL_MAP\nuniform sampler2D uNormalMap;uniform float uNormalStrength;\n#endif\n#ifdef USE_ALPHA_TEST\nuniform float uAlphaTestThreshold;\n#endif\nstruct DirectionalLight{vec3 direction;float intensity;vec4 color;};uniform DirectionalLight uDirectionalLight;struct Surface{vec3 worldNormal;vec3 worldPosition;vec4 diffuseColor;};struct Camera{vec3 worldPosition;};in vec2 vUv;in vec3 vNormal;\n#ifdef USE_NORMAL_MAP\nin vec3 vTangent,vBinormal;\n#endif\nin vec3 vWorldPosition;\n#ifdef USE_VERTEX_COLOR\nin vec4 vVertexColor;\n#endif\n#define SHADING_MODEL_NUM 3.\nstruct GBufferA{vec3 baseColor;};struct GBufferB{vec3 normal;float shadingModelId;};struct GBufferC{float metallic;float roughness;};struct GBufferD{vec3 emissiveColor;};vec4 u(vec3 u,int v){float n=float(v)/SHADING_MODEL_NUM;return vec4(u*.5+.5,n);}\n#ifdef USE_NORMAL_MAP\nvec3 u(vec3 u,vec3 v,vec3 o,sampler2D U,vec2 n){vec3 f=texture(U,n).xyz;f=f*2.-1.;return normalize(mat3(normalize(v),normalize(o),normalize(u))*f);}\n#endif\nvoid v(float u,float v){if(u<v)discard;}layout(location=0) out vec4 outGBufferA;layout(location=1) out vec4 outGBufferB;layout(location=2) out vec4 outGBufferC;layout(location=3) out vec4 outGBufferD;void main(){vec4 f=vec4(0,0,0,1);vec2 n=vUv*uDiffuseMapUvScale;vec4 r=uDiffuseColor*texture(uDiffuseMap,n);vec3 U=vNormal;\n#ifdef USE_NORMAL_MAP\nU=u(vNormal,vTangent,vBinormal,uNormalMap,n);\n#else\nU=normalize(vNormal);\n#endif\n\n#ifdef USE_VERTEX_COLOR\nr*=vVertexColor;\n#endif\nSurface o;o.worldPosition=vWorldPosition;o.worldNormal=U;o.diffuseColor=r;f=o.diffuseColor;\n#ifdef USE_ALPHA_TEST\nv(f.w,uAlphaTestThreshold);\n#endif\nf.xyz=pow(f.xyz,vec3(2.2));outGBufferA=vec4(f.xyz,1);outGBufferB=u(U,uShadingModelId);outGBufferC=vec4(uMetallic,uRoughness,0,1);outGBufferD=vec4(uEmissiveColor.xyz,1);}",this.gr="#version 300 es\nprecision mediump float;\n#pragma DEFINES\nuniform vec4 uColor;uniform sampler2D uDiffuseMap;uniform vec2 uDiffuseMapUvScale;\n#ifdef USE_ALPHA_TEST\nuniform float uAlphaTestThreshold;\n#endif\nin vec2 vUv;\n#ifdef USE_VERTEX_COLOR\nin vec4 vVertexColor;\n#endif\nout vec4 outColor;\n#ifdef USE_ALPHA_TEST\nvoid v(float v,float U){if(v<U)discard;}\n#endif\nvoid main(){vec4 U=texture(uDiffuseMap,vUv*uDiffuseMapUvScale),u=vec4(0);\n#ifdef USE_VERTEX_COLOR\nu=vVertexColor*uColor*U;\n#else\nu=uColor*U;\n#endif\nfloat f=u.w;\n#ifdef USE_ALPHA_TEST\nv(f,uAlphaTestThreshold);\n#endif\noutColor=vec4(1);}",super.start({$e:e,Xr:t})}}class Xr extends ei{constructor({name:e,Fu:t,color:i,jl:r}){super({name:e,type:y.T}),this.Fu=1,this.color=wi.Za,this.nn=!1,this.xu=null,this.yu=null,this.Oh=jt.identity,this._h=jt.identity,this.Fu=t,this.color=i,this.jl=r}it(e,t){super.it(e,t)}kh(){}Gh(){if(!this.xu)return;const e=new jt(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.Oh=jt.Gi(this.xu.projectionMatrix.clone(),this.xu.jn.clone()),this._h=jt.Gi(e,this.Oh.clone())}}class Jr extends Xr{constructor(e){super({...e,jl:x.l}),this.xu=new mi(-1,1,-1,1,.1,1),this.xu.transform.cs(180),this.Hs(this.xu)}update(e){super.update(e),this.Gh()}}function Yr(e){return Math.cos(e*i)}class Kr extends Xr{constructor(e){super({...e,jl:x.h}),this.xu=new $r(45,1,.1,20),this.xu.Dh=!0,this.xu.transform.cs(180),this.Hs(this.xu),this.jh=e.jh,this.$h=e.$h??1.06,this.Hh=e.Hh,this.Wh=e.Wh}get Xh(){return Yr(this.Hh)}get Jh(){return Yr(this.Wh)}update(e){super.update(e),this.xu&&(this.xu.Hl=2*(Math.acos(this.Xh)*(180/Math.PI)),this.xu.Jn=this.jh,this.xu.oa(),this.Gh())}}const Zr="seekTimeline",Qr="exportScene",qr="exportHotReloadScene";var es=(e=>(e[e.Yh=0]="None",e[e.Kh=1]="AnimationTrack",e[e.Zh=2]="LightControlTrack",e[e.Qh=3]="ActivationControlTrack",e[e.qh=4]="MarkerTrack",e))(es||{}),ts=(e=>(e[e.Yh=0]="None",e[e.ec=1]="AnimationClip",e[e.tc=2]="LightControlClip",e[e.ic=3]="ActivationControlClip",e))(ts||{});const is=1,rs=2,ss=3,ns=4,as=5,os=6;var us=(e=>(e[e.Yh=0]="None",e[e.ec=1]="AnimationClip",e[e.tc=2]="LightControlClip",e[e.ic=3]="ActivationControlClip",e[e.rc=4]="SignalEmitter",e))(us||{});function ls(e,t,i){return function(e,t,i){const r=i.time-t.time,s=t.kl*r,n=i._l*r,a=e*e,o=a*e,u=o-2*a+e,l=o-a,h=-2*o+3*a;return(2*o-3*a+1)*t.value+u*s+l*n+h*i.value}((e-t.time)/(i.time-t.time),t,i)}function hs(e,t){if(0===t.length)return 0;if(1===t.length)return t[0].value;if(e<t[0].time)return t[0].value;if(e>=t[t.length-1].time)return t[t.length-1].value;for(let i=0;i<t.length-1;i++){const r=t[i],s=t[i+1];if(r.time<=e&&e<s.time)return ls(e,r,s)}return 0}const cs="color.r",fs="color.g",ms="color.b",ps="color.a",vs="intensity",ds="range",gs="m_LocalPosition.x",xs="m_LocalPosition.y",ys="m_LocalPosition.z",Ts="localEulerAnglesRaw.x",ws="localEulerAnglesRaw.y",Ss="localEulerAnglesRaw.z",bs="m_LocalScale.x",Cs="m_LocalScale.y",Ms="m_LocalScale.z",Ps="field of view",zs="material._BaseColor.r",Ds="material._BaseColor.g",Rs="material._BaseColor.b",Ls="material._BaseColor.a",Bs="bloomIntensity";function Us(e){const t=[];for(let r=0;r<e.length;r++){const s=e[r];switch(s.type){case ts.ec:t.push(Is(s));break;case ts.tc:t.push(Vs(s));break;case ts.ic:t.push((i=s,{type:us.ic,sc:i,nc:()=>{}}))}}var i;return t}function Is(e){return{type:us.ec,sc:e,nc:(t,r)=>{let s=!1,n=!1,a=!1;const o=It.Ot,u=It.Ot,l=It._t,{start:h,Fl:c}=e;if(c.forEach((({propertyName:e,Ol:i})=>{const c=hs(r-h,i);switch(e){case gs:s=!0,o.x=c;break;case xs:s=!0,o.y=c;break;case ys:s=!0,o.z=c;break;case Ts:n=!0,u.x=c;break;case ws:n=!0,u.y=c;break;case Ss:n=!0,u.z=c;break;case bs:a=!0,l.x=c;break;case Cs:a=!0,l.y=c;break;case Ms:a=!0,l.z=c;break;case Ps:t.Hl=c,t.oa();break;case zs:case Ds:case Rs:case Ls:break;case Bs:const e=t.ac(K.D);e&&(e.Do=c)}})),a&&t.transform.scale.Mt(l),n){const e=jt.Gi(jt._i(-u.y*i),jt.Oi(-u.x*i),jt.ki(u.z*i)),r=Kt.Zr(e);t.transform.rotation=new Zt(r)}s&&t.transform.position.Mt(o)}}}function Vs(e){return{type:us.tc,sc:e,nc:(t,i)=>{const r=t;let s=!1,n=!1,a=!1,o=!1,u=!1,l=!1;const h=new wi;let c=0,f=0;const{start:m,Fl:p}=e;p.forEach((({propertyName:e,Ol:t})=>{const r=hs(i-m,t);switch(e){case cs:s=!0,h.r=r;break;case fs:n=!0,h.Ga=r;break;case ms:a=!0,h.b=r;break;case ps:o=!0,h.a=r;break;case vs:u=!0,c=r;break;case ds:l=!0,f=r}})),s&&(r.color.r=h.r),n&&(r.color.Ga=h.Ga),a&&(r.color.b=h.b),o&&(r.color.a=h.a),u&&(r.Fu=c),l&&(r.jh=f)}}}class Ns extends ei{constructor(e){super(e)}}class Es extends Ns{constructor(e){super({...e,type:y.P}),this.parameters=[],this.parameters=e.parameters||[]}ac(e){const t=this.parameters.find((t=>t?.type===e));return t?t.parameters:null}}function As(e,t){return e.Ul.find((e=>e.type===t))||null}function Fs(e,t){const i=[];function r(t,s=null,n=!1){const{name:a}=t,o=As(t,as),u=As(t,ns),l=As(t,ss),h=As(t,rs),c=As(t,os);let f=null;if(u&&o){const t=u;let i=null,r=null;switch(o.Zl){case"Cube":i=new Hr({$e:e});break;case"Quad":i=new Et({$e:e})}t.Jl,r=new Wr,i&&r&&(f=new ti({name:a,qs:i,en:r}))}else if(l){const e=l;"Perspective"===e.kn&&(f=new $r(e.Hl,1,.1,1e3,a))}else if(h){const e=h;switch(e.jl){case"Directional":const t=e;f=new Jr({name:a,Fu:t.Fu,color:wi.eo(t.color)});break;case"Spot":const i=e;f=new Kr({name:a,color:wi.eo(i.color),Fu:i.Fu,jh:i.range,Hh:i.ql,Wh:i.Ql})}}else f=c?function({name:e,oc:t}){const i=yi(t.Wl.map((e=>{switch(e.Xl){case"Bloom":const t=e;return{type:K.D,parameters:Li({Do:t.Fu})};case"DepthOfField":const i=e;return{type:K.R,parameters:Ui({Ko:i.Ko})};default:return null}}))).compact().value();return new Es({name:e,parameters:i})}({name:a,oc:c}):new ei({name:a});if(f){f.transform.scale=new It(t.transform.Bl.x,t.transform.Bl.y,t.transform.Bl.z),f.transform.rotation=Zt.Ki(function(e,t,i){if(!i)return e;if(t.type==y.T&&t.jl===x.h){const t=e.x,i=e.y,r=e.z,s=e.w,n=1,a=0,o=0,u=0;return new Kt(s*n+t*u+i*o-r*a,s*a-t*o+i*u+r*n,s*o+t*a-i*n+r*u,s*u-t*n-i*a-r*o)}return e}(new Kt(t.transform.Ll.x,t.transform.Ll.y,t.transform.Ll.z,t.transform.Ll.w),f,n)),f.transform.position=new It(t.transform.Rl.x,t.transform.Rl.y,t.transform.Rl.z),s?s.Hs(f):i.push(f);for(let e=0;e<t.children.length;e++)r(t.children[e],f,n)}else;}for(let n=0;n<t.Dl.length;n++){r(t.Dl[n],null,!0)}let s=null;return t.Dl.forEach((e=>{const t=e.Ul.find((e=>e.type===is));t&&(s=function(e,t){const i=[],r=e=>{let t=!1;return{...e,uc:t,nc:i=>{i>e.time&&t&&(t=!0)}}};for(let s=0;s<t.Il.length;s++){const n=t.Il[s];if(n.type===es.qh){const{Vl:e}=n;i.push({Vl:e.map((e=>r(e))),nc:()=>{}})}else{const{Gl:t,Nl:r}=n,s=tr.find(e,t),a=Us(r),o=e=>{if(n.type===es.Qh){if(null!=s){const t=a.find((t=>t.sc.start<e&&e<t.sc.start+t.sc.duration));s.enabled=!!t}}else if(null!=s)for(let t=0;t<a.length;t++)a[t].nc(s,e)};i.push({Gl:t,Nl:a,nc:o})}}return{Il:i,nc:e=>{const r=e%t.duration;for(let t=0;t<i.length;t++)i[t].nc(r)}}}(i,t))})),{lc:i,hc:s}}class Os{constructor(e){this.cc=.01,this.fc=-45,this.mc=45,this.vc=-45,this.dc=45,this.gc=100,this.xc=100,this.#E={azimuth:0,altitude:0},this.#A=It.Ot,this.jh=10,this.$h=.001,this.#F=0,this.#O=0,this.yc=1,this.Tc=1,this.wc=0,this.Sc=0,this.enabled=!0,this.#_=It.Ot,this.#k=It.Ot,this.#G=e}#G;#E;#A;#F;#O;#_;#k;set vs(e){this.#A=e}start(e=null,t=null){this.#E.azimuth=null!==e?e:this.wc,this.#E.altitude=null!==t?t:this.Sc,this.#j(!0)}bc(e){this.enabled&&(this.#F=e.x*this.yc,this.#O=e.y*this.Tc)}Xs(){this.enabled&&(this.#F=Math.sign(this.#F)*Math.max(0,Math.abs(this.#F)-this.$h),this.#O=Math.sign(this.#O)*Math.max(0,Math.abs(this.#O)-this.$h),this.#E.azimuth+=this.#F*this.gc,this.#E.altitude+=this.#O*this.xc,this.#j())}#j(e=!1){this.#E.azimuth=Si(this.#E.azimuth,this.fc,this.mc),this.#E.altitude=Si(this.#E.altitude,this.vc,this.dc);const t=It.Xt(new It(0,0,1),this.#E.altitude),i=It.Jt(t,this.#E.azimuth);this.#_=It.$t(this.#A,i.scale(this.jh)),this.#k=It.Qt(this.#k,this.#_,e?1:this.cc),this.#G.transform.position=this.#k,this.#G.transform.zs(this.#A)}}const _s=document.createElement("style");let ks,Gs,js,$s;_s.innerText="\n:root {\n  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;\n  line-height: 1.5;\n  font-weight: 400;\n  color-scheme: light dark;\n  font-synthesis: none;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  -webkit-text-size-adjust: 100%;\n}\n\nbody {\n  overflow: hidden;\n}\n\n* {\n  margin: 0;\n  padding: 0;\n  font-family: sans-serif;\n} \n\n#wrapper {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\ncanvas {\n  display: block;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n}\n",document.head.appendChild(_s);let Hs=null;const Ws=function({port:e=8080,Or:t=!1}={}){let i=0,r=null;const s=`ws://localhost:${e}`;let n=null;return{connect:()=>{n=new WebSocket(s),n.addEventListener("open",(()=>{n?.send(JSON.stringify({type:"auth",Cc:"browser"}))})),n.addEventListener("close",(()=>{})),n.addEventListener("message",(e=>{if(!e.data)return;const t=function(e){let t=null;try{t=JSON.parse(e)}catch(i){}return t}(e.data);if(t&&t.type)switch(t.type){case Zr:i=t.currentTime;break;case Qr:break;case qr:r?.()}})),window.addEventListener("beforeunload",(()=>{n?.readyState===WebSocket.CONNECTING&&n.close()}))},getCurrentTime:()=>i,Mc:e=>{r=e}}}({Or:!1}),Xs=!!window.navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i),Js=Xs?new class extends Ar{#$=!1;#H=ri.Ot;constructor(){super()}start(){window.addEventListener("touchstart",this.#W.bind(this)),window.addEventListener("touchmove",this.#X.bind(this)),window.addEventListener("touchend",this.#J.bind(this))}update(){this.Ml({Pl:this.#H,wl:this.#$})}#W(e){this.#$=!0;const t=e.touches[0];this.Pc(t.clientX,t.clientY)}#X(e){const t=e.touches[0];this.Pc(t.clientX,t.clientY)}#J(e){this.#$=!1;const t=e.touches[0];this.Pc(t.clientX,t.clientY)}Pc(e,t){this.#H.set(e,t)}dispose(){window.removeEventListener("touchstart",this.#W.bind(this)),window.removeEventListener("touchmove",this.#X.bind(this)),window.removeEventListener("touchend",this.#J.bind(this))}}:new class extends Ar{#$=!1;#H=ri.Ot;constructor(){super()}start(){window.addEventListener("mousedown",this.#Y.bind(this)),window.addEventListener("mousemove",this.#K.bind(this)),window.addEventListener("mouseup",this.#Z.bind(this))}update(){this.Ml({Pl:this.#H,wl:this.#$})}#Y(e){this.#$=!0,this.Pc(e.clientX,e.clientY)}#K(e){this.Pc(e.clientX,e.clientY)}#Z(e){this.#$=!1,this.Pc(e.clientX,e.clientY)}Pc(e,t){this.#H.set(e,t)}dispose(){window.removeEventListener("mousedown",this.#Y.bind(this)),window.removeEventListener("mousemove",this.#K.bind(this)),window.removeEventListener("mouseup",this.#Z.bind(this))}};Js.start();const Ys=document.createElement("div");document.body.appendChild(Ys),Ys.setAttribute("id","wrapper");const Ks=document.createElement("canvas");Ys.appendChild(Ks);const Zs=Ks.getContext("webgl2",{antialias:!1});if(!Zs)throw"invalid gl";const Qs=new class{constructor({We:e}){var t,i,r,s,n,a,o;this._r=null,this.dt=null,this.Er=null,this.zc=[],this.Dc=[],this.Rc=0,this.We=e,this.Lc=new Pt({$e:this,Je:Lt("white"),Qe:B,qe:B}),this.Ra=new Pt({$e:this,Je:Lt("black"),Qe:B,qe:B}),this.Bc=(t=this,i=Lt(),r=Lt(),s=Lt(),n=Lt(),a=Lt(),o=Lt(),new zt(t,i.width,i.height,i,r,s,n,a,o))}Uc(e){this._r=e}Ic(e){this.dt=e}Vc(e){this.Er=e}it(e,t,i,r){this.We.viewport(e,t,i,r)}Nc(e){const t=this.We;e?(t.bindFramebuffer(t.FRAMEBUFFER,e.Ge),e.vi&&t.drawBuffers(e.pi)):t.bindFramebuffer(t.FRAMEBUFFER,null)}flush(){this.We.flush()}clearDepth(e,t,i,r){const s=this.We;s.depthMask(!0),s.colorMask(!1,!1,!1,!1),s.clearColor(e,t,i,r),s.clear(s.DEPTH_BUFFER_BIT)}clearColor(e,t,i,r){const s=this.We;s.depthMask(!1),s.colorMask(!0,!0,!0,!0),s.clearColor(e,t,i,r),s.clear(s.COLOR_BUFFER_BIT)}clear(e,t,i,r){this.clearDepth(e,t,i,r),this.clearColor(e,t,i,r)}Ci(e){if(this.zc.includes(e))return!0;if(this.Dc.includes(e))return!1;return null!=this.We.getExtension(e)?(this.zc.push(e),!0):(this.Dc.push(e),!1)}#Q(e){const t=this.We;switch(e){case r:return t.POINTS;case s:return t.LINES;case n:return t.TRIANGLES;default:return-1}}Ec(){const e=this.We;let t=0;if(!this._r)return;const i=(i,r,s)=>{const n=e.getUniformLocation(this._r.Ge,r);switch(i){case he:e.uniform1i(n,s);break;case ue:e.uniform1f(n,s);break;case le:e.uniform1fv(n,s);break;case te:e.uniform2fv(n,s.elements);break;case ie:e.uniform2fv(n,s.map((e=>[...e.elements])).flat());break;case re:e.uniform3fv(n,s.elements);break;case se:e.uniform4fv(n,s.elements);break;case ne:e.uniform4fv(n,s.map((e=>[...e.elements])).flat());break;case Z:e.uniformMatrix4fv(n,!1,s.elements);break;case Q:s&&e.uniformMatrix4fv(n,!1,s.map((e=>[...e.elements])).flat());break;case ce:e.uniform4fv(n,s.elements);break;case fe:s&&e.uniform4fv(n,s.map((e=>[...e.elements])).flat());break;case q:e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,s?s.Ge:this.Lc.Ge),e.uniform1i(n,t),t++;break;case me:const i=[];s.forEach((r=>{i.push(t),e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,r?r.Ge:this.Lc.Ge),t++})),i.length,e.uniform1iv(n,i);break;case ee:e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_CUBE_MAP,s?s.Ge:this.Bc.Ge),e.uniform1i(n,t),t++}};this.Er&&this.Er.data.forEach((e=>{if(e.type===ae){e.value.forEach((t=>{const r=`${e.name}.${t.name}`;i(t.type,r,t.value)}))}else e.type===oe?e.value.forEach(((t,r)=>{t.forEach((t=>{const s=`${e.name}[${r}].${t.name}`;i(t.type,s,t.value)}))})):i(e.type,e.name,e.value)}))}Ch({_r:e,Er:t,Th:i,ti:r,qt:s}){this.Er=t,this._r=e,this.dt=r;const n=this.We;n.bindVertexArray(this.dt.Ge),n.useProgram(this._r.Ge),this.Ec(),n.enable(n.RASTERIZER_DISCARD),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,i.Ge),n.beginTransformFeedback(n.POINTS),n.drawArrays(n.POINTS,0,s),n.endTransformFeedback(),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),n.disable(n.RASTERIZER_DISCARD),n.useProgram(null),n.bindVertexArray(null),this._r=null,this.Er=null,this.dt=null}Ac(e,t,i,r,s,n,a,f,m=0){const p=this.#Q(t),v=this.We;if(this._r&&this.dt){switch(a){case S:v.enable(v.CULL_FACE),v.cullFace(v.BACK),v.frontFace(v.CCW);break;case b:v.enable(v.CULL_FACE),v.cullFace(v.FRONT),v.frontFace(v.CCW);break;case C:v.disable(v.CULL_FACE),v.frontFace(v.CCW)}if(v.depthMask(r),i)switch(v.enable(v.DEPTH_TEST),s){case u:v.depthFunc(v.EQUAL);break;case o:v.depthFunc(v.LEQUAL)}else v.disable(v.DEPTH_TEST);switch(n){case l:v.disable(v.BLEND);break;case h:v.enable(v.BLEND),v.blendFunc(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA);break;case c:v.enable(v.BLEND),v.blendFunc(v.SRC_ALPHA,v.ONE)}v.useProgram(this._r.Ge),this.Ec(),v.bindVertexArray(this.dt.Ge),this.dt.hasIndices?f?v.drawElementsInstanced(p,e,v.UNSIGNED_SHORT,m,f):v.drawElements(p,e,v.UNSIGNED_SHORT,m):f?v.drawArraysInstanced(p,m,e,f):v.drawArrays(p,m,e),v.bindTexture(v.TEXTURE_2D,null),v.bindTexture(v.TEXTURE_CUBE_MAP,null)}}Fc(e,t,i){const r=[];i.forEach((e=>{switch(e.type){case ae:e.value.forEach((t=>{r.push(`${e.name}.${t.name}`)}));break;case oe:e.value.forEach(((t,i)=>{t.forEach((t=>{r.push(`${e.name}[${i}].${t.name}`)}))}));break;default:r.push(e.name)}}));const s=this.We,n=s.getUniformBlockIndex(e.Ge,t),a=s.getActiveUniformBlockParameter(e.Ge,n,s.UNIFORM_BLOCK_DATA_SIZE),o=s.getUniformIndices(e.Ge,r),u=s.getActiveUniforms(e.Ge,o,s.UNIFORM_OFFSET),l=new Rt(this,t,a,r,o,u,a,this.Rc);return this.Rc++,l}Oc(e,t,i){const r=this.We.getUniformBlockIndex(t.Ge,i);return this.We.uniformBlockBinding(t.Ge,r,e.ut),r}}({We:Zs}),qs=new tr,en=Math.min(window.devicePixelRatio,1.5),tn=new class{constructor({$e:e,canvas:t,_c:i=1.5}){this.kc=[],this.xn=null,this.Gc=!1,this.ol=1,this.ul=1,this.jc=null,this.$c=mi.ma(),this.$e=e,this.canvas=t,this._c=i,this.Hc=new pi(this.$c),this.Wc=new _t({$e:e,type:A,width:1,height:1,name:"depth pre-pass render target",et:N}),this.Xc=new vi({$e:e,width:1,height:1,name:"g-buffer render target"}),this.Jc=new _t({$e:e,type:F,width:1,height:1,name:"after g-buffer render target"}),this.Yc=new _t({$e:e,type:F,width:1,height:1,name:"copy depth source render target",et:N}),this.Kc=new _t({$e:e,type:A,width:1,height:1,name:"copy depth dest render target",et:N}),this.Zc=new qi({$e:e}),this.Qc=new Ci({$e:e}),this.qc=new Ti({$e:e}),this.ef=new Mi({$e:e}),this.tf=new Ni({$e:e}),this.if=new Ei({$e:e}),this.rf=new $i({$e:e}),this.sf=new Ii({$e:e}),this.Hc.da(this.sf),this.nf=new Bi({$e:e}),this.Hc.da(this.nf),this.af=new Zi({$e:e}),this.Hc.da(this.af),this.uf=new Pi({$e:e}),this.Hc.da(this.uf),this.lf=new Wi({$e:e}),this.Hc.da(this.lf),this.hf=new Ki({$e:e}),this.Hc.da(this.hf),this.cf=new Qi({$e:e}),this.Hc.da(this.cf);const r=new Gt({$e:e,Bi:"#version 300 es\n#define MAX_SPOT_LIGHT_COUNT 4\n#define MAX_POINT_LIGHT_COUNT 4\nlayout(std140) uniform ubCommon{float uTime;vec4 uViewport;};layout(std140) uniform ubTransformations{mat4 uWorldMatrix;mat4 uViewMatrix;mat4 uProjectionMatrix;mat4 uNormalMatrix;mat4 uInverseWorldMatrix;mat4 uViewProjectionMatrix;mat4 uInverseViewMatrix;mat4 uInverseProjectionMatrix;mat4 uInverseViewProjectionMatrix;mat4 uTransposeInverseViewMatrix;};layout(std140) uniform ubCamera{vec3 uViewPosition;vec3 uViewDirection;float uNearClip;float uFarClip;float uAspect;float uFov;};struct DirectionalLight{vec3 direction;float intensity;vec4 color;mat4 shadowMapProjectionMatrix;};layout(std140) uniform ubDirectionalLight{DirectionalLight uDirectionalLight;};struct SpotLight{vec4 color;vec3 position;vec3 direction;float intensity;float distance;float attenuation;float coneCos;float penumbraCos;mat4 shadowMapProjectionMatrix;};layout(std140) uniform ubSpotLight{SpotLight uSpotLight[MAX_SPOT_LIGHT_COUNT];};struct PointLight{vec4 color;vec3 position;float intensity;float distance;float attenuation;};layout(std140) uniform ubPointLight{PointLight uPointLight[MAX_POINT_LIGHT_COUNT];};void main(){}",Ui:"#version 300 es\nvoid main(){}"}),s=[{name:ve,type:Z,value:jt.identity},{name:de,type:Z,value:jt.identity},{name:ge,type:Z,value:jt.identity},{name:ye,type:Z,value:jt.identity},{name:Te,type:Z,value:jt.identity},{name:xe,type:Z,value:jt.identity},{name:we,type:Z,value:jt.identity},{name:be,type:Z,value:jt.identity},{name:Se,type:Z,value:jt.identity},{name:Ce,type:Z,value:jt.identity}];this.kc.push({dr:this.$e.Fc(r,ut,s),data:s});const n=[{name:Me,type:re,value:It.Ot},{name:Pe,type:re,value:It.Ot},{name:$e,type:ue,value:0},{name:He,type:ue,value:0},{name:ze,type:ue,value:0},{name:De,type:ue,value:0}];this.kc.push({dr:this.$e.Fc(r,lt,n),data:n});const a=[{name:We,type:ae,value:[{name:Ye,type:re,value:It.Ot},{name:Ke,type:ue,value:0},{name:Ze,type:ce,value:wi.Qa},{name:Qe,type:Z,value:jt.identity}]}];this.kc.push({dr:this.$e.Fc(r,ht,a),data:a});const o=[{name:Xe,type:oe,value:yi.range(4).map((()=>[{name:Ze,type:ce,value:wi.Qa},{name:tt,type:re,value:It.Ot},{name:Ye,type:re,value:It.Ot},{name:Ke,type:ue,value:0},{name:it,type:ue,value:0},{name:rt,type:ue,value:0},{name:st,type:ue,value:0},{name:nt,type:ue,value:0},{name:Qe,type:Z,value:jt.identity}]))}];this.kc.push({dr:this.$e.Fc(r,ct,o),data:o});const u=[{name:Je,type:oe,value:yi.range(4).map((()=>[{name:Ze,type:ce,value:wi.Qa},{name:tt,type:re,value:It.Ot},{name:Ke,type:ue,value:0},{name:it,type:ue,value:0},{name:rt,type:ue,value:0}]))}];this.kc.push({dr:this.$e.Fc(r,ft,u),data:u});const l=[{name:Fe,type:ue,value:0},{name:Oe,type:se,value:li.Ot}];this.kc.push({dr:this.$e.Fc(r,ot,l),data:l})}Mn(e){e.Hr||(e.Hr=!0,e.Ar.forEach((t=>{const i=this.kc.find((({dr:e})=>e.nt===t));if(!i)return;const r=this.$e.Oc(i.dr,e._r,t);e.Er.pr(r,i.dr,[])})))}get Pa(){return this.Wc}get Sa(){return this.Xc}get ll(){return this.Zc}get hl(){return this.Qc}get fl(){return this.ef}get cl(){return this.qc}get ml(){return this.tf}get pl(){return this.if}get dl(){return this.rf}get vl(){return this.sf}get xl(){return this.nf}get gl(){return this.af}get ff(){return this.lf}get mf(){return this.hf}get pf(){return this.cf}vf(e){this.jc=e}it(e,t){this.ol=e,this.ul=t,this.canvas.width=this.ol,this.canvas.height=this.ul,this.$e.it(0,0,this.ol,this.ul),this.Wc.it(e,t),this.Xc.it(e,t),this.Jc.it(e,t),this.Yc.it(e,t),this.Kc.it(e,t),this.Zc.it(e,t),this.Qc.it(e,t),this.qc.it(e,t),this.ef.it(e,t),this.tf.it(e,t),this.if.it(e,t),this.rf.it(e,t),this.sf.it(e,t),this.nf.it(e,t),this.af.it(e,t),this.uf.it(e,t),this.lf.it(e,t),this.hf.it(e,t),this.cf.it(e,t)}yn(e,t=!1,i=!1){e?(this.xn=e,this.$e.Nc(e.framebuffer),this.$e.it(0,0,e.width,e.height)):(this.xn=null,this.$e.Nc(null),this.$e.it(0,0,this.ol,this.ul)),t?(this.$e.clearColor(0,0,0,0),this.Gc=!0):this.Gc=!1,i&&this.$e.clearDepth(1,1,1,1)}flush(){this.$e.flush()}clearColor(e,t,i,r){this.$e.clearColor(e,t,i,r)}clearDepth(e,t,i,r){this.$e.clearDepth(e,t,i,r)}Tn(e,t,{time:i,df:r}){const s={[f]:[],[m]:[],[p]:[],[v]:[]},n={Ju:null,Yu:[],gf:[]};let a=null;e.Ku((e=>{switch(e.type){case y.S:return void s[f].push(this.xf(e,f));case y.v:case y.g:e.tn.forEach(((t,i)=>{if(t.Lr)s[p].push(this.xf(e,p,i));else switch(t.Ur){case l:return void s[m].push(this.xf(e,m,i));case h:case c:return void s[v].push(this.xf(e,v,i))}}));break;case y.T:if(e.enabled){const t=e;switch(t.jl){case x.l:n.Ju=t;break;case x.h:n.Yu.push(t);break;case x.m:n.gf.push(t)}}break;case y.P:a=e}}));const o=(e,t)=>e.ds.tn[e.yf].Ir-t.ds.tn[t.yf].Ir,u=Object.keys(s).map((e=>s[e].sort(o))).flat().filter((({ds:e})=>e.enabled));a&&function(e,t){const i=t.ac(K.D);i&&e.xl.Yo(i)}(this,a);const d=u.filter((e=>e.Nr===f)),g=u.filter((e=>e.Nr===f||e.Nr===m||e.Nr===p)),T=u.filter((e=>e.Nr===v));this.Tf({time:i}),n.Ju&&this.wf(n.Ju),n.Yu.length>0&&this.Sf(n.Yu),n.gf.length>0&&this.bf(n.gf);const w=g.filter((({ds:e})=>e.type!==y.S&&e));this.Cf(w,t),this.Mf(g,t);const S=[];if(n.Ju&&S.push(n.Ju),n.Yu.forEach((e=>{e.nn&&S.push(e)})),S.length>0){const e=g.filter((({ds:e})=>e.type!==y.S&&e.nn));this.Pf(S,e)}pi.za({xa:this.Zc,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:null,Cn:!1,time:i}),pi.za({xa:this.Qc,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:null,Cn:!1,time:i}),d.forEach((e=>{const t=e.ds;this.qc.Aa(t)})),er(this.qc.en,n,this.$e.Ra),this.qc.en.Er.cr("uScreenSpaceShadowTexture",this.Zc.xn.read.tt),this.qc.en.Er.cr("uAmbientOcclusionTexture",this.Qc.xn.read.tt),pi.za({xa:this.qc,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:null,Cn:!1,time:i,ya:n}),pi.za({xa:this.ef,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:this.qc.xn,Cn:!1,time:i}),n.Ju&&(this.tf.lu(n.Ju),pi.za({xa:this.tf,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:this.qc.xn,Cn:!1,time:i})),this.if.Tu(n.Yu),n.Yu.length>0&&pi.za({xa:this.if,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:this.qc.xn,Cn:!1,time:i}),this.rf.Lu(this.tf.xn),this.rf.Bu(this.if.xn),pi.za({xa:this.rf,Sn:this,wn:t,$e:this.$e,Da:this.Hc.pa,bn:this.ef.xn,Cn:!1,time:i}),this.Jc.Pi(this.rf.xn.read.tt),this.Jc.zi(this.Wc.Mi),this.zf(),T.forEach((e=>{e.ds.en.Er.cr(Ve,this.Kc.Mi)})),this.yn(this.Jc.write),this.Df(T,t,n),r&&r(),this.Hc.ea;let b=this.Jc;const C=!t.xn&&!t.qn;this.Hc.update(),this.Hc.Tn({$e:this.$e,Sn:this,bn:b,Sa:this.Xc,wn:t,time:i,Ba:C}),C||(b=this.Hc.va,t.qn&&(t.Gn?.update(),t.Gn?.Tn({$e:this.$e,Sn:this,bn:b,Sa:this.Xc,wn:t,time:i,Ba:!t.xn,ya:n})))}Pn(e,t){if(e.update(),this.jc&&(this.jc.Ae(e),this.jc.Fe()),this.$e.Ic(e.ti),!t._r)return;let i;if(this.$e.Uc(t._r),this.$e.Vc(t.Er),null!==t.zr)i=t.zr;else switch(t.Ur){case l:i=!0;break;case h:case c:i=!1;break;default:return}const r=!!t.Pr,s=t.Rr;this.$e.Ac(e.qt,t.primitiveType,r,i,s,t.Ur,t.Br,e.ei)}xf(e,t,i=0){return{ds:e,Nr:t,yf:i}}Rf(e,t,i){const r=this.kc.find((({dr:t})=>t.nt===e));if(!r)return;const s=r.dr,n=r.data.find((e=>e.name===t));n&&s.ft(t,n.type,i)}Cf(e,t){this.yn(this.Wc,!1,!0),this.La(t),e.forEach((({ds:e})=>{const t=e.rn;t&&(e.ln.Dr||(this.Lf(e),this.Pn(e.qs,t),this.jc&&this.jc.Be("depth pre pass",e.name,e.qs)))}))}zf(){this.Yc.zi(this.Wc.Mi),_t.Di({$e:this.$e,Ri:this.Yc,Li:this.Kc,width:this.ol,height:this.ul})}Pf(e,t){e.forEach((e=>{e.yu&&e.xu&&(this.yn(e.yu.write,!1,!0),t.length<1||(this.La(e.xu),t.forEach((({ds:t})=>{const i=t.rn;i&&(this.Lf(t),i.Er.cr(Ve,this.Kc.Mi),t.cn({Da:e.xu}),this.Pn(t.qs,i),this.jc&&this.jc.Be("shadow pass",t.name,t.qs))}))))}))}Mf(e,t){this.Xc.zi(this.Wc.Mi),this.yn(this.Xc.write,!0),this.La(t),e.forEach((({ds:e,yf:i})=>{if(e.type===y.S){if(!e.Pn)return;e.Ws(t)}const r=e.tn[i];r.Dr&&(this.yn(null,!1,!1),this.zf(),this.yn(this.Xc.write,!1,!1)),this.Lf(e),r.Er.cr(Ve,this.Kc.Mi),e.hn({Da:t}),this.Pn(e.qs,r),this.jc&&this.jc.Be("scene pass",e.name,e.qs)}))}Lf(e){this.Rf(ut,ve,e.transform.xs),this.Rf(ut,Te,e.transform.gs),this.Rf(ut,ye,e.transform.ys)}La(e){this.Rf(ut,de,e.jn),this.Rf(ut,ge,e.projectionMatrix),this.Rf(lt,Me,e.transform.xs.position),this.Rf(lt,Pe,e.la()),this.Rf(lt,$e,e.near),this.Rf(lt,He,e.Jn),this.Rf(lt,ze,(e.na(),e.ca)),this.Rf(lt,De,e.na()?e.Hl:0),this.Rf(ut,xe,e.$n),this.Rf(ut,we,e.Wn),this.Rf(ut,be,e.Xn),this.Rf(ut,Se,e.Hn),this.Rf(ut,Ce,e.jn.clone().$i().ji())}Bf(e,t,i,r=!1){const s=this.kc.find((({dr:t})=>t.nt===e));if(!s)return;const n=s.dr,a=s.data.find((e=>e.name===t));if(!a)return;const o=(e,t)=>{const i=[];switch(e){case ue:case he:i.push(t),i.push(0),i.push(0),i.push(0);break;case pe:i.push(t?1:0),i.push(0),i.push(0),i.push(0);break;case te:case re:i.push(...t.elements),i.push(0);break;case se:case Z:case ce:i.push(...t.elements)}return i};switch(a.type){case ae:i.forEach((e=>{const i=`${t}.${e.name}`,r=o(e.type,e.value);n.ct(i,new Float32Array(r))}));break;case oe:i.forEach(((e,i)=>{e.forEach((e=>{const s=`${t}[${i}].${e.name}`,a=o(e.type,e.value);n.ct(s,new Float32Array(a),r)}))}));break;default:if(Array.isArray(i)){const e=[];i.forEach((t=>{"number"==typeof t?(e.push(t),e.push(0),e.push(0),e.push(0)):"boolean"==typeof t?(e.push(t?1:0),e.push(0),e.push(0),e.push(0)):e.push(...t.elements)})),n.ct(t,new Float32Array(e))}else n.ct(t,"number"==typeof i?new Float32Array([i]):i.elements)}}Tf({time:e}){this.Bf(ot,Fe,e),this.Bf(ot,Oe,new li(this.ol,this.ul,this.ol/this.ul,0))}wf(e){this.Bf(ht,We,[{name:Ye,type:re,value:e.transform.position.clone().Dt().normalize()},{name:Ke,type:ue,value:e.Fu},{name:Ze,type:ce,value:e.color},{name:Qe,type:Z,value:e._h}])}Sf(e){this.Bf(ct,Xe,e.map((e=>[{name:Ze,type:ce,value:e.color},{name:tt,type:re,value:e.transform.position},{name:Ye,type:re,value:e.transform.Cs.clone()},{name:Ke,type:ue,value:e.Fu},{name:it,type:ue,value:e.jh},{name:rt,type:ue,value:e.$h},{name:st,type:ue,value:e.Xh},{name:nt,type:ue,value:e.Jh},{name:Qe,type:Z,value:e._h}])))}bf(e){this.Bf(ft,Je,e.map((e=>[{name:Ze,type:ce,value:e.color},{name:tt,type:re,value:e.transform.position},{name:Ke,type:ue,value:e.Fu},{name:it,type:ue,value:e.jh},{name:rt,type:ue,value:e.$h}])),!0)}Df(e,t,i){this.La(t),e.forEach((({ds:e,yf:t})=>{const r=e.tn[t];this.Lf(e),er(r,i,this.$e.Ra),this.Pn(e.qs,r),this.jc&&this.jc.Be("transparent pass",e.name,e.qs)}))}}({$e:Qs,canvas:Ks,_c:en}),rn=new class{constructor({$e:i,Sn:r,Uf:s,If:n,Vf:a,Te:o=!1}){this.#q=null,this.#ee=null,this.#te=null,this.#ie=null,this.#re=null,this.#se=null,this.Nf=null,this.#s=i,this.#ne=r,this.#ae=new St({Te:o,Se:!1}),this.#ne.vf(this.#ae),this.#oe=new t(60,this.Xs.bind(this)),this.#ue=new e(60,this.update.bind(this)),this.#ie=s||null,this.#re=n||null,this.Nf=a||null,this.Ef=function({$e:e,Sn:t}){const i=new Et({$e:e}),r=({$e:e,width:t,height:i})=>new _t({$e:e,width:t,height:i,type:E,Ke:V,Ze:V,Qe:B,qe:B}),s=(e,r)=>{t.yn(e,!0),t.Pn(i,r),t.yn(null)},n=i.ri();return ui.reduce(((t,i)=>{const{key:a,width:o,height:u,zn:l,Dn:h,Rn:c,Ln:f,Bn:m,Un:p,update:v}=i,d=r({$e:e,width:o,height:u}),g=r({$e:e,width:o,height:u}),x=new Yt({Bi:ii.pn,Ui:l,Er:h}),y=new Yt({Bi:ii.pn,Ui:"#version 300 es\nprecision highp float;uniform sampler2D uSrcTexture;uniform float uTilingEnabled,uEdgeMaskMix,uRemapMin,uRemapMax;in vec2 vUv;out vec4 outColor;float x(vec2 u,float v){vec2 x=abs(u-vec2(.5))*v;return clamp(0.,1.,max(1.-dot(x,x),.001));}float x(vec2 u){vec2 v=abs(fract(u)-vec2(.5))*2.;return max(1.-max(v.x,v.y),.001);}void main(){vec2 u=vUv;float v=x(u,2.),r=x(u+vec2(.5,-.5),2.),t=x(u+vec2(.5),2.),f=x(u+vec2(-.5),2.),e=x(u+vec2(-.5,.5),2.),m=x(u+vec2(0,-.5),4.)*.25,z=x(u+vec2(0,.5),4.)*.25,s=x(u+vec2(.5,0),4.)*.25,d=x(u+vec2(-.5,0),4.)*.25,n=x(u),a=v,y=mix(n,r+t+f+e,uEdgeMaskMix),C=a+y;vec4 o=texture(uSrcTexture,u),D=texture(uSrcTexture,u+vec2(.5));outColor=vec4((o*a/C+D*y/C+texture(uSrcTexture,u+vec2(0,.5))*mix(n,m+z,uEdgeMaskMix)/C+texture(uSrcTexture,u+vec2(.5,0))*mix(n,s+d,uEdgeMaskMix)/C).xyz,1);outColor=mix(o,vec4(a*o.x/C+y*D.x/C,a*o.y/C+y*D.y/C,a*o.z/C+y*D.z/C,1),step(.5,uTilingEnabled));vec3 c=clamp((outColor.xyz-vec3(uRemapMin))/(uRemapMax-uRemapMin),0.,1.);outColor.xyz=c;}",Er:[{name:"uSrcTexture",type:q,value:null},{name:"uTilingEnabled",type:ue,value:c?1:0},{name:"uEdgeMaskMix",type:ue,value:f},{name:"uRemapMin",type:ue,value:m},{name:"uRemapMax",type:ue,value:p}]});x.start({$e:e,Xr:n}),y.start({$e:e,Xr:n}),y.Er.cr("uSrcTexture",d.tt);const T=()=>{s(d,x),s(g,y)};return T(),t[a]=(()=>{let e=!1;return{tt:g.tt,Af:!1,update:t=>{e=!1,v&&(v(t,x),e=!0)},Tn:()=>{e&&T()}}})(),t}),{})}({$e:i,Sn:r})}#s;#ae;#ne;#q;#oe;#ue;#ee;#te;#ie;#re;#se;get Sn(){return this.#ne}get Ff(){return this.Ef}set Of(e){this.#ee=e}set _f(e){this.#te=e}set If(e){this.#re=e}set Uf(e){this.#ie=e}set Vf(e){this.Nf=e}kf(e){this.#q=e}start(){this.#ee&&this.#ee();const e=performance.now()/1e3;this.#oe.start(e),this.#ue.start(e),this.#te&&this.#te()}it(e,t){const i=e*this.Sn._c,r=t*this.Sn._c,s=Math.floor(i),n=Math.floor(r);this.#q?.Ku((e=>e.it(s,n))),this.#ne.it(i,r)}Xs(e,t){this.#ie&&this.#ie({Js:e,Ys:t}),this.#q?.Ku((i=>i.Xs({$e:this.#s,Js:e,Ys:t}))),this.#q?.Ku((e=>{e.Ws()}))}update(e,t){this.#re&&this.#re({time:e,Ks:t}),this.#q?.Ku((i=>{switch(i.update({$e:this.#s,time:e,Ks:t}),i.type){case y.S:case y.v:case y.g:i.Qs({$e:this.#s});const e=i;e.tn.forEach((e=>{this.Sn.Mn(e)})),e.rn&&this.Sn.Mn(e.rn)}})),this.#se&&this.#se({time:e,Ks:t}),this.#q?.Ku((i=>{i.Zs({$e:this.#s,time:e,Ks:t})})),this.#q?.Ku((e=>{e.Ws()})),this.Tn(e,t)}Zs(e,t){this.#q?.Ku((i=>i.Zs({$e:this.#s,time:e,Ks:t})))}Tn(e,t){this.#ae.clear(),Object.values(this.Ef).forEach((t=>{t.update(e),t.Tn()})),this.Nf&&this.Nf(e,t),this.#ae.update(e)}Gf(e){this.#oe.exec(e/1e3),this.#ue.exec(e/1e3)}}({$e:Qs,Sn:tn});let sn;rn.kf(qs);const nn=()=>{$s&&$s.stop()},an=e=>{const t=Fs(Qs,e),{lc:i}=t;Hs=t.hc;for(let u=0;u<i.length;u++)qs.add(i[u]);sn=qs.find("MainCamera");const r=qs.find("DirectionalLight"),s=new Os(sn);s.jh=15,s.$h=.01,s.cc=.2,s.gc=100,s.xc=100,s.yc=2,s.Tc=2,s.dc=5,s.vc=-45,s.mc=55,s.fc=-55,s.wc=10,s.Sc=-10,s.vs=new It(0,3,0),s.start(),s.enabled=!0,sn.ks((({ds:e})=>{e.ra(new li(0,0,0,1))})),sn.Gs=()=>{Js.wl&&s.enabled&&s.bc(Js.bl),s.Xs()};const n=qs.find("SpotLight");n&&n.xu&&(n.xu.Yn=!0,n.nn=!0,n.xu.near=.1,n.xu.Jn=n.jh,n.xu.Rh(1),n.yu=new _t({$e:Qs,width:1024,height:1024,type:A,et:N})),r&&r.xu&&(r.nn=!0,r.xu.near=1,r.xu.Jn=30,r.xu.fa(null,null,-12,12,-12,12),r.yu=new _t({$e:Qs,width:1024,height:1024,type:A}),r.ks((({ds:e})=>{e.transform.Ei(new It(-8,8,-2)),e.transform.zs(new It(0,0,0))})));const a=new pi,o=new Er({$e:Qs});o.parameters.enabled=!1,a.da(o),a.enabled=!0,sn.ia(a),function({jf:e}){ks=new Or,ks.xh(),ks.ph({dh:"play sound",gh:()=>{nn(),$s=new jr(Qs,"#version 300 es\nuniform float uBlockOffset,uSampleRate;out vec2 vSound;\n#define BPM 120.0\n#define PI 3.1415\n#define TAU 6.2831\nvec2 v(float v){float f=v/60.*BPM;return vec2(sin((mod(f,4.)>=1.?440.:880.)*TAU*v)*exp(-6.*fract(f)));}void main(){float f=uBlockOffset+float(gl_VertexID)/uSampleRate;vSound=v(f);}",180),$s.play(0)}}),ks.ph({dh:"stop sound",gh:()=>{nn()}}),ks.fh({label:"seek sound",minValue:0,maxValue:180,mh:.01,nh:0,sh:e=>{$s&&$s.play(e)}}),ks.xh(),ks.hh({label:"show buffers",nh:e.parameters.enabled,sh:t=>e.parameters.enabled=t}),ks.xh();const t=ks.ih("ssao",!1);t.hh({label:"ssao pass enabled",nh:tn.hl.parameters.enabled,sh:e=>tn.hl.parameters.enabled=e}),t.fh({label:"ssao occlusion sample length",minValue:.01,maxValue:1,mh:.001,nh:tn.hl.no,sh:e=>{tn.hl.no=e}}),t.fh({label:"ssao occlusion bias",minValue:1e-4,maxValue:.01,mh:1e-4,nh:tn.hl.ao,sh:e=>{tn.hl.ao=e}}),t.fh({label:"ssao min distance",minValue:0,maxValue:.1,mh:.001,nh:tn.hl.oo,sh:e=>{tn.hl.oo=e}}),t.fh({label:"ssao max distance",minValue:0,maxValue:1,mh:.001,nh:tn.hl.uo,sh:e=>{tn.hl.uo=e}}),t.uh({label:"ssao color",nh:tn.hl.lo.Ka(),sh:e=>{tn.hl.lo=wi.eo(e)}}),t.fh({label:"ssao occlusion power",minValue:.5,maxValue:4,mh:.01,nh:tn.hl.ho,sh:e=>{tn.hl.ho=e}}),t.fh({label:"ssao occlusion strength",minValue:0,maxValue:1,mh:.001,nh:tn.hl.co,sh:e=>{tn.hl.co=e}}),t.fh({label:"ssao blend rate",minValue:0,maxValue:1,mh:.001,nh:tn.hl.fo,sh:e=>{tn.hl.fo=e}}),ks.xh();const i=ks.ih("light shaft");i.hh({label:"light shaft pass enabled",nh:tn.ml.parameters.enabled,sh:e=>tn.ml.parameters.enabled=e}),i.fh({label:"blend rate",minValue:0,maxValue:1,mh:.001,nh:tn.ml.parameters.fo,sh:e=>{tn.ml.parameters.fo=e}}),i.fh({label:"pass scale",minValue:.001,maxValue:1,mh:.001,nh:tn.ml.parameters.ru,sh:e=>{tn.ml.parameters.ru=e}}),i.fh({label:"ray step strength",minValue:.001,maxValue:.05,mh:.001,nh:tn.ml.parameters.su,sh:e=>{tn.ml.parameters.su=e}}),ks.xh();const r=ks.ih("fog");r.fh({label:"density",minValue:0,maxValue:1,mh:1e-4,nh:tn.dl.parameters.bu,sh:e=>{tn.dl.parameters.bu=e}}),r.fh({label:"attenuation",minValue:0,maxValue:1,mh:1e-4,nh:tn.dl.parameters.Cu,sh:e=>{tn.dl.parameters.Cu=e}}),ks.xh();const s=ks.ih("depth of field",!1);s.hh({label:"DoF pass enabled",nh:tn.vl.enabled,sh:e=>tn.vl.enabled=e}),s.fh({label:"DoF focus distance",minValue:.1,maxValue:100,mh:.001,nh:tn.vl.parameters.Ko,sh:e=>{tn.vl.parameters.Ko=e}}),s.fh({label:"DoF focus range",minValue:.1,maxValue:20,mh:.001,nh:tn.vl.parameters.Zo,sh:e=>{tn.vl.parameters.Zo=e}}),s.fh({label:"DoF bokeh radius",minValue:.01,maxValue:10,mh:.001,nh:tn.vl.parameters.Qo,sh:e=>{tn.vl.parameters.Qo=e}}),ks.xh();const n=ks.ih("bloom",!1);n.hh({label:"Bloom pass enabled",nh:tn.xl.parameters.enabled,sh:e=>tn.xl.parameters.enabled=e}),n.fh({label:"bloom amount",minValue:0,maxValue:4,mh:.001,nh:tn.xl.parameters.Do,sh:e=>{tn.xl.parameters.Do=e}}),n.fh({label:"bloom threshold",minValue:0,maxValue:2,mh:.001,nh:tn.xl.parameters.threshold,sh:e=>{tn.xl.parameters.threshold=e}}),n.fh({label:"bloom tone",minValue:0,maxValue:1,mh:.001,nh:tn.xl.parameters.tone,sh:e=>{tn.xl.parameters.tone=e}}),ks.xh();const a=ks.ih("ssr",!1);a.hh({label:"ssr pass enabled",nh:tn.fl.parameters.enabled,sh:e=>tn.fl.parameters.enabled=e}),a.fh({label:"depth bias",minValue:.001,maxValue:.1,mh:.001,nh:tn.fl.parameters.mo,sh:e=>{tn.fl.parameters.mo=e}}),a.fh({label:"ray nearest distance",minValue:.001,maxValue:1,mh:.001,nh:tn.fl.parameters.po,sh:e=>{tn.fl.parameters.po=e}}),a.fh({label:"ray max distance",minValue:.001,maxValue:10,mh:.001,nh:tn.fl.parameters.vo,sh:e=>{tn.fl.parameters.vo=e}}),a.fh({label:"ray thickness",minValue:.001,maxValue:1,mh:.001,nh:tn.fl.parameters.do,sh:e=>{tn.fl.parameters.do=e}}),a.fh({label:"jitter size x",minValue:.001,maxValue:.1,mh:.001,nh:tn.fl.parameters.xo,sh:e=>{tn.fl.parameters.xo=e}}),a.fh({label:"jitter size y",minValue:.001,maxValue:.1,mh:.001,nh:tn.fl.parameters.yo,sh:e=>{tn.fl.parameters.yo=e}}),a.fh({label:"fade min distance",minValue:.001,maxValue:10,mh:.001,nh:tn.fl.parameters.To,sh:e=>{tn.fl.parameters.To=e}}),a.fh({label:"fade max distance",minValue:.001,maxValue:10,mh:.001,nh:tn.fl.parameters.wo,sh:e=>{tn.fl.parameters.wo=e}}),a.fh({label:"edge fade factor min x",minValue:.001,maxValue:1,mh:.001,nh:tn.fl.parameters.So,sh:e=>{tn.fl.parameters.So=e}}),a.fh({label:"edge fade factor max x",minValue:.001,maxValue:1,mh:.001,nh:tn.fl.parameters.bo,sh:e=>{tn.fl.parameters.bo=e}}),a.fh({label:"edge fade factor min y",minValue:.001,maxValue:1,mh:.001,nh:tn.fl.parameters.Co,sh:e=>{tn.fl.parameters.Co=e}}),a.fh({label:"edge fade factor max y",minValue:.001,maxValue:1,mh:.001,nh:tn.fl.parameters.Mo,sh:e=>{tn.fl.parameters.Mo=e}}),a.fh({label:"additional rate",minValue:.01,maxValue:1,mh:.01,nh:tn.fl.parameters.zo,sh:e=>{tn.fl.parameters.zo=e}}),Ys.appendChild(ks.Ce)}({jf:o})};(async()=>{await async function(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}(0),an(Fr),tn.dl.parameters.fo=0;const e=()=>{Gs=Ys.offsetWidth,js=Ys.offsetHeight,Js.it(Gs,js),rn.it(Gs,js)};rn.Of=()=>{e(),window.addEventListener("resize",e)},rn.If=()=>{Js.update()},rn.Vf=e=>{null!==Hs&&Hs.nc(Ws.getCurrentTime()),sn&&tn.Tn(qs,sn,{time:e})};const t=e=>{rn.Gf(e),requestAnimationFrame(t)};rn.start(),requestAnimationFrame(t)})();
